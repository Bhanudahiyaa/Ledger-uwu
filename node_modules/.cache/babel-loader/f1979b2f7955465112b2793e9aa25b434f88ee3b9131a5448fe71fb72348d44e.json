{"ast":null,"code":"import { __awaiter } from \"tslib\";\nimport { Emitter } from 'mana-common';\nexport var Disposable;\n(function (Disposable) {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  function is(arg) {\n    return !!arg && typeof arg === 'object' && 'dispose' in arg && typeof arg.dispose === 'function';\n  }\n  Disposable.is = is;\n  function create(func) {\n    return {\n      dispose: func\n    };\n  }\n  Disposable.create = create;\n  Disposable.NULL = create(() => {});\n})(Disposable || (Disposable = {}));\nexport class DisposableCollection {\n  constructor(...toDispose) {\n    this.disposables = [];\n    this.onDisposeEmitter = new Emitter();\n    this.disposingElements = false;\n    toDispose.forEach(d => this.push(d));\n  }\n  /**\n   * This event is fired only once\n   * on first dispose of not empty collection.\n   */\n  get onDispose() {\n    return this.onDisposeEmitter.event;\n  }\n  checkDisposed() {\n    if (this.disposed && !this.disposingElements) {\n      this.onDisposeEmitter.fire(undefined);\n      this.onDisposeEmitter.dispose();\n    }\n  }\n  get disposed() {\n    return this.disposables.length === 0;\n  }\n  dispose() {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (this.disposed || this.disposingElements) {\n        return;\n      }\n      this.disposingElements = true;\n      while (!this.disposed) {\n        try {\n          const d = this.disposables.pop();\n          yield d.dispose();\n        } catch (e) {\n          console.error(e);\n        }\n      }\n      this.disposingElements = false;\n      this.checkDisposed();\n    });\n  }\n  push(disposable) {\n    const {\n      disposables\n    } = this;\n    disposables.push(disposable);\n    const originalDispose = disposable.dispose.bind(disposable);\n    const toRemove = Disposable.create(() => {\n      const index = disposables.indexOf(disposable);\n      if (index !== -1) {\n        disposables.splice(index, 1);\n      }\n      this.checkDisposed();\n    });\n    disposable.dispose = () => {\n      toRemove.dispose();\n      originalDispose();\n    };\n    return toRemove;\n  }\n  pushAll(disposables) {\n    return disposables.map(disposable => this.push(disposable));\n  }\n}","map":{"version":3,"names":["Emitter","Disposable","is","arg","dispose","create","func","NULL","DisposableCollection","constructor","toDispose","disposables","onDisposeEmitter","disposingElements","forEach","d","push","onDispose","event","checkDisposed","disposed","fire","undefined","length","pop","e","console","error","disposable","originalDispose","bind","toRemove","index","indexOf","splice","pushAll","map"],"sources":["../../src/common/disposable.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}