{"ast":null,"code":"import { __awaiter } from \"tslib\";\nimport React from 'react';\nimport { useXflowPrefixCls } from '@antv/xflow-core';\nimport { PanelFooter } from './panel-footer';\nimport { PanelHeader } from './panel-header';\nimport { PanelBody } from './panel-body';\nimport { usePanelLyaoutStyle } from './utils';\nimport { useJsonSchemaFormModel } from './service';\nexport { FormItemWrapper } from './schema-form';\nexport { executeJsonSchemaFormCommand } from './service';\nimport { WorkspacePanel } from '../base-panel';\n/** useFormPanelData获取数据 */\nexport const JsonSchemaFormMain = props => {\n  const {\n    prefixClz\n  } = props;\n  const {\n    getCustomRenderComponent,\n    afterUpdatingCb,\n    formValueUpdateService = () => {}\n  } = props;\n  const {\n    state,\n    commandService,\n    modelService\n  } = useJsonSchemaFormModel(props);\n  // 联动更新form items的值\n  const triggerUpdate = React.useCallback((form, values = {}) => __awaiter(void 0, void 0, void 0, function* () {\n    form.setFieldsValue(values);\n    const changedFields = Object.entries(values).map(([key, val]) => {\n      return {\n        name: key,\n        value: val\n      };\n    });\n    const allFields = Object.entries(state.targetData).map(([key, val]) => {\n      return {\n        name: key,\n        value: val\n      };\n    });\n    const result = yield formValueUpdateService({\n      allFields: allFields,\n      values: changedFields,\n      modelService,\n      commandService,\n      targetData: state.targetData,\n      targetType: state.targetType\n    });\n    if (afterUpdatingCb) {\n      afterUpdatingCb(result);\n    }\n  }), [afterUpdatingCb, commandService, formValueUpdateService, modelService, state.targetData, state.targetType]);\n  // 在fields change时的回调\n  const onFieldsChange = React.useCallback((changedFields, allFields) => __awaiter(void 0, void 0, void 0, function* () {\n    const result = yield formValueUpdateService({\n      values: changedFields,\n      allFields,\n      modelService,\n      commandService,\n      targetData: state.targetData,\n      targetType: state.targetType\n    });\n    if (afterUpdatingCb) {\n      afterUpdatingCb(result);\n    }\n  }), [afterUpdatingCb, commandService, formValueUpdateService, modelService, state.targetData, state.targetType]);\n  /** schema为空的情况  */\n  const noSchema = React.useMemo(() => {\n    try {\n      return state.schema.tabs.length === 0 || !state.schema;\n    } catch (error) {\n      return true;\n    }\n  }, [state.schema]);\n  const {\n    headerStyle,\n    bodyStyle,\n    footerStyle\n  } = usePanelLyaoutStyle(props, noSchema);\n  /** 支持自定义渲染 */\n  if (getCustomRenderComponent) {\n    const Component = getCustomRenderComponent(state.targetType, state.targetData, modelService, commandService);\n    if (Component) {\n      return React.createElement(Component, Object.assign(Object.assign({}, props), {\n        headerStyle,\n        bodyStyle,\n        footerStyle,\n        targetData: state.targetData,\n        targetType: state.targetType,\n        modelService: modelService,\n        commandService: commandService\n      }));\n    }\n  }\n  return React.createElement(\"div\", {\n    className: prefixClz\n  }, React.createElement(PanelHeader, Object.assign({\n    hasSchema: !noSchema\n  }, props, {\n    state: state,\n    style: headerStyle,\n    prefixClz: props.prefixClz\n  })), React.createElement(PanelBody, Object.assign({}, props, {\n    key: state.targetData && state.targetData.id,\n    style: bodyStyle,\n    prefixClz: props.prefixClz,\n    loading: state.loading,\n    schema: state.schema,\n    triggerUpdate: triggerUpdate,\n    onFieldsChange: onFieldsChange\n  })), React.createElement(PanelFooter, Object.assign({}, props, {\n    state: state,\n    style: footerStyle\n  })));\n};\nexport const JsonSchemaForm = props => {\n  const prefixClz = useXflowPrefixCls('json-schema-form');\n  return React.createElement(WorkspacePanel, Object.assign({}, props, {\n    className: prefixClz\n  }), React.createElement(JsonSchemaFormMain, Object.assign({}, props, {\n    prefixClz: prefixClz\n  })));\n};","map":{"version":3,"names":["React","useXflowPrefixCls","PanelFooter","PanelHeader","PanelBody","usePanelLyaoutStyle","useJsonSchemaFormModel","FormItemWrapper","executeJsonSchemaFormCommand","WorkspacePanel","JsonSchemaFormMain","props","prefixClz","getCustomRenderComponent","afterUpdatingCb","formValueUpdateService","state","commandService","modelService","triggerUpdate","useCallback","form","values","__awaiter","setFieldsValue","changedFields","Object","entries","map","key","val","name","value","allFields","targetData","result","targetType","onFieldsChange","noSchema","useMemo","schema","tabs","length","error","headerStyle","bodyStyle","footerStyle","Component","createElement","assign","className","hasSchema","style","id","loading","JsonSchemaForm"],"sources":["../../src/canvas-json-schema-form/main.tsx"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}