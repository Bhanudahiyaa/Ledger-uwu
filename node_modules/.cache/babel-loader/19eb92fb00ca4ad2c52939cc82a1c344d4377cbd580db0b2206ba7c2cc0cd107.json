{"ast":null,"code":"import get from 'lodash/get';\n// 根据依赖字段生成 FormItem 的 updater\nexport function makeUpdaterByDependencies(dependencies, setReasonField) {\n  return (prevValues, currentValues) => {\n    const hasFunctionDep = dependencies.some(dep => typeof (dep === null || dep === void 0 ? void 0 : dep.condition) === 'function');\n    if (hasFunctionDep) {\n      if (typeof setReasonField === 'function') {\n        setReasonField(undefined); // 在更新规则是一个函数时，不依赖特定字段进行更新(即只要有字段的值更新了就更新，因为不知道函数内部依赖什么字段)\n      }\n      return true;\n    }\n    return dependencies.some(dep => {\n      const {\n        name\n      } = dep;\n      if (!name) {\n        // eslint-disable-next-line no-console\n        console.error(`[Schema form]: A dependent name must be provided in the updater when the dependency condition is not a function.`);\n        return false;\n      }\n      const changed = get(prevValues, name) !== get(currentValues, name);\n      if (changed) {\n        if (typeof setReasonField === 'function') {\n          setReasonField(name);\n        }\n        return true;\n      }\n      return false;\n    });\n  };\n}\nexport function isEmptyParamValue(val) {\n  return val === '' || val === undefined;\n}\n// 根据依赖字段的值生成当前的 FormItem 的值\nexport function makeFormItemControlledProps(form, schema, reasonField) {\n  const {\n    getFieldValue,\n    getFieldsValue\n  } = form;\n  const {\n    dependencies,\n    hidden,\n    disabled\n  } = schema;\n  let isHidden = hidden;\n  let isDisabled = disabled;\n  // 当依赖满足并且依赖被操作过时，最终状态会变成依赖指定的状态\n  dependencies === null || dependencies === void 0 ? void 0 : dependencies.forEach(dependency => {\n    const {\n      name: depName,\n      condition,\n      hidden: targetHiden,\n      disabled: targetDisabled\n    } = dependency;\n    // 在 condition 不是函数时，只检验造成更新的字段的变化\n    if (typeof condition !== 'function' && reasonField && depName !== reasonField) {\n      return;\n    }\n    let match = false;\n    if (typeof condition === 'function') {\n      const values = getFieldsValue();\n      match = !!condition(values);\n    } else {\n      if (!depName) {\n        // eslint-disable-next-line no-console\n        console.error(`[Schema form]: A dependent name must be provided in the props genarator when the dependency condition is not a function.`);\n        return;\n      }\n      match = getFieldValue(depName) === condition;\n    }\n    if (match) {\n      if (targetHiden !== undefined) {\n        isHidden = targetHiden;\n      }\n      if (targetDisabled !== undefined) {\n        isDisabled = targetDisabled;\n      }\n    }\n  });\n  return {\n    hidden: isHidden,\n    disabled: isDisabled\n  };\n}","map":{"version":3,"names":["get","makeUpdaterByDependencies","dependencies","setReasonField","prevValues","currentValues","hasFunctionDep","some","dep","condition","undefined","name","console","error","changed","isEmptyParamValue","val","makeFormItemControlledProps","form","schema","reasonField","getFieldValue","getFieldsValue","hidden","disabled","isHidden","isDisabled","forEach","dependency","depName","targetHiden","targetDisabled","match","values"],"sources":["../../../../../src/canvas-json-schema-form/schema-form/common/form-item-wrapper/util.ts"],"sourcesContent":[null],"mappings":"AAAA,OAAOA,GAAG,MAAM,YAAY;AAI5B;AACA,OAAM,SAAUC,yBAAyBA,CACvCC,YAA2B,EAC3BC,cAAkD;EAElD,OAAO,CAACC,UAAe,EAAEC,aAAkB,KAAI;IAC7C,MAAMC,cAAc,GAAGJ,YAAY,CAACK,IAAI,CAACC,GAAG,IAAI,QAAOA,GAAG,aAAHA,GAAG,uBAAHA,GAAG,CAAEC,SAAS,MAAK,UAAU,CAAC;IACrF,IAAIH,cAAc,EAAE;MAClB,IAAI,OAAOH,cAAc,KAAK,UAAU,EAAE;QACxCA,cAAc,CAACO,SAAS,CAAC,EAAC;;MAE5B,OAAO,IAAI;;IAEb,OAAOR,YAAY,CAACK,IAAI,CAACC,GAAG,IAAG;MAC7B,MAAM;QAAEG;MAAI,CAAE,GAAGH,GAAG;MACpB,IAAI,CAACG,IAAI,EAAE;QACT;QACAC,OAAO,CAACC,KAAK,CACX,kHAAkH,CACnH;QACD,OAAO,KAAK;;MAEd,MAAMC,OAAO,GAAGd,GAAG,CAACI,UAAU,EAAEO,IAAI,CAAC,KAAKX,GAAG,CAACK,aAAa,EAAEM,IAAI,CAAC;MAClE,IAAIG,OAAO,EAAE;QACX,IAAI,OAAOX,cAAc,KAAK,UAAU,EAAE;UACxCA,cAAc,CAACQ,IAAI,CAAC;;QAEtB,OAAO,IAAI;;MAEb,OAAO,KAAK;IACd,CAAC,CAAC;EACJ,CAAC;AACH;AAEA,OAAM,SAAUI,iBAAiBA,CAACC,GAA0C;EAC1E,OAAOA,GAAG,KAAK,EAAE,IAAIA,GAAG,KAAKN,SAAS;AACxC;AAEA;AACA,OAAM,SAAUO,2BAA2BA,CACzCC,IAAuB,EACvBC,MAAsB,EACtBC,WAA+B;EAE/B,MAAM;IAAEC,aAAa;IAAEC;EAAc,CAAE,GAAGJ,IAAI;EAC9C,MAAM;IAAEhB,YAAY;IAAEqB,MAAM;IAAEC;EAAQ,CAAE,GAAGL,MAAM;EAEjD,IAAIM,QAAQ,GAAYF,MAAM;EAC9B,IAAIG,UAAU,GAAYF,QAAQ;EAClC;EACAtB,YAAY,aAAZA,YAAY,uBAAZA,YAAY,CAAEyB,OAAO,CAACC,UAAU,IAAG;IACjC,MAAM;MAAEjB,IAAI,EAAEkB,OAAO;MAAEpB,SAAS;MAAEc,MAAM,EAAEO,WAAW;MAAEN,QAAQ,EAAEO;IAAc,CAAE,GAAGH,UAAU;IAC9F;IACA,IAAI,OAAOnB,SAAS,KAAK,UAAU,IAAIW,WAAW,IAAIS,OAAO,KAAKT,WAAW,EAAE;MAC7E;;IAEF,IAAIY,KAAK,GAAY,KAAK;IAC1B,IAAI,OAAOvB,SAAS,KAAK,UAAU,EAAE;MACnC,MAAMwB,MAAM,GAAGX,cAAc,EAAE;MAC/BU,KAAK,GAAG,CAAC,CAACvB,SAAS,CAACwB,MAAM,CAAC;KAC5B,MAAM;MACL,IAAI,CAACJ,OAAO,EAAE;QACZ;QACAjB,OAAO,CAACC,KAAK,CACX,0HAA0H,CAC3H;QACD;;MAEFmB,KAAK,GAAGX,aAAa,CAACQ,OAAO,CAAC,KAAKpB,SAAS;;IAE9C,IAAIuB,KAAK,EAAE;MACT,IAAIF,WAAW,KAAKpB,SAAS,EAAE;QAC7Be,QAAQ,GAAGK,WAAW;;MAExB,IAAIC,cAAc,KAAKrB,SAAS,EAAE;QAChCgB,UAAU,GAAGK,cAAc;;;EAGjC,CAAC,CAAC;EAEF,OAAO;IACLR,MAAM,EAAEE,QAAQ;IAChBD,QAAQ,EAAEE;GACX;AACH","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}