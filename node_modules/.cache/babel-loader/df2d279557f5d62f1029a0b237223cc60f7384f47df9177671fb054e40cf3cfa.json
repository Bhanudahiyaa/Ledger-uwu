{"ast":null,"code":"import { __awaiter } from \"tslib\";\nimport React from 'react';\nimport { Dropdown } from '@antv/x6-react-components';\nimport { useXFlowApp, useModelAsync } from '@antv/xflow-core';\nimport { CONTEXT_MENU_MODEL } from '../interface';\nimport { XFlowMenu } from './menu';\nconst DisposeHelper = ({\n  toDispose\n}) => {\n  React.useEffect(() => {\n    return () => {\n      toDispose.dispose();\n    };\n  }, [toDispose]);\n  return null;\n};\nexport const ContextMenuRender = () => {\n  const domRef = React.useRef();\n  const xflow = useXFlowApp();\n  const [state,, renderModel] = useModelAsync({\n    /** 绑定Model到state */\n    getModel: () => __awaiter(void 0, void 0, void 0, function* () {\n      return yield CONTEXT_MENU_MODEL.getModel(xflow.modelService);\n    }),\n    /** 设置state的默认值 */\n    initialState: {\n      anchor: null,\n      menuModel: null,\n      target: null,\n      customRender: null,\n      toDispose: null\n    }\n  });\n  const {\n    target,\n    anchor,\n    menuModel,\n    customRender,\n    toDispose\n  } = state;\n  if (!target || !anchor || !menuModel) {\n    return null;\n  }\n  const onMaskClick = () => {\n    renderModel.setValue({\n      anchor: null,\n      menuModel: null,\n      target: null,\n      customRender: null,\n      toDispose: null\n    });\n  };\n  const overlay = customRender ? React.createElement(customRender, {\n    target,\n    modelService: xflow.modelService,\n    onHide: onMaskClick\n  }) : React.createElement(XFlowMenu, {\n    target: target,\n    menuModel: menuModel,\n    onHide: onMaskClick\n  });\n  return React.createElement(\"div\", {\n    className: \"xflow-menu-mask\",\n    ref: domRef,\n    onClick: onMaskClick,\n    onContextMenu: e => {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n  }, React.createElement(DisposeHelper, {\n    toDispose: toDispose\n  }), React.createElement(Dropdown, {\n    visible: true,\n    getPopupContainer: () => domRef.current,\n    overlay: overlay\n  }, React.createElement(\"div\", {\n    className: \"xflow-context-menu-anchor\",\n    style: {\n      top: anchor.y,\n      left: anchor.x\n    }\n  })));\n};","map":{"version":3,"names":["React","Dropdown","useXFlowApp","useModelAsync","CONTEXT_MENU_MODEL","XFlowMenu","DisposeHelper","toDispose","useEffect","dispose","ContextMenuRender","domRef","useRef","xflow","state","renderModel","getModel","__awaiter","modelService","initialState","anchor","menuModel","target","customRender","onMaskClick","setValue","overlay","createElement","onHide","className","ref","onClick","onContextMenu","e","preventDefault","stopPropagation","visible","getPopupContainer","current","style","top","y","left","x"],"sources":["../../../src/canvas-context-menu/components/index.tsx"],"sourcesContent":[null],"mappings":";AAEA,OAAOA,KAAK,MAAM,OAAO;AACzB,SAASC,QAAQ,QAAQ,2BAA2B;AACpD,SAASC,WAAW,EAAEC,aAAa,QAAQ,kBAAkB;AAC7D,SAASC,kBAAkB,QAAQ,cAAc;AACjD,SAASC,SAAS,QAAQ,QAAQ;AAElC,MAAMC,aAAa,GAAkDA,CAAC;EAAEC;AAAS,CAAE,KAAI;EACrFP,KAAK,CAACQ,SAAS,CAAC,MAAK;IACnB,OAAO,MAAK;MACVD,SAAS,CAACE,OAAO,EAAE;IACrB,CAAC;EACH,CAAC,EAAE,CAACF,SAAS,CAAC,CAAC;EAEf,OAAO,IAAI;AACb,CAAC;AAED,OAAO,MAAMG,iBAAiB,GAAqBA,CAAA,KAAK;EACtD,MAAMC,MAAM,GAAGX,KAAK,CAACY,MAAM,EAAkB;EAC7C,MAAMC,KAAK,GAAGX,WAAW,EAAE;EAE3B,MAAM,CAACY,KAAK,GAAIC,WAAW,CAAC,GAAGZ,aAAa,CAA4B;IACtE;IACAa,QAAQ,EAAEA,CAAA,KAAWC,SAAA;MACnB,OAAO,MAAMb,kBAAkB,CAACY,QAAQ,CAACH,KAAK,CAACK,YAAY,CAAC;IAC9D,CAAC;IACD;IACAC,YAAY,EAAE;MACZC,MAAM,EAAE,IAAI;MACZC,SAAS,EAAE,IAAI;MACfC,MAAM,EAAE,IAAI;MACZC,YAAY,EAAE,IAAI;MAClBhB,SAAS,EAAE;;GAEd,CAAC;EAEF,MAAM;IAAEe,MAAM;IAAEF,MAAM;IAAEC,SAAS;IAAEE,YAAY;IAAEhB;EAAS,CAAE,GAAGO,KAAK;EAEpE,IAAI,CAACQ,MAAM,IAAI,CAACF,MAAM,IAAI,CAACC,SAAS,EAAE;IACpC,OAAO,IAAI;;EAGb,MAAMG,WAAW,GAAGA,CAAA,KAAK;IACvBT,WAAW,CAACU,QAAQ,CAAC;MACnBL,MAAM,EAAE,IAAI;MACZC,SAAS,EAAE,IAAI;MACfC,MAAM,EAAE,IAAI;MACZC,YAAY,EAAE,IAAI;MAClBhB,SAAS,EAAE;KACZ,CAAC;EACJ,CAAC;EAED,MAAMmB,OAAO,GAAGH,YAAY,GAC1BvB,KAAK,CAAC2B,aAAa,CAACJ,YAAY,EAAE;IAChCD,MAAM;IACNJ,YAAY,EAAEL,KAAK,CAACK,YAAY;IAChCU,MAAM,EAAEJ;GACT,CAAC,GAEFxB,KAAA,CAAA2B,aAAA,CAACtB,SAAS;IAACiB,MAAM,EAAEA,MAAM;IAAED,SAAS,EAAEA,SAAS;IAAEO,MAAM,EAAEJ;EAAW,EACrE;EAED,OACExB,KAAA,CAAA2B,aAAA;IACEE,SAAS,EAAC,iBAAiB;IAC3BC,GAAG,EAAEnB,MAAM;IACXoB,OAAO,EAAEP,WAAW;IACpBQ,aAAa,EAAEC,CAAC,IAAG;MACjBA,CAAC,CAACC,cAAc,EAAE;MAClBD,CAAC,CAACE,eAAe,EAAE;IACrB;EAAC,GAEDnC,KAAA,CAAA2B,aAAA,CAACrB,aAAa;IAACC,SAAS,EAAEA;EAAS,EAAI,EACvCP,KAAA,CAAA2B,aAAA,CAAC1B,QAAQ;IAACmC,OAAO;IAACC,iBAAiB,EAAEA,CAAA,KAAM1B,MAAM,CAAC2B,OAAO;IAAEZ,OAAO,EAAEA;EAAO,GACzE1B,KAAA,CAAA2B,aAAA;IAAKE,SAAS,EAAC,2BAA2B;IAACU,KAAK,EAAE;MAAEC,GAAG,EAAEpB,MAAM,CAACqB,CAAC;MAAEC,IAAI,EAAEtB,MAAM,CAACuB;IAAC;EAAE,EAAI,CAC9E,CACP;AAEV,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}