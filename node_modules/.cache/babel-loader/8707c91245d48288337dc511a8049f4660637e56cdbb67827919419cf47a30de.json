{"ast":null,"code":"import { __awaiter } from \"tslib\";\nimport React from 'react';\nimport { usePositionStyle } from '../../common/position';\nimport { GraphConfig, createX6GraphModule } from '../graph';\nimport { useExtensionRegistry } from './extension-context';\nimport { useXflowPrefixCls } from './global-config-context';\nimport { usePortal } from '@antv/x6-react-shape';\nimport { useXFlowApp } from './app-context';\nexport const XFlowCanvas = props => {\n  const app = useXFlowApp();\n  /** x6画布parent的dom节点 */\n  const rootRef = React.useRef(null);\n  /** x6画布的dom节点 */\n  const canvasRef = React.useRef(null);\n  /** 生成配置中心 */\n  const extensionRegistry = useExtensionRegistry();\n  /** 获取ContextService的配置 */\n  const graphConfig = React.useMemo(() => {\n    const config = props.config ? props.config : new GraphConfig();\n    config.setX6Config();\n    return config;\n    /** 保证只生成一次 */\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  /** X6_NODE_PORTAL_NODE_VIEW */\n  const [Portal, setGraph] = usePortal(graphConfig.graphId);\n  React.useEffect(() => {\n    app && app.getGraphInstance().then(graph => {\n      setGraph(graph);\n    });\n  }, [app, setGraph]);\n  React.useEffect(() => {\n    /** 设置画布parent dom节点、画布dom节点 */\n    graphConfig.setRootContainer(rootRef.current);\n    graphConfig.setGraphContainer(canvasRef.current);\n    /** 关联XflowApp和Graph*/\n    graphConfig.xflowInstanceId = extensionRegistry.getInstanceId();\n    extensionRegistry.addCoreModule({\n      config: graphConfig,\n      createModule: createX6GraphModule\n    });\n    /** unmount */\n    const destroy = () => __awaiter(void 0, void 0, void 0, function* () {\n      graphConfig.dispose();\n    });\n    return () => {\n      destroy();\n    };\n    /** 保证只生成一次 */\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  const style = usePositionStyle(props.position);\n  const rootClz = useXflowPrefixCls('canvas-root');\n  const canvasClz = useXflowPrefixCls('x6-canvas');\n  return React.createElement(React.Fragment, null, React.createElement(\"div\", {\n    ref: rootRef,\n    className: rootClz,\n    style: style,\n    id: graphConfig.graphId,\n    tabIndex: 0\n  }, React.createElement(\"div\", {\n    ref: canvasRef,\n    className: canvasClz\n  }), props.children), React.createElement(Portal, null));\n};\nXFlowCanvas.defaultProps = {\n  isXFlowCanvas: true\n};","map":{"version":3,"names":["React","usePositionStyle","GraphConfig","createX6GraphModule","useExtensionRegistry","useXflowPrefixCls","usePortal","useXFlowApp","XFlowCanvas","props","app","rootRef","useRef","canvasRef","extensionRegistry","graphConfig","useMemo","config","setX6Config","Portal","setGraph","graphId","useEffect","getGraphInstance","then","graph","setRootContainer","current","setGraphContainer","xflowInstanceId","getInstanceId","addCoreModule","createModule","destroy","__awaiter","dispose","style","position","rootClz","canvasClz","createElement","Fragment","ref","className","id","tabIndex","children","defaultProps","isXFlowCanvas"],"sources":["../../../src/xflow-main/components/canvas.tsx"],"sourcesContent":[null],"mappings":";AAAA,OAAOA,KAAK,MAAM,OAAO;AAEzB,SAASC,gBAAgB,QAAQ,uBAAuB;AACxD,SAASC,WAAW,EAAEC,mBAAmB,QAAQ,UAAU;AAC3D,SAASC,oBAAoB,QAAQ,qBAAqB;AAC1D,SAASC,iBAAiB,QAAQ,yBAAyB;AAC3D,SAASC,SAAS,QAAQ,sBAAsB;AAChD,SAASC,WAAW,QAAQ,eAAe;AAU3C,OAAO,MAAMC,WAAW,GAAqBC,KAAK,IAAG;EACnD,MAAMC,GAAG,GAAGH,WAAW,EAAE;EAEzB;EACA,MAAMI,OAAO,GAAGX,KAAK,CAACY,MAAM,CAAiB,IAAI,CAAC;EAClD;EACA,MAAMC,SAAS,GAAGb,KAAK,CAACY,MAAM,CAAiB,IAAI,CAAC;EAEpD;EACA,MAAME,iBAAiB,GAAGV,oBAAoB,EAAE;EAEhD;EACA,MAAMW,WAAW,GAAGf,KAAK,CAACgB,OAAO,CAAc,MAAK;IAClD,MAAMC,MAAM,GAAGR,KAAK,CAACQ,MAAM,GAAGR,KAAK,CAACQ,MAAM,GAAG,IAAIf,WAAW,EAAE;IAC9De,MAAM,CAACC,WAAW,EAAE;IACpB,OAAOD,MAAM;IACb;IACA;EACF,CAAC,EAAE,EAAE,CAAC;EAEN;EACA,MAAM,CAACE,MAAM,EAAEC,QAAQ,CAAC,GAAGd,SAAS,CAACS,WAAW,CAACM,OAAO,CAAC;EAEzDrB,KAAK,CAACsB,SAAS,CAAC,MAAK;IACnBZ,GAAG,IACDA,GAAG,CAACa,gBAAgB,EAAE,CAACC,IAAI,CAACC,KAAK,IAAG;MAClCL,QAAQ,CAACK,KAAK,CAAC;IACjB,CAAC,CAAC;EACN,CAAC,EAAE,CAACf,GAAG,EAAEU,QAAQ,CAAC,CAAC;EAEnBpB,KAAK,CAACsB,SAAS,CAAC,MAAK;IACnB;IACAP,WAAW,CAACW,gBAAgB,CAACf,OAAO,CAACgB,OAAO,CAAC;IAC7CZ,WAAW,CAACa,iBAAiB,CAACf,SAAS,CAACc,OAAO,CAAC;IAEhD;IACAZ,WAAW,CAACc,eAAe,GAAGf,iBAAiB,CAACgB,aAAa,EAAE;IAC/DhB,iBAAiB,CAACiB,aAAa,CAAC;MAAEd,MAAM,EAAEF,WAAW;MAAEiB,YAAY,EAAE7B;IAAmB,CAAE,CAAC;IAE3F;IACA,MAAM8B,OAAO,GAAGA,CAAA,KAAWC,SAAA;MACzBnB,WAAW,CAACoB,OAAO,EAAE;IACvB,CAAC;IACD,OAAO,MAAK;MACVF,OAAO,EAAE;IACX,CAAC;IACD;IACA;EACF,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMG,KAAK,GAAGnC,gBAAgB,CAACQ,KAAK,CAAC4B,QAAQ,CAAC;EAC9C,MAAMC,OAAO,GAAGjC,iBAAiB,CAAC,aAAa,CAAC;EAChD,MAAMkC,SAAS,GAAGlC,iBAAiB,CAAC,WAAW,CAAC;EAEhD,OACEL,KAAA,CAAAwC,aAAA,CAACxC,KAAK,CAACyC,QAAQ,QACbzC,KAAA,CAAAwC,aAAA;IAAKE,GAAG,EAAE/B,OAAO;IAAEgC,SAAS,EAAEL,OAAO;IAAEF,KAAK,EAAEA,KAAK;IAAEQ,EAAE,EAAE7B,WAAW,CAACM,OAAO;IAAEwB,QAAQ,EAAE;EAAC,GACvF7C,KAAA,CAAAwC,aAAA;IAAKE,GAAG,EAAE7B,SAAS;IAAE8B,SAAS,EAAEJ;EAAS,EAAI,EAE5C9B,KAAK,CAACqC,QAAQ,CACX,EACN9C,KAAA,CAAAwC,aAAA,CAACrB,MAAM,OAAG,CACK;AAErB,CAAC;AAEDX,WAAW,CAACuC,YAAY,GAAG;EACzBC,aAAa,EAAE;CAChB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}