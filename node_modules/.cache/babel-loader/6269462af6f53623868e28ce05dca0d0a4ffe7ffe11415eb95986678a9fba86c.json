{"ast":null,"code":"import React from 'react';\nimport { find, get } from 'lodash';\nimport { Disposable } from '../../common/disposable';\nimport { uuidv4 } from '../../common/uuid';\n/** 保存组件上的配置 */\nexport class ExtensionRegistry {\n  constructor() {\n    this.extensions = [];\n    this.containerClassNames = new Set();\n    this.addCoreModule = extension => {\n      // core module 添加在前面\n      this.extensions.unshift(extension);\n      return Disposable.create(() => {\n        this.removeExtension(extension);\n      });\n    };\n    this.addExtension = extension => {\n      this.extensions.push(extension);\n      return Disposable.create(() => {\n        this.removeExtension(extension);\n      });\n    };\n    this.getExtension = config_type => {\n      return find(this.extensions, extension => get(extension, 'config.CONFIG_TYPE') === config_type);\n    };\n    this.removeExtension = extension => {\n      const idx = this.extensions.indexOf(extension);\n      if (idx > -1) {\n        this.extensions.splice(idx, 1);\n      }\n    };\n    this.getInstanceId = () => {\n      return this.instanceId;\n    };\n    this.addContainerClassNames = clz => {\n      return this.containerClassNames.add(clz);\n    };\n    this.getContainerClassNames = () => {\n      return Array.from(this.containerClassNames);\n    };\n    this.getAllExtensions = () => {\n      return this.extensions;\n    };\n    this.getAllExtensionConfigs = () => {\n      return this.extensions.map(i => i.config);\n    };\n    this.instanceId = uuidv4();\n  }\n  has(name) {\n    return this.extensions.some(ext => ext.config.CONFIG_TYPE === name);\n  }\n}\n/** 获取Xflow extension，用于收集React组件的配置 */\nexport const createExtensionRegistry = () => {\n  /* eslint-disable-next-line react-hooks/rules-of-hooks */\n  const registry = React.useMemo(() => {\n    return new ExtensionRegistry();\n  }, []);\n  return registry;\n};","map":{"version":3,"names":["React","find","get","Disposable","uuidv4","ExtensionRegistry","constructor","extensions","containerClassNames","Set","addCoreModule","extension","unshift","create","removeExtension","addExtension","push","getExtension","config_type","idx","indexOf","splice","getInstanceId","instanceId","addContainerClassNames","clz","add","getContainerClassNames","Array","from","getAllExtensions","getAllExtensionConfigs","map","i","config","has","name","some","ext","CONFIG_TYPE","createExtensionRegistry","registry","useMemo"],"sources":["../../../src/xflow-main/components/extension-registry.tsx"],"sourcesContent":[null],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,SAASC,IAAI,EAAEC,GAAG,QAAQ,QAAQ;AAClC,SAASC,UAAU,QAAQ,yBAAyB;AACpD,SAASC,MAAM,QAAQ,mBAAmB;AAG1C;AACA,OAAM,MAAOC,iBAAiB;EAQ5BC,YAAA;IAJS,KAAAC,UAAU,GAAuB,EAAE;IAEnC,KAAAC,mBAAmB,GAAgB,IAAIC,GAAG,EAAE;IAMrD,KAAAC,aAAa,GAAIC,SAA2B,IAAI;MAC9C;MACA,IAAI,CAACJ,UAAU,CAACK,OAAO,CAACD,SAAS,CAAC;MAClC,OAAOR,UAAU,CAACU,MAAM,CAAC,MAAK;QAC5B,IAAI,CAACC,eAAe,CAACH,SAAS,CAAC;MACjC,CAAC,CAAC;IACJ,CAAC;IAED,KAAAI,YAAY,GAAIJ,SAA2B,IAAI;MAC7C,IAAI,CAACJ,UAAU,CAACS,IAAI,CAACL,SAAS,CAAC;MAC/B,OAAOR,UAAU,CAACU,MAAM,CAAC,MAAK;QAC5B,IAAI,CAACC,eAAe,CAACH,SAAS,CAAC;MACjC,CAAC,CAAC;IACJ,CAAC;IAED,KAAAM,YAAY,GAAIC,WAAmB,IAAI;MACrC,OAAOjB,IAAI,CAAC,IAAI,CAACM,UAAU,EAAEI,SAAS,IAAIT,GAAG,CAACS,SAAS,EAAE,oBAAoB,CAAC,KAAKO,WAAW,CAAC;IACjG,CAAC;IAED,KAAAJ,eAAe,GAAIH,SAA2B,IAAI;MAChD,MAAMQ,GAAG,GAAG,IAAI,CAACZ,UAAU,CAACa,OAAO,CAACT,SAAS,CAAC;MAC9C,IAAIQ,GAAG,GAAG,CAAC,CAAC,EAAE;QACZ,IAAI,CAACZ,UAAU,CAACc,MAAM,CAACF,GAAG,EAAE,CAAC,CAAC;;IAElC,CAAC;IAED,KAAAG,aAAa,GAAG,MAAK;MACnB,OAAO,IAAI,CAACC,UAAU;IACxB,CAAC;IAED,KAAAC,sBAAsB,GAAIC,GAAW,IAAI;MACvC,OAAO,IAAI,CAACjB,mBAAmB,CAACkB,GAAG,CAACD,GAAG,CAAC;IAC1C,CAAC;IAED,KAAAE,sBAAsB,GAAG,MAAK;MAC5B,OAAOC,KAAK,CAACC,IAAI,CAAC,IAAI,CAACrB,mBAAmB,CAAC;IAC7C,CAAC;IAMD,KAAAsB,gBAAgB,GAAG,MAAK;MACtB,OAAO,IAAI,CAACvB,UAAU;IACxB,CAAC;IAED,KAAAwB,sBAAsB,GAAG,MAAK;MAC5B,OAAO,IAAI,CAACxB,UAAU,CAACyB,GAAG,CAACC,CAAC,IAAIA,CAAC,CAACC,MAAM,CAAC;IAC3C,CAAC;IAnDC,IAAI,CAACX,UAAU,GAAGnB,MAAM,EAAE;EAC5B;EAwCA+B,GAAGA,CAACC,IAAY;IACd,OAAO,IAAI,CAAC7B,UAAU,CAAC8B,IAAI,CAACC,GAAG,IAAIA,GAAG,CAACJ,MAAM,CAACK,WAAW,KAAKH,IAAI,CAAC;EACrE;;AAWF;AACA,OAAO,MAAMI,uBAAuB,GAAGA,CAAA,KAAK;EAC1C;EACA,MAAMC,QAAQ,GAAGzC,KAAK,CAAC0C,OAAO,CAAC,MAAK;IAClC,OAAO,IAAIrC,iBAAiB,EAAE;EAChC,CAAC,EAAE,EAAE,CAAC;EACN,OAAOoC,QAAQ;AACjB,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}