{"ast":null,"code":"import { __awaiter, __decorate, __metadata } from \"tslib\";\nimport { inject, injectable } from 'mana-syringe';\nimport { ICommandHandler, ICommandContextProvider } from '../../command/interface';\nimport { XFlowGraphCommands } from '../constant';\nexport var NsGraphDelTool;\n(function (NsGraphDelTool) {\n  /** Command: 用于注册named factory */\n  NsGraphDelTool.command = XFlowGraphCommands.GRAPH_DEL_TOOL;\n  /** hookName */\n  NsGraphDelTool.hookKey = 'delTool';\n})(NsGraphDelTool || (NsGraphDelTool = {}));\nlet GraphDelToolCommand = class GraphDelToolCommand {\n  constructor() {\n    /** 执行Cmd */\n    this.execute = () => __awaiter(this, void 0, void 0, function* () {\n      const ctx = this.contextProvider();\n      const {\n        args,\n        hooks: runtimeHook\n      } = ctx.getArgs();\n      const hooks = ctx.getHooks();\n      const result = yield hooks.delTool.call(args, handlerArgs => __awaiter(this, void 0, void 0, function* () {\n        const {\n          cellId,\n          toolName,\n          toolConfig\n        } = handlerArgs;\n        const graph = yield ctx.getX6Graph();\n        const cell = graph.getCellById(cellId);\n        if (cell) {\n          if (toolName === '*') {\n            cell.removeTools(toolConfig);\n          } else {\n            cell.removeTool(toolName, toolConfig);\n          }\n        }\n        return {\n          err: null\n        };\n      }), runtimeHook);\n      ctx.setResult(result);\n      return this;\n    });\n    /** undo cmd */\n    this.undo = () => __awaiter(this, void 0, void 0, function* () {\n      const ctx = this.contextProvider();\n      if (this.isUndoable()) {\n        ctx.undo();\n      }\n      return this;\n    });\n    /** redo cmd */\n    this.redo = () => __awaiter(this, void 0, void 0, function* () {\n      if (!this.isUndoable()) {\n        yield this.execute();\n      }\n      return this;\n    });\n  }\n  isUndoable() {\n    const ctx = this.contextProvider();\n    return ctx.isUndoable();\n  }\n};\n__decorate([inject(ICommandContextProvider), __metadata(\"design:type\", Object)], GraphDelToolCommand.prototype, \"contextProvider\", void 0);\nGraphDelToolCommand = __decorate([injectable({\n  token: {\n    token: ICommandHandler,\n    named: NsGraphDelTool.command.id\n  }\n})\n/** 创建节点命令 */], GraphDelToolCommand);\nexport { GraphDelToolCommand };","map":{"version":3,"names":["inject","injectable","ICommandHandler","ICommandContextProvider","XFlowGraphCommands","NsGraphDelTool","command","GRAPH_DEL_TOOL","hookKey","GraphDelToolCommand","constructor","execute","__awaiter","ctx","contextProvider","args","hooks","runtimeHook","getArgs","getHooks","result","delTool","call","handlerArgs","cellId","toolName","toolConfig","graph","getX6Graph","cell","getCellById","removeTools","removeTool","err","setResult","undo","isUndoable","redo","__decorate","token","named","id"],"sources":["../../../src/command-contributions/graph/graph-del-tool.ts"],"sourcesContent":[null],"mappings":";AACA,SAASA,MAAM,EAAEC,UAAU,QAAQ,cAAc;AAKjD,SAASC,eAAe,EAAEC,uBAAuB,QAAQ,yBAAyB;AAClF,SAASC,kBAAkB,QAAQ,aAAa;AAQhD,OAAM,IAAWC,cAAc;AAA/B,WAAiBA,cAAc;EAC7B;EACaA,cAAA,CAAAC,OAAO,GAAGF,kBAAkB,CAACG,cAAc;EACxD;EACaF,cAAA,CAAAG,OAAO,GAAG,SAAS;AAuBlC,CAAC,EA3BgBH,cAAc,KAAdA,cAAc;AAiCxB,IAAMI,mBAAmB,GAAzB,MAAMA,mBAAmB;EAAzBC,YAAA;IAIL;IACA,KAAAC,OAAO,GAAG,MAAWC,SAAA;MACnB,MAAMC,GAAG,GAAG,IAAI,CAACC,eAAe,EAAE;MAClC,MAAM;QAAEC,IAAI;QAAEC,KAAK,EAAEC;MAAW,CAAE,GAAGJ,GAAG,CAACK,OAAO,EAAE;MAClD,MAAMF,KAAK,GAAGH,GAAG,CAACM,QAAQ,EAAE;MAE5B,MAAMC,MAAM,GAAG,MAAMJ,KAAK,CAACK,OAAO,CAACC,IAAI,CACrCP,IAAI,EACEQ,WAAW,IAAGX,SAAA;QAClB,MAAM;UAAEY,MAAM;UAAEC,QAAQ;UAAEC;QAAU,CAAE,GAAGH,WAAW;QACpD,MAAMI,KAAK,GAAG,MAAMd,GAAG,CAACe,UAAU,EAAE;QACpC,MAAMC,IAAI,GAAGF,KAAK,CAACG,WAAW,CAACN,MAAM,CAAC;QACtC,IAAIK,IAAI,EAAE;UACR,IAAIJ,QAAQ,KAAK,GAAG,EAAE;YACpBI,IAAI,CAACE,WAAW,CAACL,UAAU,CAAC;WAC7B,MAAM;YACLG,IAAI,CAACG,UAAU,CAACP,QAAQ,EAAEC,UAAU,CAAC;;;QAGzC,OAAO;UAAEO,GAAG,EAAE;QAAI,CAAE;MACtB,CAAC,GACDhB,WAAW,CACZ;MAEDJ,GAAG,CAACqB,SAAS,CAACd,MAAM,CAAC;MAErB,OAAO,IAAI;IACb,CAAC;IAED;IACA,KAAAe,IAAI,GAAG,MAAWvB,SAAA;MAChB,MAAMC,GAAG,GAAG,IAAI,CAACC,eAAe,EAAE;MAClC,IAAI,IAAI,CAACsB,UAAU,EAAE,EAAE;QACrBvB,GAAG,CAACsB,IAAI,EAAE;;MAEZ,OAAO,IAAI;IACb,CAAC;IAED;IACA,KAAAE,IAAI,GAAG,MAAWzB,SAAA;MAChB,IAAI,CAAC,IAAI,CAACwB,UAAU,EAAE,EAAE;QACtB,MAAM,IAAI,CAACzB,OAAO,EAAE;;MAEtB,OAAO,IAAI;IACb,CAAC;EAMH;EAJEyB,UAAUA,CAAA;IACR,MAAMvB,GAAG,GAAG,IAAI,CAACC,eAAe,EAAE;IAClC,OAAOD,GAAG,CAACuB,UAAU,EAAE;EACzB;CACD;AApDCE,UAAA,EAACtC,MAAM,CAACG,uBAAuB,CAAC,E,6FAA6C;AAFlEM,mBAAmB,GAAA6B,UAAA,EAJ/BrC,UAAU,CAAC;EACVsC,KAAK,EAAE;IAAEA,KAAK,EAAErC,eAAe;IAAEsC,KAAK,EAAEnC,cAAc,CAACC,OAAO,CAACmC;EAAE;CAClE;AACD,c,EACahC,mBAAmB,CAsD/B;SAtDYA,mBAAmB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}