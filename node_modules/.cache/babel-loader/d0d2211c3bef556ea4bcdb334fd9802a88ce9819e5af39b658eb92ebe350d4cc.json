{"ast":null,"code":"var __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n    r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n    d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport Mousetrap from 'mousetrap';\nimport { Dom, FunctionExt } from '../util';\nimport { Disposable } from '../common';\nexport class Keyboard extends Disposable {\n  constructor(options) {\n    super();\n    this.options = options;\n    const scroller = this.graph.scroller.widget;\n    this.container = scroller ? scroller.container : this.graph.container;\n    if (options.global) {\n      this.target = document;\n    } else {\n      this.target = this.container;\n      if (!this.disabled) {\n        // ensure the container focusable\n        this.target.setAttribute('tabindex', '-1');\n      }\n      // change to mouseup event，prevent page stalling caused by focus\n      this.graph.on('cell:mouseup', this.focus, this);\n      this.graph.on('blank:mouseup', this.focus, this);\n    }\n    this.mousetrap = Keyboard.createMousetrap(this);\n  }\n  get graph() {\n    return this.options.graph;\n  }\n  get disabled() {\n    return this.options.enabled !== true;\n  }\n  enable() {\n    if (this.disabled) {\n      this.options.enabled = true;\n      this.graph.options.keyboard.enabled = true;\n      if (this.target instanceof HTMLElement) {\n        this.target.setAttribute('tabindex', '-1');\n      }\n    }\n  }\n  disable() {\n    if (!this.disabled) {\n      this.options.enabled = false;\n      this.graph.options.keyboard.enabled = false;\n      if (this.target instanceof HTMLElement) {\n        this.target.removeAttribute('tabindex');\n      }\n    }\n  }\n  on(keys, callback, action) {\n    this.mousetrap.bind(this.getKeys(keys), callback, action);\n  }\n  off(keys, action) {\n    this.mousetrap.unbind(this.getKeys(keys), action);\n  }\n  focus(e) {\n    const isInputEvent = this.isInputEvent(e.e);\n    if (isInputEvent) {\n      return;\n    }\n    const target = this.target;\n    target.focus({\n      preventScroll: true\n    });\n  }\n  getKeys(keys) {\n    return (Array.isArray(keys) ? keys : [keys]).map(key => this.formatkey(key));\n  }\n  formatkey(key) {\n    const formated = key.toLowerCase().replace(/\\s/g, '').replace('delete', 'del').replace('cmd', 'command');\n    const formatFn = this.options.format;\n    if (formatFn) {\n      return FunctionExt.call(formatFn, this.graph, formated);\n    }\n    return formated;\n  }\n  isGraphEvent(e) {\n    const target = e.srcElement || e.target;\n    const currentTarget = e.currentTarget;\n    if (target) {\n      if (target === this.target || currentTarget === this.target || target === document.body) {\n        return true;\n      }\n      return Dom.contains(this.container, target);\n    }\n    return false;\n  }\n  isInputEvent(e) {\n    var _a;\n    const target = e.target;\n    const tagName = (_a = target === null || target === void 0 ? void 0 : target.tagName) === null || _a === void 0 ? void 0 : _a.toLowerCase();\n    return ['input', 'textarea'].includes(tagName);\n  }\n  isEnabledForEvent(e) {\n    const allowed = !this.disabled && this.isGraphEvent(e);\n    const isInputEvent = this.isInputEvent(e);\n    if (allowed) {\n      const code = e.keyCode || e.which;\n      if (isInputEvent && (code === 8 || code === 46)) {\n        return false;\n      }\n      if (this.options.guard) {\n        return FunctionExt.call(this.options.guard, this.graph, e);\n      }\n    }\n    return allowed;\n  }\n  dispose() {\n    this.mousetrap.reset();\n  }\n}\n__decorate([Disposable.dispose()], Keyboard.prototype, \"dispose\", null);\n(function (Keyboard) {\n  function createMousetrap(keyboard) {\n    const mousetrap = new Mousetrap(keyboard.target);\n    const stopCallback = mousetrap.stopCallback;\n    mousetrap.stopCallback = (e, elem, combo) => {\n      if (keyboard.isEnabledForEvent(e)) {\n        if (stopCallback) {\n          return stopCallback.call(mousetrap, e, elem, combo);\n        }\n        return false;\n      }\n      return true;\n    };\n    return mousetrap;\n  }\n  Keyboard.createMousetrap = createMousetrap;\n})(Keyboard || (Keyboard = {}));","map":{"version":3,"names":["Mousetrap","Dom","FunctionExt","Disposable","Keyboard","constructor","options","scroller","graph","widget","container","global","target","document","disabled","setAttribute","on","focus","mousetrap","createMousetrap","enabled","enable","keyboard","HTMLElement","disable","removeAttribute","keys","callback","action","bind","getKeys","off","unbind","e","isInputEvent","preventScroll","Array","isArray","map","key","formatkey","formated","toLowerCase","replace","formatFn","format","call","isGraphEvent","srcElement","currentTarget","body","contains","tagName","_a","includes","isEnabledForEvent","allowed","code","keyCode","which","guard","dispose","reset","__decorate","stopCallback","elem","combo"],"sources":["/Users/bhanudahiya/Desktop/ledger-IQ/node_modules/@antv/x6/src/graph/keyboard.ts"],"sourcesContent":["import Mousetrap from 'mousetrap'\nimport { Dom, FunctionExt } from '../util'\nimport { Disposable, IDisablable } from '../common'\nimport { Graph } from './graph'\nimport { EventArgs } from './events'\n\nexport class Keyboard extends Disposable implements IDisablable {\n  public readonly target: HTMLElement | Document\n  public readonly container: HTMLElement\n  public readonly mousetrap: Mousetrap.MousetrapInstance\n\n  protected get graph() {\n    return this.options.graph\n  }\n\n  constructor(public readonly options: Keyboard.Options) {\n    super()\n\n    const scroller = this.graph.scroller.widget\n    this.container = scroller ? scroller.container : this.graph.container\n\n    if (options.global) {\n      this.target = document\n    } else {\n      this.target = this.container\n      if (!this.disabled) {\n        // ensure the container focusable\n        this.target.setAttribute('tabindex', '-1')\n      }\n\n      // change to mouseup event，prevent page stalling caused by focus\n      this.graph.on('cell:mouseup', this.focus, this)\n      this.graph.on('blank:mouseup', this.focus, this)\n    }\n\n    this.mousetrap = Keyboard.createMousetrap(this)\n  }\n\n  get disabled() {\n    return this.options.enabled !== true\n  }\n\n  enable() {\n    if (this.disabled) {\n      this.options.enabled = true\n      this.graph.options.keyboard.enabled = true\n      if (this.target instanceof HTMLElement) {\n        this.target.setAttribute('tabindex', '-1')\n      }\n    }\n  }\n\n  disable() {\n    if (!this.disabled) {\n      this.options.enabled = false\n      this.graph.options.keyboard.enabled = false\n      if (this.target instanceof HTMLElement) {\n        this.target.removeAttribute('tabindex')\n      }\n    }\n  }\n\n  on(\n    keys: string | string[],\n    callback: Keyboard.Handler,\n    action?: Keyboard.Action,\n  ) {\n    this.mousetrap.bind(this.getKeys(keys), callback, action)\n  }\n\n  off(keys: string | string[], action?: Keyboard.Action) {\n    this.mousetrap.unbind(this.getKeys(keys), action)\n  }\n\n  private focus(e: EventArgs['node:mouseup']) {\n    const isInputEvent = this.isInputEvent(e.e)\n    if (isInputEvent) {\n      return\n    }\n    const target = this.target as HTMLElement\n    target.focus({\n      preventScroll: true,\n    })\n  }\n\n  private getKeys(keys: string | string[]) {\n    return (Array.isArray(keys) ? keys : [keys]).map((key) =>\n      this.formatkey(key),\n    )\n  }\n\n  protected formatkey(key: string) {\n    const formated = key\n      .toLowerCase()\n      .replace(/\\s/g, '')\n      .replace('delete', 'del')\n      .replace('cmd', 'command')\n\n    const formatFn = this.options.format\n    if (formatFn) {\n      return FunctionExt.call(formatFn, this.graph, formated)\n    }\n\n    return formated\n  }\n\n  protected isGraphEvent(e: KeyboardEvent) {\n    const target = (e.srcElement || e.target) as Element\n    const currentTarget = e.currentTarget as Element\n    if (target) {\n      if (\n        target === this.target ||\n        currentTarget === this.target ||\n        target === document.body\n      ) {\n        return true\n      }\n\n      return Dom.contains(this.container, target)\n    }\n\n    return false\n  }\n\n  isInputEvent(e: KeyboardEvent | JQuery.MouseUpEvent) {\n    const target = e.target as Element\n    const tagName = target?.tagName?.toLowerCase()\n    return ['input', 'textarea'].includes(tagName)\n  }\n\n  isEnabledForEvent(e: KeyboardEvent) {\n    const allowed = !this.disabled && this.isGraphEvent(e)\n    const isInputEvent = this.isInputEvent(e)\n    if (allowed) {\n      const code = e.keyCode || e.which\n      if (isInputEvent && (code === 8 || code === 46)) {\n        return false\n      }\n      if (this.options.guard) {\n        return FunctionExt.call(this.options.guard, this.graph, e)\n      }\n    }\n    return allowed\n  }\n\n  @Disposable.dispose()\n  dispose() {\n    this.mousetrap.reset()\n  }\n}\n\nexport namespace Keyboard {\n  export type Action = 'keypress' | 'keydown' | 'keyup'\n  export type Handler = (e: KeyboardEvent) => void\n\n  export interface Options {\n    graph: Graph\n    enabled?: boolean\n\n    /**\n     * Specifies if keyboard event should bind on docuemnt or on container.\n     *\n     * Default is `false` that will bind keyboard event on the container.\n     */\n    global?: boolean\n\n    format?: (this: Graph, key: string) => string\n    guard?: (this: Graph, e: KeyboardEvent) => boolean\n  }\n}\n\nexport namespace Keyboard {\n  export function createMousetrap(keyboard: Keyboard) {\n    const mousetrap = new Mousetrap(keyboard.target as Element)\n    const stopCallback = mousetrap.stopCallback\n    mousetrap.stopCallback = (\n      e: KeyboardEvent,\n      elem: HTMLElement,\n      combo: string,\n    ) => {\n      if (keyboard.isEnabledForEvent(e)) {\n        if (stopCallback) {\n          return stopCallback.call(mousetrap, e, elem, combo)\n        }\n        return false\n      }\n      return true\n    }\n\n    return mousetrap\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}