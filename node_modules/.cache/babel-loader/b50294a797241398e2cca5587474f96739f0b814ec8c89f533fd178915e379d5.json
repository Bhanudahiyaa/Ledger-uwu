{"ast":null,"code":"import 'reflect-metadata';\n/** Application 扩展依赖 */\nimport { ICommandHandler, IGraphCommandFactory, ICommandContextProvider } from '../command/interface';\nimport { Module } from 'mana-syringe';\nimport { CmdContext } from './cmd-context';\nimport { registerCommandConfig } from './config';\nimport { registerXFlowCommandContribution } from './command-contribution';\nimport { GraphMappingHelper } from './mapping-service';\n/** 依赖扩展模块，必须要加载 */\nexport const createModule = commandConfig => {\n  return Module(register => {\n    /** 注册 mapping helper */\n    register(GraphMappingHelper);\n    /** 注册 CommandConfig */\n    registerCommandConfig(register, commandConfig);\n    /** 注册 Command扩展 */\n    registerXFlowCommandContribution(register, commandConfig);\n    /** 注册 Context Clz */\n    register(CmdContext);\n    /** ICommandHandler 工厂 */\n    register(IGraphCommandFactory, {\n      useFactory: context => {\n        return (commandId, args, hook) => {\n          const child = context.container.createChild();\n          /** 实例化 Context */\n          const cmdContext = child.get(CmdContext);\n          /** 绑定 CommandContext 工厂类 */\n          child.register(ICommandContextProvider, {\n            useDynamic: () => {\n              return () => cmdContext;\n            }\n          });\n          /** 实例化CommandHandler */\n          const commandHandler = child.getNamed(ICommandHandler, commandId);\n          /** 设置参数 */\n          cmdContext.setArgs(args, hook);\n          /** 绑定关系 */\n          cmdContext.handlerInstance = commandHandler;\n          return commandHandler;\n        };\n      }\n    });\n  });\n};","map":{"version":3,"names":["ICommandHandler","IGraphCommandFactory","ICommandContextProvider","Module","CmdContext","registerCommandConfig","registerXFlowCommandContribution","GraphMappingHelper","createModule","commandConfig","register","useFactory","context","commandId","args","hook","child","container","createChild","cmdContext","get","useDynamic","commandHandler","getNamed","setArgs","handlerInstance"],"sources":["../../src/command-contributions/module.ts"],"sourcesContent":[null],"mappings":"AAAA,OAAO,kBAAkB;AACzB;AACA,SACEA,eAAe,EACfC,oBAAoB,EACpBC,uBAAuB,QAClB,sBAAsB;AAC7B,SAASC,MAAM,QAAQ,cAAc;AACrC,SAASC,UAAU,QAAQ,eAAe;AAK1C,SAASC,qBAAqB,QAAQ,UAAU;AAChD,SAASC,gCAAgC,QAAQ,wBAAwB;AACzE,SAASC,kBAAkB,QAAQ,mBAAmB;AAEtD;AACA,OAAO,MAAMC,YAAY,GAAIC,aAA4B,IAAI;EAC3D,OAAON,MAAM,CAACO,QAAQ,IAAG;IACvB;IACAA,QAAQ,CAACH,kBAAkB,CAAC;IAE5B;IACAF,qBAAqB,CAACK,QAAQ,EAAED,aAAa,CAAC;IAE9C;IACAH,gCAAgC,CAACI,QAAQ,EAAED,aAAa,CAAC;IAEzD;IACAC,QAAQ,CAAaN,UAAU,CAAC;IAEhC;IACAM,QAAQ,CAAkBT,oBAAoB,EAAE;MAC9CU,UAAU,EAAEC,OAAO,IAAG;QACpB,OAAO,CAACC,SAAiB,EAAEC,IAAS,EAAEC,IAAkB,KAAI;UAC1D,MAAMC,KAAK,GAAGJ,OAAO,CAACK,SAAS,CAACC,WAAW,EAAE;UAC7C;UACA,MAAMC,UAAU,GAAGH,KAAK,CAACI,GAAG,CAAahB,UAAU,CAAC;UACpD;UACAY,KAAK,CAACN,QAAQ,CAA0BR,uBAAuB,EAAE;YAC/DmB,UAAU,EAAEA,CAAA,KAAK;cACf,OAAO,MAAMF,UAAU;YACzB;WACD,CAAC;UACF;UACA,MAAMG,cAAc,GAAGN,KAAK,CAACO,QAAQ,CAAkBvB,eAAe,EAAEa,SAAS,CAAC;UAClF;UACAM,UAAU,CAACK,OAAO,CAACV,IAAI,EAAEC,IAAI,CAAC;UAC9B;UACAI,UAAU,CAACM,eAAe,GAAGH,cAAc;UAC3C,OAAOA,cAAc;QACvB,CAAC;MACH;KACD,CAAC;EACJ,CAAC,CAAC;AACJ,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}