{"ast":null,"code":"import { __awaiter, __decorate, __metadata } from \"tslib\";\nimport { injectable, inject, postConstruct } from 'mana-syringe';\nimport { DisposableCollection } from '../common/disposable';\nimport { IGraphProvider } from '../xflow-main/graph/graph-provider';\nimport { IModelService, MODELS } from '../model-service';\nimport { IGraphCommandService } from '../command/interface';\nimport { IHookService } from '../hooks';\nlet CmdContext = class CmdContext {\n  constructor() {\n    /** undos 存在这里 */\n    this.toDispose = new DisposableCollection();\n    /** command handler的runtimeHook */\n    this.runtimeHooks = [];\n    /** 获取 x6 实例 */\n    this.getX6Graph = () => __awaiter(this, void 0, void 0, function* () {\n      if (this.graph) return this.graph;\n      const graphInstance = yield this.graphProvider.getGraphInstance();\n      this.graph = graphInstance;\n      return graphInstance;\n    });\n    /** 获取 graph */\n    this.getGraphConfig = () => __awaiter(this, void 0, void 0, function* () {\n      return this.graphProvider.getGraphOptions();\n    });\n    /** 获取 graphMeta */\n    this.getGraphMeta = () => __awaiter(this, void 0, void 0, function* () {\n      const service = this.getModelService();\n      const meta = this.graphMeta || (yield MODELS.GRAPH_META.useValue(service));\n      return meta;\n    });\n    /** 设置参数 */\n    this.setArgs = (args, runtimeHooks = []) => {\n      this.args = args;\n      this.runtimeHooks = runtimeHooks;\n      return {\n        args,\n        hooks: runtimeHooks\n      };\n    };\n    /** 获取参数 */\n    this.getArgs = () => {\n      /** 注入graph meta */\n      const args = Object.assign(Object.assign({}, this.args), {\n        modelService: this.getModelService(),\n        commandService: this.getCommands(),\n        getGraphMeta: this.getGraphMeta,\n        getX6Graph: this.getX6Graph,\n        getGraphConfig: this.getGraphConfig\n      });\n      return {\n        args: args,\n        hooks: this.runtimeHooks\n      };\n    };\n    /** 设置执行结果 */\n    this.setResult = result => {\n      this.result = result;\n      return this.result;\n    };\n    /** 获取执行结果 */\n    this.getResult = () => {\n      return this.result;\n    };\n    /** hooks */\n    this.getHooks = () => {\n      return this.hookService.hookProvider();\n    };\n    /** 获取Command Service */\n    this.getCommands = () => {\n      return this.commandService;\n    };\n    /** 获取Context Service */\n    this.getModelService = () => {\n      return this.modelService;\n    };\n    /** 添加undo */\n    this.addUndo = disposable => {\n      if (!Array.isArray(disposable)) {\n        return this.addUndo([disposable]);\n      }\n      this.toDispose.pushAll(disposable);\n    };\n    /** 执行undo */\n    this.undo = () => __awaiter(this, void 0, void 0, function* () {\n      yield this.toDispose.dispose();\n    });\n    /** 是否可以执行undo */\n    this.isUndoable = () => {\n      return !this.toDispose.disposed;\n    };\n    /** 获取 toDispose */\n    this.getDisposables = () => this.toDispose;\n    /** 设置的共享变量 可以在command间共享 */\n    this.setGlobal = (key, value) => {\n      this.commandService.setGlobal(key, value);\n    };\n    /** 获取共享变量 */\n    this.getGlobal = key => {\n      return this.commandService.getGlobal(key);\n    };\n  }\n  init() {\n    this.getGraphMeta().then(meta => {\n      this.graphMeta = meta;\n    });\n  }\n};\n__decorate([inject(IGraphProvider), __metadata(\"design:type\", Object)], CmdContext.prototype, \"graphProvider\", void 0);\n__decorate([inject(IHookService), __metadata(\"design:type\", Object)], CmdContext.prototype, \"hookService\", void 0);\n__decorate([inject(IGraphCommandService), __metadata(\"design:type\", Object)], CmdContext.prototype, \"commandService\", void 0);\n__decorate([inject(IModelService), __metadata(\"design:type\", Object)], CmdContext.prototype, \"modelService\", void 0);\n__decorate([postConstruct(), __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", []), __metadata(\"design:returntype\", void 0)], CmdContext.prototype, \"init\", null);\nCmdContext = __decorate([injectable()], CmdContext);\nexport { CmdContext };","map":{"version":3,"names":["injectable","inject","postConstruct","DisposableCollection","IGraphProvider","IModelService","MODELS","IGraphCommandService","IHookService","CmdContext","constructor","toDispose","runtimeHooks","getX6Graph","__awaiter","graph","graphInstance","graphProvider","getGraphInstance","getGraphConfig","getGraphOptions","getGraphMeta","service","getModelService","meta","graphMeta","GRAPH_META","useValue","setArgs","args","hooks","getArgs","Object","assign","modelService","commandService","getCommands","setResult","result","getResult","getHooks","hookService","hookProvider","addUndo","disposable","Array","isArray","pushAll","undo","dispose","isUndoable","disposed","getDisposables","setGlobal","key","value","getGlobal","init","then","__decorate"],"sources":["../../src/command-contributions/cmd-context.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}