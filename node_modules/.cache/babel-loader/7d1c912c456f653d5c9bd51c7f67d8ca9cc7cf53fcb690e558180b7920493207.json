{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nexport var PassNode = /*#__PURE__*/function () {\n  function PassNode() {\n    _classCallCheck(this, PassNode);\n    this.name = void 0;\n    this.refCount = 0;\n    this.hasSideEffect = false;\n    this.devirtualize = [];\n    this.destroy = [];\n    this.reads = [];\n    this.writes = [];\n  }\n  _createClass(PassNode, [{\n    key: \"read\",\n    value: function read(handle) {\n      if (!this.reads.find(function (h) {\n        return h.index === handle.index;\n      })) {\n        this.reads.push(handle);\n      }\n      return handle;\n    }\n  }, {\n    key: \"sample\",\n    value: function sample(handle) {\n      this.read(handle); // TODO: 记录在 this.samples 中\n\n      return handle;\n    }\n  }, {\n    key: \"write\",\n    value: function write(fg, handle) {\n      var existed = this.writes.find(function (h) {\n        return h.index === handle.index;\n      });\n      if (existed) {\n        return handle;\n      }\n      var node = fg.getResourceNode(handle);\n      node.resource.version++;\n      if (node.resource.imported) {\n        this.hasSideEffect = true;\n      }\n      var r = fg.createResourceNode(node.resource);\n      var newNode = fg.getResourceNode(r);\n      newNode.writer = this;\n      this.writes.push(r);\n      return r;\n    }\n  }]);\n  return PassNode;\n}();","map":{"version":3,"names":["PassNode","_classCallCheck","name","refCount","hasSideEffect","devirtualize","destroy","reads","writes","_createClass","key","value","read","handle","find","h","index","push","sample","write","fg","existed","node","getResourceNode","resource","version","imported","r","createResourceNode","newNode","writer"],"sources":["/Users/bhanudahiya/Desktop/ledger-IQ/node_modules/@antv/g-webgpu-core/src/components/framegraph/PassNode.ts"],"sourcesContent":["import { FrameGraphHandle } from './FrameGraphHandle';\nimport { FrameGraphSystem } from './System';\nimport { VirtualResource } from './VirtualResource';\n\nexport class PassNode {\n  public name: string;\n  /**\n   * count resources that have a reference to this pass node\n   */\n  public refCount = 0;\n\n  /**\n   * set by FG system\n   */\n  public hasSideEffect = false;\n\n  /**\n   * during FG's compile, create before executing\n   */\n  public devirtualize: VirtualResource[] = [];\n\n  /**\n   * during FG's compile, destroy after executing\n   */\n  public destroy: VirtualResource[] = [];\n\n  public reads: FrameGraphHandle[] = [];\n\n  public writes: FrameGraphHandle[] = [];\n\n  public read(handle: FrameGraphHandle): FrameGraphHandle {\n    if (!this.reads.find((h) => h.index === handle.index)) {\n      this.reads.push(handle);\n    }\n    return handle;\n  }\n\n  public sample(handle: FrameGraphHandle) {\n    this.read(handle);\n    // TODO: 记录在 this.samples 中\n    return handle;\n  }\n\n  public write(\n    fg: FrameGraphSystem,\n    handle: FrameGraphHandle,\n  ): FrameGraphHandle {\n    const existed = this.writes.find((h) => h.index === handle.index);\n    if (existed) {\n      return handle;\n    }\n\n    const node = fg.getResourceNode(handle);\n\n    node.resource.version++;\n\n    if (node.resource.imported) {\n      this.hasSideEffect = true;\n    }\n\n    const r = fg.createResourceNode(node.resource);\n    const newNode = fg.getResourceNode(r);\n\n    newNode.writer = this;\n\n    this.writes.push(r);\n    return r;\n  }\n}\n"],"mappings":";;AAIA,WAAaA,QAAb;EAAA,SAAAA,SAAA;IAAAC,eAAA,OAAAD,QAAA;IAAA,KACSE,IADT;IAAA,KAKSC,QALT,GAKoB,CALpB;IAAA,KAUSC,aAVT,GAUyB,KAVzB;IAAA,KAeSC,YAfT,GAe2C,EAf3C;IAAA,KAoBSC,OApBT,GAoBsC,EApBtC;IAAA,KAsBSC,KAtBT,GAsBqC,EAtBrC;IAAA,KAwBSC,MAxBT,GAwBsC,EAxBtC;EAAA;EAAAC,YAAA,CAAAT,QAAA;IAAAU,GAAA;IAAAC,KAAA,WAAAC,KA0BcC,MA1Bd,EA0B0D;MACtD,IAAI,CAAC,KAAKN,KAAL,CAAWO,IAAX,CAAgB,UAACC,CAAD;QAAA,OAAOA,CAAC,CAACC,KAAF,KAAYH,MAAM,CAACG,KAA1B;MAAA,CAAhB,CAAL,EAAuD;QACrD,KAAKT,KAAL,CAAWU,IAAX,CAAgBJ,MAAhB;MACD;MACD,OAAOA,MAAP;IACD;EA/BH;IAAAH,GAAA;IAAAC,KAAA,WAAAO,OAiCgBL,MAjChB,EAiC0C;MACtC,KAAKD,IAAL,CAAUC,MAAV,EADsC,CAEtC;;MACA,OAAOA,MAAP;IACD;EArCH;IAAAH,GAAA;IAAAC,KAAA,WAAAQ,MAwCIC,EAxCJ,EAyCIP,MAzCJ,EA0CsB;MAClB,IAAMQ,OAAO,GAAG,KAAKb,MAAL,CAAYM,IAAZ,CAAiB,UAACC,CAAD;QAAA,OAAOA,CAAC,CAACC,KAAF,KAAYH,MAAM,CAACG,KAA1B;MAAA,CAAjB,CAAhB;MACA,IAAIK,OAAJ,EAAa;QACX,OAAOR,MAAP;MACD;MAED,IAAMS,IAAI,GAAGF,EAAE,CAACG,eAAH,CAAmBV,MAAnB,CAAb;MAEAS,IAAI,CAACE,QAAL,CAAcC,OAAd;MAEA,IAAIH,IAAI,CAACE,QAAL,CAAcE,QAAlB,EAA4B;QAC1B,KAAKtB,aAAL,GAAqB,IAArB;MACD;MAED,IAAMuB,CAAC,GAAGP,EAAE,CAACQ,kBAAH,CAAsBN,IAAI,CAACE,QAA3B,CAAV;MACA,IAAMK,OAAO,GAAGT,EAAE,CAACG,eAAH,CAAmBI,CAAnB,CAAhB;MAEAE,OAAO,CAACC,MAAR,GAAiB,IAAjB;MAEA,KAAKtB,MAAL,CAAYS,IAAZ,CAAiBU,CAAjB;MACA,OAAOA,CAAP;IACD;EA/DH;EAAA,OAAA3B,QAAA;AAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}