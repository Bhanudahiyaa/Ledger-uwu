{"ast":null,"code":"import React from 'react';\n/** AppContext */\nexport const XFlowAppContext = React.createContext(null);\nXFlowAppContext.displayName = 'XFlowAppContext';\n/** AppContext:获取 app */\nexport const useXFlowApp = () => {\n  const container = React.useContext(XFlowAppContext);\n  return container && container.getApp ? container.getApp() : null;\n};\n/** AppContext: 获取 appContainer */\nexport const useXFlowAppContainer = () => {\n  return React.useContext(XFlowAppContext);\n};\nclass AppContainer {\n  constructor(isUserDefined = false) {\n    this.cache = null;\n    this.setApp = app => {\n      this.cache = app;\n      if (this.onAppChangeCallback) {\n        this.onAppChangeCallback(app);\n      }\n    };\n    this.isUserDefined = () => this.isUserDefinedFlag;\n    this.getApp = () => {\n      return this.cache;\n    };\n    this.onAppChange = cb => {\n      this.onAppChangeCallback = cb;\n    };\n    this.dispose = () => {\n      this.cache = null;\n    };\n    this.isUserDefinedFlag = isUserDefined;\n  }\n}\n/** XFlow内部使用 */\nexport const XFlowAppInternalProvider = props => {\n  const userDefinedAppContainer = useXFlowAppContainer();\n  const [, setTick] = React.useState(null);\n  const appContainer = React.useMemo(() => {\n    return userDefinedAppContainer && userDefinedAppContainer.isUserDefined() ? userDefinedAppContainer : new AppContainer(false);\n    // 不要移除：保证config只生成一次\n    // eslint-disable-next-line\n  }, []);\n  // set appChange callback\n  if (!appContainer.isUserDefined()) {\n    appContainer.onAppChange(() => setTick(0));\n  }\n  React.useEffect(() => {\n    if (props.app) {\n      appContainer.setApp(props.app);\n    }\n    // 不要移除：只关心 props.app\n    // eslint-disable-next-line\n  }, [props.app]);\n  if (appContainer.isUserDefined()) {\n    return React.createElement(React.Fragment, null, props.children);\n  }\n  return React.createElement(XFlowAppContext.Provider, {\n    value: Object.assign({}, appContainer)\n  }, props.children);\n};\nXFlowAppInternalProvider.displayName = 'XFlowAppInternalProvider';\n/** XFlow外部使用 */\nexport const XFlowAppProvider = ({\n  children\n}) => {\n  const [, setTick] = React.useState(null);\n  const appContainer = React.useMemo(() => {\n    return new AppContainer(true);\n  }, []);\n  // add callback\n  appContainer.onAppChange(() => setTick(0));\n  return React.createElement(XFlowAppContext.Provider, {\n    value: Object.assign({}, appContainer)\n  }, children);\n};\nXFlowAppProvider.displayName = 'XFlowAppProvider';","map":{"version":3,"names":["React","XFlowAppContext","createContext","displayName","useXFlowApp","container","useContext","getApp","useXFlowAppContainer","AppContainer","constructor","isUserDefined","cache","setApp","app","onAppChangeCallback","isUserDefinedFlag","onAppChange","cb","dispose","XFlowAppInternalProvider","props","userDefinedAppContainer","setTick","useState","appContainer","useMemo","useEffect","createElement","Fragment","children","Provider","value","Object","assign","XFlowAppProvider"],"sources":["../../../src/xflow-main/components/app-context.tsx"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}