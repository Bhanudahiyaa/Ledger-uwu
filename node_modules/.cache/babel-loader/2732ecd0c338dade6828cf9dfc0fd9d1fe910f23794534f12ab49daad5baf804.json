{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _initializerDefineProperty from \"@babel/runtime/helpers/initializerDefineProperty\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _applyDecoratedDescriptor from \"@babel/runtime/helpers/applyDecoratedDescriptor\";\nimport _initializerWarningHelper from \"@babel/runtime/helpers/initializerWarningHelper\";\nvar _dec, _dec2, _dec3, _class, _class2, _descriptor, _descriptor2, _temp;\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n  return target;\n}\nimport { AST_TOKEN_TYPES, createEntity, DefineValuePlaceholder, IDENTIFIER, STORAGE_CLASS, Target } from '@antv/g-webgpu-core'; // tslint:disable-next-line:no-submodule-imports\n\nimport * as WebGPUConstants from '@webgpu/types/dist/constants';\nimport { inject, injectable } from 'inversify';\nimport { createCanvas } from './utils/canvas';\nimport isArray from './utils/is-array';\nimport { isNumber } from './utils/is-number';\nimport { isTypedArray } from './utils/is-typedarray';\nexport var Kernel = (_dec = injectable(), _dec2 = inject(IDENTIFIER.RenderEngine), _dec3 = inject(IDENTIFIER.ConfigService), _dec(_class = (_class2 = (_temp = /*#__PURE__*/function () {\n  function Kernel() {\n    _classCallCheck(this, Kernel);\n    _initializerDefineProperty(this, \"engine\", _descriptor, this);\n    _initializerDefineProperty(this, \"configService\", _descriptor2, this);\n    this.entity = createEntity();\n    this.model = void 0;\n    this.dirty = true;\n    this.compiledBundle = void 0;\n    this.initPromise = void 0;\n  }\n  _createClass(Kernel, [{\n    key: \"init\",\n    value: function init() {\n      var _this$configService$g = this.configService.get(),\n        canvas = _this$configService$g.canvas,\n        engineOptions = _this$configService$g.engineOptions;\n      this.initPromise = this.engine.init(_objectSpread({\n        canvas: canvas || createCanvas(),\n        swapChainFormat: WebGPUConstants.TextureFormat.BGRA8Unorm,\n        antialiasing: false\n      }, engineOptions));\n    }\n  }, {\n    key: \"setBundle\",\n    value: function setBundle(bundle) {\n      // deep clone\n      this.compiledBundle = JSON.parse(JSON.stringify(bundle));\n    }\n  }, {\n    key: \"setDispatch\",\n    value: function setDispatch(dispatch) {\n      if (this.compiledBundle.context) {\n        this.compiledBundle.context.dispatch = dispatch;\n      }\n      return this;\n    }\n  }, {\n    key: \"setMaxIteration\",\n    value: function setMaxIteration(maxIteration) {\n      if (this.compiledBundle.context) {\n        this.compiledBundle.context.maxIteration = maxIteration;\n      }\n      return this;\n    }\n  }, {\n    key: \"setBinding\",\n    value: function setBinding(name, data) {\n      var _this = this;\n      if (typeof name === 'string') {\n        var isNumberLikeData = isNumber(data) || isTypedArray(data) || isArray(data);\n        if (this.compiledBundle && this.compiledBundle.context) {\n          // set define, eg. setBinding('MAX_LENGTH', 10)\n          var existedDefine = this.compiledBundle.context.defines.find(function (b) {\n            return b.name === name;\n          });\n          if (existedDefine) {\n            existedDefine.value = data;\n            return this;\n          } // set uniform\n\n          var existedBinding = this.compiledBundle.context.uniforms.find(function (b) {\n            return b.name === name;\n          });\n          if (existedBinding) {\n            // update uniform or buffer\n            if (isNumberLikeData) {\n              // @ts-ignore\n              existedBinding.data = data;\n              existedBinding.isReferer = false;\n              if (existedBinding.storageClass === STORAGE_CLASS.Uniform) {\n                if (this.model) {\n                  // @ts-ignore\n                  this.model.updateUniform(name, data);\n                }\n              } else {\n                if (this.model) {\n                  // @ts-ignore\n                  this.model.updateBuffer(name, data);\n                }\n              }\n            } else {\n              // update with another kernel\n              existedBinding.isReferer = true; // @ts-ignore\n\n              existedBinding.data = data;\n            }\n          }\n        }\n      } else {\n        Object.keys(name).forEach(function (key) {\n          _this.setBinding(key, name[key]);\n        });\n      }\n      return this;\n    }\n  }, {\n    key: \"execute\",\n    value: function () {\n      var _execute = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var _this2 = this;\n        var iteration,\n          i,\n          _args = arguments;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                iteration = _args.length > 0 && _args[0] !== undefined ? _args[0] : 1;\n                if (!this.dirty) {\n                  _context.next = 6;\n                  break;\n                }\n                if (this.compiledBundle.context) {\n                  if (iteration > 1) {\n                    this.compiledBundle.context.maxIteration = iteration;\n                  } else {\n                    this.compiledBundle.context.maxIteration++;\n                  }\n                }\n                _context.next = 5;\n                return this.compile();\n              case 5:\n                this.dirty = false;\n              case 6:\n                this.engine.beginFrame(); // 首先开启当前 frame 的 compute pass\n\n                this.engine.clear({});\n                if (this.compiledBundle.context) {\n                  this.compiledBundle.context.uniforms.filter(function (_ref) {\n                    var isReferer = _ref.isReferer;\n                    return isReferer;\n                  }).forEach(function (_ref2) {\n                    var data = _ref2.data,\n                      name = _ref2.name;\n\n                    // @ts-ignore\n                    _this2.model.confirmInput(data.model, name);\n                  });\n                }\n                for (i = 0; i < iteration; i++) {\n                  this.model.run();\n                }\n                this.engine.endFrame();\n                return _context.abrupt(\"return\", this);\n              case 12:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n      function execute() {\n        return _execute.apply(this, arguments);\n      }\n      return execute;\n    }()\n    /**\n     * read output from GPUBuffer\n     */\n  }, {\n    key: \"getOutput\",\n    value: function () {\n      var _getOutput = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                return _context2.abrupt(\"return\", this.model.readData());\n              case 1:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n      function getOutput() {\n        return _getOutput.apply(this, arguments);\n      }\n      return getOutput;\n    }()\n  }, {\n    key: \"compile\",\n    value: function () {\n      var _compile = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        var context, target, shader;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return this.initPromise;\n              case 2:\n                context = _objectSpread({}, this.compiledBundle.context);\n                target = this.engine.supportWebGPU ? this.engine.useWGSL ? Target.WGSL : Target.GLSL450 : Target.GLSL100;\n                shader = this.compiledBundle.shaders[target]; // this.bindings?.forEach(({ name, data }) => {\n                //   if (name === name.toUpperCase()) {\n                //     const define = context.defines.find((d) => d.name === name);\n                //     if (define) {\n                //       // @ts-ignore\n                //       define.value = data;\n                //     }\n                //   }\n                // });\n                // 生成运行时 define\n\n                context.defines.filter(function (define) {\n                  return define.runtime;\n                }).forEach(function (define) {\n                  var valuePlaceHolder = \"\".concat(DefineValuePlaceholder).concat(define.name);\n                  shader = shader.replace(valuePlaceHolder, \"\".concat(define.value));\n                });\n                context.shader = shader; // 添加 uniform 绑定的数据\n\n                context.uniforms.forEach(function (uniform) {\n                  // const binding = this.bindings.find((b) => b.name === uniform.name);\n                  // if (binding) {\n                  //   // @ts-ignore\n                  //   uniform.data = binding.referer || binding.data;\n                  //   // @ts-ignore\n                  //   uniform.isReferer = !!binding.referer;\n                  // }\n                  // 未指定数据，尝试根据 uniform 类型初始化\n                  if (!uniform.data) {\n                    if (uniform.storageClass === STORAGE_CLASS.StorageBuffer) {\n                      var sizePerElement = 1;\n                      if (uniform.type === AST_TOKEN_TYPES.FloatArray) {\n                        sizePerElement = 1;\n                      } else if (uniform.type === AST_TOKEN_TYPES.Vector4FloatArray) {\n                        sizePerElement = 4;\n                      }\n                      uniform.data = new Float32Array(context.output.length * sizePerElement).fill(0);\n                    }\n                  }\n                }); // } else if (uniform.type === 'image2D') {\n                //   // @ts-ignore\n                //   buffer.data = new Uint8ClampedArray(context.output.length!).fill(0);\n                // }\n\n                this.compiledBundle.context = context;\n                _context3.next = 11;\n                return this.engine.createComputeModel(this.compiledBundle.context);\n              case 11:\n                this.model = _context3.sent;\n              case 12:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n      function compile() {\n        return _compile.apply(this, arguments);\n      }\n      return compile;\n    }()\n  }]);\n  return Kernel;\n}(), _temp), _descriptor = _applyDecoratedDescriptor(_class2.prototype, \"engine\", [_dec2], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor2 = _applyDecoratedDescriptor(_class2.prototype, \"configService\", [_dec3], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _class2)) || _class);","map":{"version":3,"names":["AST_TOKEN_TYPES","createEntity","DefineValuePlaceholder","IDENTIFIER","STORAGE_CLASS","Target","WebGPUConstants","inject","injectable","createCanvas","isArray","isNumber","isTypedArray","Kernel","_dec","_dec2","RenderEngine","_dec3","ConfigService","_class","_class2","_temp","_classCallCheck","_initializerDefineProperty","_descriptor","_descriptor2","entity","model","dirty","compiledBundle","initPromise","_createClass","key","value","init","_this$configService$g","configService","get","canvas","engineOptions","engine","_objectSpread","swapChainFormat","TextureFormat","BGRA8Unorm","antialiasing","setBundle","bundle","JSON","parse","stringify","setDispatch","dispatch","context","setMaxIteration","maxIteration","setBinding","name","data","_this","isNumberLikeData","existedDefine","defines","find","b","existedBinding","uniforms","isReferer","storageClass","Uniform","updateUniform","updateBuffer","Object","keys","forEach","_execute","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_this2","iteration","i","_args","arguments","wrap","_callee$","_context","prev","next","length","undefined","compile","beginFrame","clear","filter","_ref","_ref2","confirmInput","run","endFrame","abrupt","stop","execute","apply","_getOutput","_callee2","_callee2$","_context2","readData","getOutput","_compile","_callee3","target","shader","_callee3$","_context3","supportWebGPU","useWGSL","WGSL","GLSL450","GLSL100","shaders","define","runtime","valuePlaceHolder","concat","replace","uniform","StorageBuffer","sizePerElement","type","FloatArray","Vector4FloatArray","Float32Array","output","fill","createComputeModel","sent","_applyDecoratedDescriptor","prototype","configurable","enumerable","writable","initializer"],"sources":["/Users/bhanudahiya/Desktop/ledger-IQ/node_modules/@antv/g-webgpu/src/Kernel.ts"],"sourcesContent":["import {\n  AST_TOKEN_TYPES,\n  createEntity,\n  DefineValuePlaceholder,\n  IComputeModel,\n  IConfigService,\n  IDENTIFIER,\n  IRendererService,\n  KernelBundle,\n  STORAGE_CLASS,\n  Target,\n} from '@antv/g-webgpu-core';\n// tslint:disable-next-line:no-submodule-imports\nimport * as WebGPUConstants from '@webgpu/types/dist/constants';\nimport { inject, injectable } from 'inversify';\nimport { createCanvas } from './utils/canvas';\nimport isArray from './utils/is-array';\nimport { isNumber } from './utils/is-number';\nimport { isTypedArray } from './utils/is-typedarray';\n\n@injectable()\nexport class Kernel {\n  @inject(IDENTIFIER.RenderEngine)\n  private readonly engine: IRendererService;\n\n  @inject(IDENTIFIER.ConfigService)\n  private readonly configService: IConfigService;\n\n  private entity = createEntity();\n\n  private model: IComputeModel;\n\n  private dirty: boolean = true;\n\n  private compiledBundle: KernelBundle;\n\n  private initPromise: Promise<void>;\n\n  public init() {\n    const { canvas, engineOptions } = this.configService.get();\n\n    this.initPromise = this.engine.init({\n      canvas: canvas || createCanvas(),\n      swapChainFormat: WebGPUConstants.TextureFormat.BGRA8Unorm,\n      antialiasing: false,\n      ...engineOptions,\n    });\n  }\n\n  public setBundle(bundle: KernelBundle) {\n    // deep clone\n    this.compiledBundle = JSON.parse(JSON.stringify(bundle));\n  }\n\n  public setDispatch(dispatch: [number, number, number]) {\n    if (this.compiledBundle.context) {\n      this.compiledBundle.context.dispatch = dispatch;\n    }\n    return this;\n  }\n\n  public setMaxIteration(maxIteration: number) {\n    if (this.compiledBundle.context) {\n      this.compiledBundle.context.maxIteration = maxIteration;\n    }\n    return this;\n  }\n\n  public setBinding(\n    name:\n      | string\n      | Record<\n          string,\n          | number\n          | number[]\n          | Float32Array\n          | Uint8Array\n          | Uint16Array\n          | Uint32Array\n          | Int8Array\n          | Int16Array\n          | Int32Array\n          | Kernel\n        >,\n    data?:\n      | number\n      | number[]\n      | Float32Array\n      | Uint8Array\n      | Uint16Array\n      | Uint32Array\n      | Int8Array\n      | Int16Array\n      | Int32Array\n      | Kernel,\n  ) {\n    if (typeof name === 'string') {\n      const isNumberLikeData =\n        isNumber(data) || isTypedArray(data) || isArray(data);\n      if (this.compiledBundle && this.compiledBundle.context) {\n        // set define, eg. setBinding('MAX_LENGTH', 10)\n        const existedDefine = this.compiledBundle.context.defines.find(\n          (b) => b.name === name,\n        );\n        if (existedDefine) {\n          existedDefine.value = data as number;\n          return this;\n        }\n\n        // set uniform\n        const existedBinding = this.compiledBundle.context.uniforms.find(\n          (b) => b.name === name,\n        );\n        if (existedBinding) {\n          // update uniform or buffer\n          if (isNumberLikeData) {\n            // @ts-ignore\n            existedBinding.data = data;\n            existedBinding.isReferer = false;\n\n            if (existedBinding.storageClass === STORAGE_CLASS.Uniform) {\n              if (this.model) {\n                // @ts-ignore\n                this.model.updateUniform(name, data);\n              }\n            } else {\n              if (this.model) {\n                // @ts-ignore\n                this.model.updateBuffer(name, data);\n              }\n            }\n          } else {\n            // update with another kernel\n            existedBinding.isReferer = true;\n            // @ts-ignore\n            existedBinding.data = data as Kernel;\n          }\n        }\n      }\n    } else {\n      Object.keys(name).forEach((key) => {\n        this.setBinding(key, name[key]);\n      });\n    }\n    return this;\n  }\n\n  public async execute(iteration: number = 1) {\n    if (this.dirty) {\n      if (this.compiledBundle.context) {\n        if (iteration > 1) {\n          this.compiledBundle.context.maxIteration = iteration;\n        } else {\n          this.compiledBundle.context.maxIteration++;\n        }\n      }\n      await this.compile();\n      this.dirty = false;\n    }\n\n    this.engine.beginFrame();\n\n    // 首先开启当前 frame 的 compute pass\n    this.engine.clear({});\n\n    if (this.compiledBundle.context) {\n      this.compiledBundle.context.uniforms\n        .filter(({ isReferer }) => isReferer)\n        .forEach(({ data, name }) => {\n          // @ts-ignore\n          this.model.confirmInput((data as Kernel).model, name);\n        });\n    }\n    for (let i = 0; i < iteration; i++) {\n      this.model.run();\n    }\n\n    this.engine.endFrame();\n    return this;\n  }\n\n  /**\n   * read output from GPUBuffer\n   */\n  public async getOutput() {\n    return this.model.readData();\n  }\n\n  private async compile() {\n    await this.initPromise;\n\n    const context = {\n      ...this.compiledBundle.context!,\n    };\n\n    const target = this.engine.supportWebGPU\n      ? this.engine.useWGSL\n        ? Target.WGSL\n        : Target.GLSL450\n      : Target.GLSL100;\n    let shader = this.compiledBundle.shaders[target];\n\n    // this.bindings?.forEach(({ name, data }) => {\n    //   if (name === name.toUpperCase()) {\n    //     const define = context.defines.find((d) => d.name === name);\n    //     if (define) {\n    //       // @ts-ignore\n    //       define.value = data;\n    //     }\n    //   }\n    // });\n\n    // 生成运行时 define\n    context.defines\n      .filter((define) => define.runtime)\n      .forEach((define) => {\n        const valuePlaceHolder = `${DefineValuePlaceholder}${define.name}`;\n        shader = shader.replace(valuePlaceHolder, `${define.value}`);\n      });\n\n    context.shader = shader;\n\n    // 添加 uniform 绑定的数据\n    context.uniforms.forEach((uniform) => {\n      // const binding = this.bindings.find((b) => b.name === uniform.name);\n      // if (binding) {\n      //   // @ts-ignore\n      //   uniform.data = binding.referer || binding.data;\n      //   // @ts-ignore\n      //   uniform.isReferer = !!binding.referer;\n      // }\n\n      // 未指定数据，尝试根据 uniform 类型初始化\n      if (!uniform.data) {\n        if (uniform.storageClass === STORAGE_CLASS.StorageBuffer) {\n          let sizePerElement = 1;\n          if (uniform.type === AST_TOKEN_TYPES.FloatArray) {\n            sizePerElement = 1;\n          } else if (uniform.type === AST_TOKEN_TYPES.Vector4FloatArray) {\n            sizePerElement = 4;\n          }\n          uniform.data = new Float32Array(\n            context.output.length! * sizePerElement,\n          ).fill(0);\n        }\n      }\n    });\n    // } else if (uniform.type === 'image2D') {\n    //   // @ts-ignore\n    //   buffer.data = new Uint8ClampedArray(context.output.length!).fill(0);\n    // }\n\n    this.compiledBundle.context = context;\n    this.model = await this.engine.createComputeModel(\n      this.compiledBundle.context,\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}