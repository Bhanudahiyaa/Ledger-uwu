{"ast":null,"code":"import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { createL7Icon } from \"../utils/icon\";\nimport ButtonControl from \"./baseControl/buttonControl\";\nexport { ExportImage };\nexport default class ExportImage extends ButtonControl {\n  constructor(...args) {\n    var _this;\n    super(...args);\n    _this = this;\n    _defineProperty(this, \"onClick\", /*#__PURE__*/_asyncToGenerator(function* () {\n      const {\n        onExport\n      } = _this.controlOption;\n      onExport === null || onExport === void 0 || onExport(yield _this.getImage());\n    }));\n    /**\n     * 将多张图片合并为一张图片\n     * @protected\n     * @param base64List\n     */\n    _defineProperty(this, \"mergeImage\", /*#__PURE__*/_asyncToGenerator(function* (...base64List) {\n      var _this$mapsService$get, _this$mapsService$get2;\n      const {\n        imageType\n      } = _this.controlOption;\n      const {\n        width = 0,\n        height = 0\n      } = (_this$mapsService$get = (_this$mapsService$get2 = _this.mapsService.getContainer()) === null || _this$mapsService$get2 === void 0 ? void 0 : _this$mapsService$get2.getBoundingClientRect()) !== null && _this$mapsService$get !== void 0 ? _this$mapsService$get : {};\n      const canvas = document.createElement('canvas');\n      canvas.width = width;\n      canvas.height = height;\n      const context = canvas.getContext('2d');\n      const imgList = yield Promise.all(base64List.map(base64 => {\n        return new Promise(resolve => {\n          const img = new Image();\n          img.onload = () => {\n            resolve(img);\n          };\n          img.src = base64;\n        });\n      }));\n      imgList.forEach(img => {\n        context === null || context === void 0 || context.drawImage(img, 0, 0, width, height);\n      });\n      return canvas.toDataURL(`image/${imageType}`);\n    }));\n  }\n  onAdd() {\n    const button = super.onAdd();\n    button.addEventListener('click', this.onClick);\n    return button;\n  }\n  getDefault(option) {\n    return _objectSpread(_objectSpread({}, super.getDefault(option)), {}, {\n      title: '导出图片',\n      btnIcon: createL7Icon('l7-icon-export-picture'),\n      imageType: 'png'\n    });\n  }\n  getImage() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      const mapImage = yield _this2.mapsService.exportMap('png');\n      const layerImage = yield _this2.scene.exportPng('png');\n      return _this2.mergeImage(\n      // 在 Map 底图模式下 mapImage 为 undefined\n      ...[mapImage, layerImage].filter(base64 => base64));\n    })();\n  }\n}","map":{"version":3,"names":["_objectSpread","_asyncToGenerator","_defineProperty","createL7Icon","ButtonControl","ExportImage","constructor","args","_this","onExport","controlOption","getImage","base64List","_this$mapsService$get","_this$mapsService$get2","imageType","width","height","mapsService","getContainer","getBoundingClientRect","canvas","document","createElement","context","getContext","imgList","Promise","all","map","base64","resolve","img","Image","onload","src","forEach","drawImage","toDataURL","onAdd","button","addEventListener","onClick","getDefault","option","title","btnIcon","_this2","mapImage","exportMap","layerImage","scene","exportPng","mergeImage","filter"],"sources":["/Users/bhanudahiya/Desktop/ledger-IQ/node_modules/@antv/l7-component/es/control/exportImage.js"],"sourcesContent":["import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { createL7Icon } from \"../utils/icon\";\nimport ButtonControl from \"./baseControl/buttonControl\";\nexport { ExportImage };\nexport default class ExportImage extends ButtonControl {\n  constructor(...args) {\n    var _this;\n    super(...args);\n    _this = this;\n    _defineProperty(this, \"onClick\", /*#__PURE__*/_asyncToGenerator(function* () {\n      const {\n        onExport\n      } = _this.controlOption;\n      onExport === null || onExport === void 0 || onExport(yield _this.getImage());\n    }));\n    /**\n     * 将多张图片合并为一张图片\n     * @protected\n     * @param base64List\n     */\n    _defineProperty(this, \"mergeImage\", /*#__PURE__*/_asyncToGenerator(function* (...base64List) {\n      var _this$mapsService$get, _this$mapsService$get2;\n      const {\n        imageType\n      } = _this.controlOption;\n      const {\n        width = 0,\n        height = 0\n      } = (_this$mapsService$get = (_this$mapsService$get2 = _this.mapsService.getContainer()) === null || _this$mapsService$get2 === void 0 ? void 0 : _this$mapsService$get2.getBoundingClientRect()) !== null && _this$mapsService$get !== void 0 ? _this$mapsService$get : {};\n      const canvas = document.createElement('canvas');\n      canvas.width = width;\n      canvas.height = height;\n      const context = canvas.getContext('2d');\n      const imgList = yield Promise.all(base64List.map(base64 => {\n        return new Promise(resolve => {\n          const img = new Image();\n          img.onload = () => {\n            resolve(img);\n          };\n          img.src = base64;\n        });\n      }));\n      imgList.forEach(img => {\n        context === null || context === void 0 || context.drawImage(img, 0, 0, width, height);\n      });\n      return canvas.toDataURL(`image/${imageType}`);\n    }));\n  }\n  onAdd() {\n    const button = super.onAdd();\n    button.addEventListener('click', this.onClick);\n    return button;\n  }\n  getDefault(option) {\n    return _objectSpread(_objectSpread({}, super.getDefault(option)), {}, {\n      title: '导出图片',\n      btnIcon: createL7Icon('l7-icon-export-picture'),\n      imageType: 'png'\n    });\n  }\n  getImage() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      const mapImage = yield _this2.mapsService.exportMap('png');\n      const layerImage = yield _this2.scene.exportPng('png');\n      return _this2.mergeImage(\n      // 在 Map 底图模式下 mapImage 为 undefined\n      ...[mapImage, layerImage].filter(base64 => base64));\n    })();\n  }\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}