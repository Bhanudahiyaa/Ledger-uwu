{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport { AttributeType, gl } from '@antv/l7-core';\nimport BaseModel from \"../../core/BaseModel\";\nimport { PointExtrudeTriangulation } from \"../../core/triangulation\";\n/* babel-plugin-inline-import '../shaders/grid3d/grid_3d_frag.glsl' */\nconst grid_3d_frag = \"in vec4 v_color;\\n\\nlayout(std140) uniform commonUniforms {\\n  vec2 u_radius;\\n  float u_opacity;\\n  float u_coverage;\\n  float u_angle;\\n};\\n\\n#pragma include \\\"scene_uniforms\\\"\\n#pragma include \\\"picking\\\"\\n\\nout vec4 outputColor;\\nvoid main() {\\n  outputColor = v_color;\\n  outputColor = filterColor(outputColor);\\n}\\n\";\n/* babel-plugin-inline-import '../shaders/grid3d/grid_3d_vert.glsl' */\nconst grid_3d_vert = \"layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\\nlayout(location = ATTRIBUTE_LOCATION_POS) in vec3 a_Pos;\\nlayout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;\\n\\nlayout(std140) uniform commonUniforms {\\n  vec2 u_radius;\\n  float u_opacity;\\n  float u_coverage;\\n  float u_angle;\\n};\\n\\nout vec4 v_color;\\n\\n#pragma include \\\"projection\\\"\\n#pragma include \\\"project\\\"\\n#pragma include \\\"light\\\"\\n#pragma include \\\"picking\\\"\\n\\nvoid main() {\\n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\\n  vec2 offset = vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage);\\n\\n  vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \\u5B9E\\u9645\\u7684\\u7ECF\\u7EAC\\u5EA6\\n  vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));\\n\\n  float lightWeight = calc_lighting(project_pos);\\n  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);\\n\\n  gl_Position = project_common_position_to_clipspace(project_pos);\\n\\n  setPickingColor(a_PickingColor);\\n}\\n\";\nexport default class Grid3DModel extends BaseModel {\n  get attributeLocation() {\n    return Object.assign(super.attributeLocation, {\n      MAX: super.attributeLocation.MAX,\n      SIZE: 9,\n      POS: 10,\n      NORMAL: 11\n    });\n  }\n  getUninforms() {\n    const commoninfo = this.getCommonUniformsInfo();\n    const attributeInfo = this.getUniformsBufferInfo(this.getStyleAttribute());\n    this.updateStyleUnifoms();\n    return _objectSpread(_objectSpread({}, commoninfo.uniformsOption), attributeInfo.uniformsOption);\n  }\n  getCommonUniformsInfo() {\n    const {\n      opacity,\n      coverage,\n      angle\n    } = this.layer.getLayerConfig();\n    const commonOptions = {\n      u_radius: [this.layer.getSource().data.xOffset, this.layer.getSource().data.yOffset],\n      u_opacity: opacity || 1.0,\n      u_coverage: coverage || 0.9,\n      u_angle: angle || 0\n    };\n    const commonBufferInfo = this.getUniformsBufferInfo(commonOptions);\n    return commonBufferInfo;\n  }\n  initModels() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      return _this.buildModels();\n    })();\n  }\n  buildModels() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      _this2.initUniformsBuffer();\n      const model = yield _this2.layer.buildLayerModel({\n        moduleName: 'heatmapGrid3d',\n        vertexShader: grid_3d_vert,\n        fragmentShader: grid_3d_frag,\n        defines: _this2.getDefines(),\n        triangulation: PointExtrudeTriangulation,\n        primitive: gl.TRIANGLES,\n        depth: {\n          enable: true\n        }\n      });\n      return [model];\n    })();\n  }\n  registerBuiltinAttributes() {\n    this.styleAttributeService.registerStyleAttribute({\n      name: 'size',\n      type: AttributeType.Attribute,\n      descriptor: {\n        shaderLocation: this.attributeLocation.SIZE,\n        name: 'a_Size',\n        buffer: {\n          usage: gl.DYNAMIC_DRAW,\n          data: [],\n          type: gl.FLOAT\n        },\n        size: 1,\n        update: feature => {\n          const {\n            size\n          } = feature;\n          return Array.isArray(size) ? [size[0]] : [size];\n        }\n      }\n    });\n    this.styleAttributeService.registerStyleAttribute({\n      name: 'normal',\n      type: AttributeType.Attribute,\n      descriptor: {\n        name: 'a_Normal',\n        shaderLocation: this.attributeLocation.NORMAL,\n        buffer: {\n          usage: gl.STATIC_DRAW,\n          data: [],\n          type: gl.FLOAT\n        },\n        size: 3,\n        update: (feature, featureIdx, vertex, attributeIdx, normal) => {\n          return normal;\n        }\n      }\n    });\n    this.styleAttributeService.registerStyleAttribute({\n      name: 'pos',\n      // 顶点经纬度位置\n      type: AttributeType.Attribute,\n      descriptor: {\n        name: 'a_Pos',\n        shaderLocation: this.attributeLocation.POS,\n        buffer: {\n          usage: gl.DYNAMIC_DRAW,\n          data: [],\n          type: gl.FLOAT\n        },\n        size: 3,\n        update: feature => {\n          const coordinates = feature.coordinates;\n          return [coordinates[0], coordinates[1], 0];\n        }\n      }\n    });\n  }\n}","map":{"version":3,"names":["_asyncToGenerator","_objectSpread","AttributeType","gl","BaseModel","PointExtrudeTriangulation","grid_3d_frag","grid_3d_vert","Grid3DModel","attributeLocation","Object","assign","MAX","SIZE","POS","NORMAL","getUninforms","commoninfo","getCommonUniformsInfo","attributeInfo","getUniformsBufferInfo","getStyleAttribute","updateStyleUnifoms","uniformsOption","opacity","coverage","angle","layer","getLayerConfig","commonOptions","u_radius","getSource","data","xOffset","yOffset","u_opacity","u_coverage","u_angle","commonBufferInfo","initModels","_this","buildModels","_this2","initUniformsBuffer","model","buildLayerModel","moduleName","vertexShader","fragmentShader","defines","getDefines","triangulation","primitive","TRIANGLES","depth","enable","registerBuiltinAttributes","styleAttributeService","registerStyleAttribute","name","type","Attribute","descriptor","shaderLocation","buffer","usage","DYNAMIC_DRAW","FLOAT","size","update","feature","Array","isArray","STATIC_DRAW","featureIdx","vertex","attributeIdx","normal","coordinates"],"sources":["/Users/bhanudahiya/Desktop/ledger-IQ/node_modules/@antv/l7-layers/es/heatmap/models/grid3d.js"],"sourcesContent":["import _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport { AttributeType, gl } from '@antv/l7-core';\nimport BaseModel from \"../../core/BaseModel\";\nimport { PointExtrudeTriangulation } from \"../../core/triangulation\";\n/* babel-plugin-inline-import '../shaders/grid3d/grid_3d_frag.glsl' */\nconst grid_3d_frag = \"in vec4 v_color;\\n\\nlayout(std140) uniform commonUniforms {\\n  vec2 u_radius;\\n  float u_opacity;\\n  float u_coverage;\\n  float u_angle;\\n};\\n\\n#pragma include \\\"scene_uniforms\\\"\\n#pragma include \\\"picking\\\"\\n\\nout vec4 outputColor;\\nvoid main() {\\n  outputColor = v_color;\\n  outputColor = filterColor(outputColor);\\n}\\n\";\n/* babel-plugin-inline-import '../shaders/grid3d/grid_3d_vert.glsl' */\nconst grid_3d_vert = \"layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\\nlayout(location = ATTRIBUTE_LOCATION_POS) in vec3 a_Pos;\\nlayout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;\\n\\nlayout(std140) uniform commonUniforms {\\n  vec2 u_radius;\\n  float u_opacity;\\n  float u_coverage;\\n  float u_angle;\\n};\\n\\nout vec4 v_color;\\n\\n#pragma include \\\"projection\\\"\\n#pragma include \\\"project\\\"\\n#pragma include \\\"light\\\"\\n#pragma include \\\"picking\\\"\\n\\nvoid main() {\\n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\\n  vec2 offset = vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage);\\n\\n  vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \\u5B9E\\u9645\\u7684\\u7ECF\\u7EAC\\u5EA6\\n  vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));\\n\\n  float lightWeight = calc_lighting(project_pos);\\n  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);\\n\\n  gl_Position = project_common_position_to_clipspace(project_pos);\\n\\n  setPickingColor(a_PickingColor);\\n}\\n\";\nexport default class Grid3DModel extends BaseModel {\n  get attributeLocation() {\n    return Object.assign(super.attributeLocation, {\n      MAX: super.attributeLocation.MAX,\n      SIZE: 9,\n      POS: 10,\n      NORMAL: 11\n    });\n  }\n  getUninforms() {\n    const commoninfo = this.getCommonUniformsInfo();\n    const attributeInfo = this.getUniformsBufferInfo(this.getStyleAttribute());\n    this.updateStyleUnifoms();\n    return _objectSpread(_objectSpread({}, commoninfo.uniformsOption), attributeInfo.uniformsOption);\n  }\n  getCommonUniformsInfo() {\n    const {\n      opacity,\n      coverage,\n      angle\n    } = this.layer.getLayerConfig();\n    const commonOptions = {\n      u_radius: [this.layer.getSource().data.xOffset, this.layer.getSource().data.yOffset],\n      u_opacity: opacity || 1.0,\n      u_coverage: coverage || 0.9,\n      u_angle: angle || 0\n    };\n    const commonBufferInfo = this.getUniformsBufferInfo(commonOptions);\n    return commonBufferInfo;\n  }\n  initModels() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      return _this.buildModels();\n    })();\n  }\n  buildModels() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      _this2.initUniformsBuffer();\n      const model = yield _this2.layer.buildLayerModel({\n        moduleName: 'heatmapGrid3d',\n        vertexShader: grid_3d_vert,\n        fragmentShader: grid_3d_frag,\n        defines: _this2.getDefines(),\n        triangulation: PointExtrudeTriangulation,\n        primitive: gl.TRIANGLES,\n        depth: {\n          enable: true\n        }\n      });\n      return [model];\n    })();\n  }\n  registerBuiltinAttributes() {\n    this.styleAttributeService.registerStyleAttribute({\n      name: 'size',\n      type: AttributeType.Attribute,\n      descriptor: {\n        shaderLocation: this.attributeLocation.SIZE,\n        name: 'a_Size',\n        buffer: {\n          usage: gl.DYNAMIC_DRAW,\n          data: [],\n          type: gl.FLOAT\n        },\n        size: 1,\n        update: feature => {\n          const {\n            size\n          } = feature;\n          return Array.isArray(size) ? [size[0]] : [size];\n        }\n      }\n    });\n    this.styleAttributeService.registerStyleAttribute({\n      name: 'normal',\n      type: AttributeType.Attribute,\n      descriptor: {\n        name: 'a_Normal',\n        shaderLocation: this.attributeLocation.NORMAL,\n        buffer: {\n          usage: gl.STATIC_DRAW,\n          data: [],\n          type: gl.FLOAT\n        },\n        size: 3,\n        update: (feature, featureIdx, vertex, attributeIdx, normal) => {\n          return normal;\n        }\n      }\n    });\n    this.styleAttributeService.registerStyleAttribute({\n      name: 'pos',\n      // 顶点经纬度位置\n      type: AttributeType.Attribute,\n      descriptor: {\n        name: 'a_Pos',\n        shaderLocation: this.attributeLocation.POS,\n        buffer: {\n          usage: gl.DYNAMIC_DRAW,\n          data: [],\n          type: gl.FLOAT\n        },\n        size: 3,\n        update: feature => {\n          const coordinates = feature.coordinates;\n          return [coordinates[0], coordinates[1], 0];\n        }\n      }\n    });\n  }\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}