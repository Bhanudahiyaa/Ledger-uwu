{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { AttributeType, gl } from '@antv/l7-core';\nimport { defaultValue } from '@antv/l7-utils';\nimport BaseModel from \"../../core/BaseModel\";\nimport { RasterImageTriangulation } from \"../../core/triangulation\";\n/* babel-plugin-inline-import '../shaders/image_frag.glsl' */\nconst ImageFrag = \"uniform sampler2D u_texture;\\nlayout(std140) uniform commonUniforms {\\n    float u_opacity:1.0;\\n    float u_brightness:1.0;\\n    float u_contrast:1.0;\\n    float u_saturation:1.0;\\n    float u_gamma:1.0;\\n};\\n\\nin vec2 v_texCoord;\\nout vec4 outputColor;\\nvec3 setContrast(vec3 rgb, float contrast) {\\n  vec3 color = mix(vec3(0.5), rgb, contrast);\\n  color = clamp(color, 0.0, 1.0);\\n  return color;\\n}\\nvec3 setSaturation(vec3 rgb, float adjustment) {\\n  const vec3 grayVector = vec3(0.2125, 0.7154, 0.0721);\\n  vec3 intensity = vec3(dot(rgb, grayVector));\\n  vec3 color = mix(intensity, rgb, adjustment);\\n  color = clamp(color, 0.0, 1.0);\\n  return color;\\n}\\nvoid main() {\\n  vec4 color = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y));\\n  //brightness\\n  color.rgb = mix(vec3(0.0, 0.0, 0.0), color.rgb, u_brightness);\\n  //contrast\\n  color.rgb = setContrast(color.rgb, u_contrast);\\n  // saturation\\n  color.rgb = setSaturation(color.rgb, u_saturation);\\n  // gamma\\n  color.rgb = pow(color.rgb, vec3(u_gamma));\\n  outputColor = color;\\n  outputColor.a *= u_opacity;\\n  if(outputColor.a < 0.01)\\n    discard;\\n}\\n\";\n/* babel-plugin-inline-import '../shaders/image_vert.glsl' */\nconst ImageVert = \"layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;\\n\\nlayout(std140) uniform commonUniforms {\\n    float u_opacity:1.0;\\n    float u_brightness:1.0;\\n    float u_contrast:1.0;\\n    float u_saturation:1.0;\\n    float u_gamma:1.0;\\n};\\n\\nout vec2 v_texCoord;\\n#pragma include \\\"projection\\\"\\n\\nvoid main() {\\n  v_texCoord = a_Uv;\\n  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);\\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));\\n}\\n\";\nexport default class ImageModel extends BaseModel {\n  constructor(...args) {\n    super(...args);\n    _defineProperty(this, \"texture\", void 0);\n  }\n  get attributeLocation() {\n    return Object.assign(super.attributeLocation, {\n      MAX: super.attributeLocation.MAX,\n      UV: 9\n    });\n  }\n  getCommonUniformsInfo() {\n    const {\n      opacity,\n      brightness,\n      contrast,\n      saturation,\n      gamma\n    } = this.layer.getLayerConfig();\n    const commonOptions = {\n      u_opacity: defaultValue(opacity, 1.0),\n      u_brightness: defaultValue(brightness, 1.0),\n      u_contrast: defaultValue(contrast, 1.0),\n      u_saturation: defaultValue(saturation, 1.0),\n      u_gamma: defaultValue(gamma, 1.0)\n    };\n    this.textures = [this.texture];\n    const commonBufferInfo = this.getUniformsBufferInfo(commonOptions);\n    return commonBufferInfo;\n  }\n  initModels() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      yield _this.loadTexture();\n      return _this.buildModels();\n    })();\n  }\n  clearModels() {\n    var _this$texture;\n    (_this$texture = this.texture) === null || _this$texture === void 0 || _this$texture.destroy();\n  }\n  loadTexture() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      const {\n        createTexture2D\n      } = _this2.rendererService;\n      const source = _this2.layer.getSource();\n      const imageData = yield source.data.images;\n      _this2.texture = createTexture2D({\n        data: imageData[0],\n        width: imageData[0].width,\n        height: imageData[0].height,\n        mag: gl.LINEAR,\n        min: gl.LINEAR\n      });\n    })();\n  }\n  buildModels() {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      _this3.initUniformsBuffer();\n      const model = yield _this3.layer.buildLayerModel({\n        moduleName: 'rasterImage',\n        vertexShader: ImageVert,\n        fragmentShader: ImageFrag,\n        defines: _this3.getDefines(),\n        triangulation: RasterImageTriangulation,\n        primitive: gl.TRIANGLES,\n        blend: {\n          // Tip: 优化显示效果\n          enable: true\n        },\n        depth: {\n          enable: false\n        },\n        pickingEnabled: false\n      });\n      return [model];\n    })();\n  }\n  registerBuiltinAttributes() {\n    // 注册 Position 属性 64 位地位部分，经纬度数据开启双精度，避免大于 22 层级以上出现数据偏移\n    this.registerPosition64LowAttribute();\n    this.styleAttributeService.registerStyleAttribute({\n      name: 'uv',\n      type: AttributeType.Attribute,\n      descriptor: {\n        name: 'a_Uv',\n        shaderLocation: this.attributeLocation.UV,\n        buffer: {\n          usage: gl.DYNAMIC_DRAW,\n          data: [],\n          type: gl.FLOAT\n        },\n        size: 2,\n        update: (feature, featureIdx, vertex) => {\n          return [vertex[3], vertex[4]];\n        }\n      }\n    });\n  }\n}","map":{"version":3,"names":["_asyncToGenerator","_defineProperty","AttributeType","gl","defaultValue","BaseModel","RasterImageTriangulation","ImageFrag","ImageVert","ImageModel","constructor","args","attributeLocation","Object","assign","MAX","UV","getCommonUniformsInfo","opacity","brightness","contrast","saturation","gamma","layer","getLayerConfig","commonOptions","u_opacity","u_brightness","u_contrast","u_saturation","u_gamma","textures","texture","commonBufferInfo","getUniformsBufferInfo","initModels","_this","loadTexture","buildModels","clearModels","_this$texture","destroy","_this2","createTexture2D","rendererService","source","getSource","imageData","data","images","width","height","mag","LINEAR","min","_this3","initUniformsBuffer","model","buildLayerModel","moduleName","vertexShader","fragmentShader","defines","getDefines","triangulation","primitive","TRIANGLES","blend","enable","depth","pickingEnabled","registerBuiltinAttributes","registerPosition64LowAttribute","styleAttributeService","registerStyleAttribute","name","type","Attribute","descriptor","shaderLocation","buffer","usage","DYNAMIC_DRAW","FLOAT","size","update","feature","featureIdx","vertex"],"sources":["/Users/bhanudahiya/Desktop/ledger-IQ/node_modules/@antv/l7-layers/es/image/models/image.js"],"sourcesContent":["import _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { AttributeType, gl } from '@antv/l7-core';\nimport { defaultValue } from '@antv/l7-utils';\nimport BaseModel from \"../../core/BaseModel\";\nimport { RasterImageTriangulation } from \"../../core/triangulation\";\n/* babel-plugin-inline-import '../shaders/image_frag.glsl' */\nconst ImageFrag = \"uniform sampler2D u_texture;\\nlayout(std140) uniform commonUniforms {\\n    float u_opacity:1.0;\\n    float u_brightness:1.0;\\n    float u_contrast:1.0;\\n    float u_saturation:1.0;\\n    float u_gamma:1.0;\\n};\\n\\nin vec2 v_texCoord;\\nout vec4 outputColor;\\nvec3 setContrast(vec3 rgb, float contrast) {\\n  vec3 color = mix(vec3(0.5), rgb, contrast);\\n  color = clamp(color, 0.0, 1.0);\\n  return color;\\n}\\nvec3 setSaturation(vec3 rgb, float adjustment) {\\n  const vec3 grayVector = vec3(0.2125, 0.7154, 0.0721);\\n  vec3 intensity = vec3(dot(rgb, grayVector));\\n  vec3 color = mix(intensity, rgb, adjustment);\\n  color = clamp(color, 0.0, 1.0);\\n  return color;\\n}\\nvoid main() {\\n  vec4 color = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y));\\n  //brightness\\n  color.rgb = mix(vec3(0.0, 0.0, 0.0), color.rgb, u_brightness);\\n  //contrast\\n  color.rgb = setContrast(color.rgb, u_contrast);\\n  // saturation\\n  color.rgb = setSaturation(color.rgb, u_saturation);\\n  // gamma\\n  color.rgb = pow(color.rgb, vec3(u_gamma));\\n  outputColor = color;\\n  outputColor.a *= u_opacity;\\n  if(outputColor.a < 0.01)\\n    discard;\\n}\\n\";\n/* babel-plugin-inline-import '../shaders/image_vert.glsl' */\nconst ImageVert = \"layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;\\n\\nlayout(std140) uniform commonUniforms {\\n    float u_opacity:1.0;\\n    float u_brightness:1.0;\\n    float u_contrast:1.0;\\n    float u_saturation:1.0;\\n    float u_gamma:1.0;\\n};\\n\\nout vec2 v_texCoord;\\n#pragma include \\\"projection\\\"\\n\\nvoid main() {\\n  v_texCoord = a_Uv;\\n  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);\\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));\\n}\\n\";\nexport default class ImageModel extends BaseModel {\n  constructor(...args) {\n    super(...args);\n    _defineProperty(this, \"texture\", void 0);\n  }\n  get attributeLocation() {\n    return Object.assign(super.attributeLocation, {\n      MAX: super.attributeLocation.MAX,\n      UV: 9\n    });\n  }\n  getCommonUniformsInfo() {\n    const {\n      opacity,\n      brightness,\n      contrast,\n      saturation,\n      gamma\n    } = this.layer.getLayerConfig();\n    const commonOptions = {\n      u_opacity: defaultValue(opacity, 1.0),\n      u_brightness: defaultValue(brightness, 1.0),\n      u_contrast: defaultValue(contrast, 1.0),\n      u_saturation: defaultValue(saturation, 1.0),\n      u_gamma: defaultValue(gamma, 1.0)\n    };\n    this.textures = [this.texture];\n    const commonBufferInfo = this.getUniformsBufferInfo(commonOptions);\n    return commonBufferInfo;\n  }\n  initModels() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      yield _this.loadTexture();\n      return _this.buildModels();\n    })();\n  }\n  clearModels() {\n    var _this$texture;\n    (_this$texture = this.texture) === null || _this$texture === void 0 || _this$texture.destroy();\n  }\n  loadTexture() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      const {\n        createTexture2D\n      } = _this2.rendererService;\n      const source = _this2.layer.getSource();\n      const imageData = yield source.data.images;\n      _this2.texture = createTexture2D({\n        data: imageData[0],\n        width: imageData[0].width,\n        height: imageData[0].height,\n        mag: gl.LINEAR,\n        min: gl.LINEAR\n      });\n    })();\n  }\n  buildModels() {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      _this3.initUniformsBuffer();\n      const model = yield _this3.layer.buildLayerModel({\n        moduleName: 'rasterImage',\n        vertexShader: ImageVert,\n        fragmentShader: ImageFrag,\n        defines: _this3.getDefines(),\n        triangulation: RasterImageTriangulation,\n        primitive: gl.TRIANGLES,\n        blend: {\n          // Tip: 优化显示效果\n          enable: true\n        },\n        depth: {\n          enable: false\n        },\n        pickingEnabled: false\n      });\n      return [model];\n    })();\n  }\n  registerBuiltinAttributes() {\n    // 注册 Position 属性 64 位地位部分，经纬度数据开启双精度，避免大于 22 层级以上出现数据偏移\n    this.registerPosition64LowAttribute();\n    this.styleAttributeService.registerStyleAttribute({\n      name: 'uv',\n      type: AttributeType.Attribute,\n      descriptor: {\n        name: 'a_Uv',\n        shaderLocation: this.attributeLocation.UV,\n        buffer: {\n          usage: gl.DYNAMIC_DRAW,\n          data: [],\n          type: gl.FLOAT\n        },\n        size: 2,\n        update: (feature, featureIdx, vertex) => {\n          return [vertex[3], vertex[4]];\n        }\n      }\n    });\n  }\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}