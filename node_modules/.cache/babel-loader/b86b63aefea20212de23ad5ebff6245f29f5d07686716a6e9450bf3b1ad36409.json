{"ast":null,"code":"import { deepMix, each, isString } from '@antv/util';\nimport { createDom, modifyCSS } from '@antv/dom-util';\nimport { hasClass } from '../utils/dom';\nexport class Component {\n  constructor(options) {\n    this.destroyed = false;\n    this.options = deepMix({}, this.getDefaultOptions(), options);\n    this.container = this.initContainer();\n    this.initDom();\n    this.applyStyles();\n    this.initEvent();\n    this.initCapture();\n    this.initVisible();\n    this.render();\n  }\n  /**\n   * 获取默认配置\n   */\n  getDefaultOptions() {\n    return {\n      name: '',\n      containerTpl: '<div></div>',\n      visible: true,\n      capture: true,\n      domStyles: {}\n    };\n  }\n  /**\n   * 获取 container\n   */\n  getContainer() {\n    return this.container;\n  }\n  /**\n   * 获取组件的父容器\n   */\n  getParentContainer() {\n    const parent = this.options.parent;\n    let parentContainer;\n    if (!parent) {\n      return parentContainer;\n    }\n    if (isString(parent)) {\n      const parentElement = document.getElementById(parent);\n      if (parentElement) {\n        parentContainer = parentElement;\n      } else {\n        throw new Error(`No parent id ${parent}`);\n      }\n    } else {\n      parentContainer = parent;\n    }\n    return parentContainer;\n  }\n  /**\n   * 初始化 container\n   */\n  initContainer() {\n    const container = this.createDom(this.options.containerTpl);\n    const parentContainer = this.getParentContainer();\n    if (parentContainer) {\n      parentContainer.appendChild(container);\n    }\n    return container;\n  }\n  /**\n   * 初始化 visible\n   */\n  initVisible() {\n    if (this.options.visible) {\n      this.show();\n    } else {\n      this.hide();\n    }\n  }\n  /**\n   * 初始 capture\n   */\n  initCapture() {\n    this.setCapture(this.options.capture);\n  }\n  /**\n   * 更新组件\n   */\n  update(options) {\n    this.options = deepMix({}, this.options, options);\n    this.updateInner(options);\n    this.afterUpdate(options);\n  }\n  // 更新组件样式\n  updateInner(options) {\n    if (options.domStyles) {\n      this.applyStyles();\n    }\n  }\n  /**\n   * 更新组件后\n   */\n  afterUpdate(options) {\n    // 更新时考虑capture\n    if (options.capture) {\n      this.setCapture(options.capture);\n    }\n  }\n  /**\n   * 是否允许捕捉事件\n   */\n  setCapture(capture) {\n    const container = this.container;\n    const value = capture ? 'auto' : 'none';\n    container.style.pointerEvents = value;\n  }\n  /**\n   * 应用所有的样式\n   */\n  applyStyles() {\n    const domStyles = this.options.domStyles;\n    if (!domStyles) {\n      return;\n    }\n    const container = this.container;\n    this.applyChildrenStyles(container, domStyles);\n    const className = this.options.className;\n    if (className && hasClass(container, className)) {\n      const containerCss = domStyles[className];\n      modifyCSS(container, containerCss);\n    }\n  }\n  /**\n   * 应用样式到 DOM\n   */\n  applyChildrenStyles(element, styles) {\n    each(styles, (style, name) => {\n      const elements = element.getElementsByClassName(name);\n      each(elements, el => {\n        modifyCSS(el, style);\n      });\n    });\n  }\n  /**\n   * 应用到单个 DOM\n   */\n  applyStyle(cssName, dom) {\n    const domStyles = this.options.domStyles;\n    domStyles && modifyCSS(dom, domStyles[cssName]);\n  }\n  /**\n   * 创建 DOM\n   */\n  createDom(str = '<div></div>') {\n    return createDom(str);\n  }\n  /**\n   * 清理 DOM\n   */\n  removeDom() {\n    const container = this.container;\n    // 节点不一定有 parentNode\n    container && container.parentNode && container.parentNode.removeChild(container);\n  }\n  destroy() {\n    this.removeEvent();\n    this.removeDom();\n    this.destroyed = true;\n  }\n}","map":{"version":3,"names":["deepMix","each","isString","createDom","modifyCSS","hasClass","Component","constructor","options","destroyed","getDefaultOptions","container","initContainer","initDom","applyStyles","initEvent","initCapture","initVisible","render","name","containerTpl","visible","capture","domStyles","getContainer","getParentContainer","parent","parentContainer","parentElement","document","getElementById","Error","appendChild","show","hide","setCapture","update","updateInner","afterUpdate","value","style","pointerEvents","applyChildrenStyles","className","containerCss","element","styles","elements","getElementsByClassName","el","applyStyle","cssName","dom","str","removeDom","parentNode","removeChild","destroy","removeEvent"],"sources":["../../../src/core/component.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}