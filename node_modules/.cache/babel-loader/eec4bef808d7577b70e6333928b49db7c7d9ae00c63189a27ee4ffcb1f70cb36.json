{"ast":null,"code":"import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { lngLatInExtent } from '@antv/l7-utils';\nexport default class BaseLayerPickService {\n  constructor(layer) {\n    _defineProperty(this, \"layer\", void 0);\n    this.layer = layer;\n  }\n  pickRender(target) {\n    const container = this.layer.getContainer();\n    const layerService = container.layerService;\n    const layer = this.layer;\n    // 瓦片图层的拾取绘制\n    if (layer.tileLayer) {\n      return layer.tileLayer.pickRender(target);\n    }\n    // 渲染瓦片图层的拾取\n    layer.hooks.beforePickingEncode.call();\n    layerService.renderTileLayerMask(layer);\n    layer.renderModels({\n      ispick: true\n    });\n    layer.hooks.afterPickingEncode.call();\n  }\n  pick(layer, target) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      const container = _this.layer.getContainer();\n      const pickingService = container.pickingService;\n      if (layer.type === 'RasterLayer') {\n        return _this.pickRasterLayer(layer, target);\n      }\n      _this.pickRender(target);\n      return pickingService.pickFromPickingFBO(layer, target);\n    })();\n  }\n  pickRasterLayer(layer, target, parent) {\n    const container = this.layer.getContainer();\n    const pickingService = container.pickingService;\n    const mapService = container.mapService;\n    const extent = this.layer.getSource().extent;\n    const isPick = lngLatInExtent(target.lngLat, extent);\n    const layerTarget = {\n      x: target.x,\n      y: target.y,\n      type: target.type,\n      lngLat: target.lngLat,\n      target,\n      rasterValue: null\n    };\n    const adviceTarget = parent ? parent : layer;\n    if (isPick) {\n      const rasterValue = this.readRasterValue(layer, extent, mapService, target.x, target.y);\n      layerTarget.rasterValue = rasterValue;\n      pickingService.triggerHoverOnLayer(adviceTarget, layerTarget);\n      return true;\n    } else {\n      layerTarget.type = target.type === 'mousemove' ? 'mouseout' : 'un' + target.type;\n      pickingService.triggerHoverOnLayer(adviceTarget, _objectSpread(_objectSpread({}, layerTarget), {}, {\n        type: 'unpick'\n      }));\n      pickingService.triggerHoverOnLayer(adviceTarget, layerTarget);\n      return false;\n    }\n  }\n  readRasterValue(layer, bbox, mapService, x, y) {\n    const rasterData = layer.getSource().data.dataArray[0];\n    const [minLng = 0, minLat = 0, maxLng = 10, maxLat = -10] = bbox;\n    const tileXY = mapService.lngLatToContainer([minLng, minLat]);\n    const tileMaxXY = mapService.lngLatToContainer([maxLng, maxLat]);\n    const tilePixelWidth = tileMaxXY.x - tileXY.x;\n    const tilePixelHeight = tileXY.y - tileMaxXY.y;\n    const pos = [(x - tileXY.x) / tilePixelWidth,\n    // x\n    (y - tileMaxXY.y) / tilePixelHeight // y\n    ];\n    const tileWidth = rasterData.width || 1;\n    const tileHeight = rasterData.height || 1;\n    const indexX = Math.floor(pos[0] * tileWidth);\n    const indexY = Math.floor(pos[1] * tileHeight);\n    const index = Math.max(0, indexY - 1) * tileWidth + indexX;\n    const data = rasterData.data[index];\n    return data;\n  }\n  selectFeature(pickedColors) {\n    const layer = this.layer;\n    // @ts-ignore\n    const [r, g, b] = pickedColors;\n    layer.hooks.beforeSelect.call([r, g, b]);\n  }\n  highlightPickedFeature(pickedColors) {\n    // @ts-ignore\n    const [r, g, b] = pickedColors;\n    this.layer.hooks.beforeHighlight.call([r, g, b]);\n  }\n  getFeatureById(pickedFeatureIdx) {\n    return this.layer.getSource().getFeatureById(pickedFeatureIdx);\n  }\n}","map":{"version":3,"names":["_objectSpread","_asyncToGenerator","_defineProperty","lngLatInExtent","BaseLayerPickService","constructor","layer","pickRender","target","container","getContainer","layerService","tileLayer","hooks","beforePickingEncode","call","renderTileLayerMask","renderModels","ispick","afterPickingEncode","pick","_this","pickingService","type","pickRasterLayer","pickFromPickingFBO","parent","mapService","extent","getSource","isPick","lngLat","layerTarget","x","y","rasterValue","adviceTarget","readRasterValue","triggerHoverOnLayer","bbox","rasterData","data","dataArray","minLng","minLat","maxLng","maxLat","tileXY","lngLatToContainer","tileMaxXY","tilePixelWidth","tilePixelHeight","pos","tileWidth","width","tileHeight","height","indexX","Math","floor","indexY","index","max","selectFeature","pickedColors","r","g","b","beforeSelect","highlightPickedFeature","beforeHighlight","getFeatureById","pickedFeatureIdx"],"sources":["/Users/bhanudahiya/Desktop/ledger-IQ/node_modules/@antv/l7-layers/es/core/LayerPickService.js"],"sourcesContent":["import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { lngLatInExtent } from '@antv/l7-utils';\nexport default class BaseLayerPickService {\n  constructor(layer) {\n    _defineProperty(this, \"layer\", void 0);\n    this.layer = layer;\n  }\n  pickRender(target) {\n    const container = this.layer.getContainer();\n    const layerService = container.layerService;\n    const layer = this.layer;\n    // 瓦片图层的拾取绘制\n    if (layer.tileLayer) {\n      return layer.tileLayer.pickRender(target);\n    }\n    // 渲染瓦片图层的拾取\n    layer.hooks.beforePickingEncode.call();\n    layerService.renderTileLayerMask(layer);\n    layer.renderModels({\n      ispick: true\n    });\n    layer.hooks.afterPickingEncode.call();\n  }\n  pick(layer, target) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      const container = _this.layer.getContainer();\n      const pickingService = container.pickingService;\n      if (layer.type === 'RasterLayer') {\n        return _this.pickRasterLayer(layer, target);\n      }\n      _this.pickRender(target);\n      return pickingService.pickFromPickingFBO(layer, target);\n    })();\n  }\n  pickRasterLayer(layer, target, parent) {\n    const container = this.layer.getContainer();\n    const pickingService = container.pickingService;\n    const mapService = container.mapService;\n    const extent = this.layer.getSource().extent;\n    const isPick = lngLatInExtent(target.lngLat, extent);\n    const layerTarget = {\n      x: target.x,\n      y: target.y,\n      type: target.type,\n      lngLat: target.lngLat,\n      target,\n      rasterValue: null\n    };\n    const adviceTarget = parent ? parent : layer;\n    if (isPick) {\n      const rasterValue = this.readRasterValue(layer, extent, mapService, target.x, target.y);\n      layerTarget.rasterValue = rasterValue;\n      pickingService.triggerHoverOnLayer(adviceTarget, layerTarget);\n      return true;\n    } else {\n      layerTarget.type = target.type === 'mousemove' ? 'mouseout' : 'un' + target.type;\n      pickingService.triggerHoverOnLayer(adviceTarget, _objectSpread(_objectSpread({}, layerTarget), {}, {\n        type: 'unpick'\n      }));\n      pickingService.triggerHoverOnLayer(adviceTarget, layerTarget);\n      return false;\n    }\n  }\n  readRasterValue(layer, bbox, mapService, x, y) {\n    const rasterData = layer.getSource().data.dataArray[0];\n    const [minLng = 0, minLat = 0, maxLng = 10, maxLat = -10] = bbox;\n    const tileXY = mapService.lngLatToContainer([minLng, minLat]);\n    const tileMaxXY = mapService.lngLatToContainer([maxLng, maxLat]);\n    const tilePixelWidth = tileMaxXY.x - tileXY.x;\n    const tilePixelHeight = tileXY.y - tileMaxXY.y;\n    const pos = [(x - tileXY.x) / tilePixelWidth,\n    // x\n    (y - tileMaxXY.y) / tilePixelHeight // y\n    ];\n    const tileWidth = rasterData.width || 1;\n    const tileHeight = rasterData.height || 1;\n    const indexX = Math.floor(pos[0] * tileWidth);\n    const indexY = Math.floor(pos[1] * tileHeight);\n    const index = Math.max(0, indexY - 1) * tileWidth + indexX;\n    const data = rasterData.data[index];\n    return data;\n  }\n  selectFeature(pickedColors) {\n    const layer = this.layer;\n    // @ts-ignore\n    const [r, g, b] = pickedColors;\n    layer.hooks.beforeSelect.call([r, g, b]);\n  }\n  highlightPickedFeature(pickedColors) {\n    // @ts-ignore\n    const [r, g, b] = pickedColors;\n    this.layer.hooks.beforeHighlight.call([r, g, b]);\n  }\n  getFeatureById(pickedFeatureIdx) {\n    return this.layer.getSource().getFeatureById(pickedFeatureIdx);\n  }\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}