{"ast":null,"code":"import { __awaiter } from \"tslib\";\nimport { uuidv4 } from '@antv/xflow-core';\nimport { isNumber } from 'lodash';\nimport { setProps, getProps } from '../flowchart-canvas/utils';\nimport * as NodesComponent from './nodes';\nimport { NODE_HEIGHT, NODE_WIDTH, NODEPOOL } from './constants';\nimport { isArray } from 'lodash';\n/** 和 graph config 注册的节点保持一致 */\nconst getAnchorStyle = position => {\n  return {\n    position: {\n      name: position\n    },\n    attrs: {\n      circle: {\n        r: 4,\n        magnet: true,\n        stroke: '#31d0c6',\n        strokeWidth: 2,\n        fill: '#fff',\n        style: {\n          visibility: 'hidden'\n        }\n      }\n    },\n    zIndex: 10\n  };\n};\nconst getPorts = (position = ['top', 'right', 'bottom', 'left']) => {\n  return {\n    items: position.map(name => {\n      return {\n        group: name,\n        id: uuidv4()\n      };\n    }),\n    groups: {\n      top: getAnchorStyle('top'),\n      right: getAnchorStyle('right'),\n      bottom: getAnchorStyle('bottom'),\n      left: getAnchorStyle('left')\n    }\n  };\n};\nexport const getRegisterNode = nodes => {\n  return (nodes || []).map(item => {\n    const {\n      name,\n      popover,\n      label = '',\n      width = NODE_HEIGHT,\n      height = NODE_HEIGHT,\n      ports,\n      parentKey\n    } = item;\n    const id = uuidv4(); // 暂不使用上层数据\n    return {\n      id,\n      renderKey: name,\n      name,\n      label,\n      popoverContent: popover,\n      width,\n      height,\n      ports: ports || getPorts(),\n      originData: Object.assign({}, item),\n      isCustom: true,\n      parentKey\n    };\n  });\n};\nexport const nodeService = nodes => __awaiter(void 0, void 0, void 0, function* () {\n  const customNodes = getRegisterNode(nodes);\n  return [...customNodes, ...NODEPOOL.map(({\n    name,\n    ports,\n    width = NODE_WIDTH,\n    height = NODE_HEIGHT,\n    label = ''\n  }) => {\n    return {\n      id: uuidv4(),\n      renderKey: name,\n      name,\n      label,\n      popoverContent: () => name,\n      width,\n      height,\n      ports: getPorts(ports)\n    };\n  })];\n});\nexport const registerCustomNode = panelConfigs => {\n  const registerNodes = panelConfigs ? isArray(panelConfigs) ? panelConfigs : [panelConfigs] : [];\n  let nodes = [];\n  registerNodes.forEach(item => {\n    nodes = nodes.concat(item.nodes.map(node => Object.assign(Object.assign({}, node), {\n      parentKey: item.key\n    })));\n  });\n  if (nodes.length) {\n    setProps({\n      registerNode: nodes\n    });\n  }\n  const graphConfig = getProps('graphConfig');\n  const registerNode = getProps('registerNode');\n  if (!graphConfig || !(registerNode === null || registerNode === void 0 ? void 0 : registerNode.length)) {\n    return;\n  }\n  registerNode.forEach(item => {\n    const {\n      name,\n      component\n    } = item;\n    graphConfig.setNodeRender(name, component);\n  });\n};\nexport const setNodeRender = graphConfig => {\n  /** props 共享 */\n  registerCustomNode();\n  /** 默认节点，通过 Terminal 标识，避免多次调用*/\n  if (!graphConfig.nodeRender.get('Terminal')) {\n    NODEPOOL.forEach(item => {\n      ;\n      graphConfig.setNodeRender(item.name, NodesComponent[`${item.name.replace(/\\s+/g, '')}Node`]);\n    });\n  }\n};\n// 创建节点路径\nexport const createPath = (paths, offsetX = 0, offsetY = 0) => {\n  if (!paths.length) {\n    return null;\n  }\n  let path = '';\n  // @ts-ignore\n  paths.forEach(item => {\n    const [c, x, y, c2x, c2y] = item;\n    path += isNumber(y) ? ` ${c} ${x + offsetX} ${y + offsetY}` : ` ${c}`;\n    if (c2y) {\n      path += ` ${c2x + offsetX} ${c2y + offsetY}`;\n    }\n  });\n  return path;\n};","map":{"version":3,"names":["uuidv4","isNumber","setProps","getProps","NodesComponent","NODE_HEIGHT","NODE_WIDTH","NODEPOOL","isArray","getAnchorStyle","position","name","attrs","circle","r","magnet","stroke","strokeWidth","fill","style","visibility","zIndex","getPorts","items","map","group","id","groups","top","right","bottom","left","getRegisterNode","nodes","item","popover","label","width","height","ports","parentKey","renderKey","popoverContent","originData","Object","assign","isCustom","nodeService","__awaiter","customNodes","registerCustomNode","panelConfigs","registerNodes","forEach","concat","node","key","length","registerNode","graphConfig","component","setNodeRender","nodeRender","get","replace","createPath","paths","offsetX","offsetY","path","c","x","y","c2x","c2y"],"sources":["../../src/flowchart-node-panel/utils.tsx"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}