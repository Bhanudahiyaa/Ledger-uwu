{"ast":null,"code":"import { __awaiter } from \"tslib\";\nimport React, { useCallback } from 'react';\nimport { Empty, Collapse } from 'antd';\nimport { Addon } from '@antv/x6';\nimport { getNodeReactComponent, useXFlowApp, uuidv4, XFlowNodeCommands } from '@antv/xflow-core';\nimport { getProps } from '../flowchart-canvas/utils';\nimport { NodeTitle, defaultNodeFactory } from '../canvas-node-tree-panel/panel-body';\nimport { isArray } from 'lodash';\nconst {\n  Panel\n} = Collapse;\nexport const NodePanelBody = props => {\n  const {\n    x6NodeFactory,\n    dndOptions,\n    state,\n    prefixClz,\n    defaultActiveKey = ['official'],\n    showOfficial = true\n  } = props;\n  const registerNode = props.registerNode ? isArray(props.registerNode) ? props.registerNode : [props.registerNode] : [];\n  const {\n    graphProvider,\n    modelService,\n    commandService\n  } = useXFlowApp();\n  const [dnd, setDnd] = React.useState();\n  /** 获取graph实例 */\n  const [graph, setGraph] = React.useState();\n  React.useEffect(() => {\n    graphProvider.getGraphInstance().then(x6Graph => {\n      setGraph(x6Graph);\n    });\n  });\n  let graphConfig = undefined;\n  graphProvider.getGraphOptions().then(x6GraphConfig => {\n    graphConfig = x6GraphConfig;\n  });\n  const onNodeDrop = useCallback(node => __awaiter(void 0, void 0, void 0, function* () {\n    var _a;\n    const {\n      ports\n    } = node;\n    const nodeConfig = Object.assign(Object.assign({}, node), {\n      id: `node-${uuidv4()}`,\n      zIndex: 10,\n      ports: Object.assign(Object.assign({}, ports), {\n        items: (_a = ports.items) === null || _a === void 0 ? void 0 : _a.map(item => Object.assign(Object.assign({}, item), {\n          id: uuidv4()\n        }))\n      })\n    });\n    const args = {\n      nodeConfig\n    };\n    yield commandService.executeCommand(XFlowNodeCommands.ADD_NODE.id, args);\n    const onAddNode = getProps('onAddNode');\n    if (typeof onAddNode === 'function') {\n      onAddNode(nodeConfig);\n    }\n  }), [commandService]);\n  React.useEffect(() => {\n    if (!graph) {\n      return;\n    }\n    const dndInstance = new Addon.Dnd(Object.assign(Object.assign({\n      scaled: false,\n      animation: false\n    }, dndOptions), {\n      target: graph,\n      /** 这里考虑到需要新增群组的需求，不使用x6的getDropNod方法\n       * 在validateNode时调用command添加\n       */\n      validateNode: droppingNode => __awaiter(void 0, void 0, void 0, function* () {\n        const nodeConfig = Object.assign(Object.assign({}, droppingNode.getData()), droppingNode.getPosition());\n        yield onNodeDrop(nodeConfig);\n        return false;\n      })\n    }));\n    setDnd(dndInstance);\n  }, [commandService, dndOptions, graph, modelService, onNodeDrop]);\n  const onMouseDown = React.useCallback(nodeConfig => e => {\n    if (!graph || !dnd || !graphConfig) {\n      return;\n    }\n    const renderKey = graphConfig.nodeTypeParser(nodeConfig);\n    const {\n      width = 180,\n      height = 40\n    } = nodeConfig;\n    const reactComponent = graphConfig.nodeRender.get(renderKey);\n    const wrappedComponent = getNodeReactComponent(reactComponent, commandService, modelService);\n    const nodeData = {\n      data: nodeConfig,\n      width,\n      height,\n      view: graphConfig.graphId,\n      component: wrappedComponent\n    };\n    const x6Node = x6NodeFactory ? x6NodeFactory(nodeData) : defaultNodeFactory(nodeData);\n    dnd.start(x6Node, e.nativeEvent);\n  }, [commandService, dnd, graph, graphConfig, modelService, x6NodeFactory]);\n  const renderTree = React.useCallback((list = []) => {\n    return list.map(item => {\n      const {\n        popoverContent\n      } = item;\n      return React.createElement(NodeTitle, {\n        item: item,\n        key: item.id,\n        onMouseDown: onMouseDown(item),\n        popoverContent: popoverContent,\n        prefixClz: prefixClz,\n        modelService: modelService,\n        commandService: commandService,\n        graphConfig: graphConfig\n      });\n    });\n  }, [commandService, graphConfig, modelService, onMouseDown, prefixClz]);\n  const officialNode = state.nodeList.filter(item => !item.isCustom);\n  const searchOfficialNode = state.searchList.filter(item => !item.isCustom);\n  const customNode = key => {\n    return state.nodeList.filter(item => item.isCustom && item.parentKey === key);\n  };\n  const searchCustomNode = key => {\n    return state.searchList.filter(item => item.isCustom && item.parentKey === key);\n  };\n  return React.createElement(React.Fragment, null, React.createElement(\"div\", {\n    className: `${prefixClz}-body`\n  }, React.createElement(Collapse, {\n    defaultActiveKey: defaultActiveKey,\n    style: {\n      border: 'none'\n    }\n  }, showOfficial && React.createElement(Panel, {\n    header: \"\\u901A\\u7528\\u8282\\u70B9\",\n    key: \"official\",\n    style: {\n      border: 'none'\n    }\n  }, !state.keyword && React.createElement(\"div\", {\n    className: `${prefixClz}-official`\n  }, renderTree(officialNode)), state.searchList.length > 0 && React.createElement(\"div\", {\n    className: `${prefixClz}-official`\n  }, renderTree(searchOfficialNode))), (registerNode === null || registerNode === void 0 ? void 0 : registerNode.length) > 0 && registerNode.map(item => !item.hidden && item.nodes.length > 0 && React.createElement(Panel, {\n    header: item.title,\n    key: item.key,\n    style: {\n      border: 'none'\n    }\n  }, !state.keyword && React.createElement(\"div\", {\n    className: `${prefixClz}-custom`\n  }, renderTree(customNode(item.key))), state.searchList.length > 0 && React.createElement(\"div\", {\n    className: `${prefixClz}-custom`\n  }, renderTree(searchCustomNode(item.key)))))), state.keyword && state.searchList.length === 0 && React.createElement(Empty, {\n    style: {\n      marginTop: '48px'\n    }\n  })));\n};","map":{"version":3,"names":["React","useCallback","Empty","Collapse","Addon","getNodeReactComponent","useXFlowApp","uuidv4","XFlowNodeCommands","getProps","NodeTitle","defaultNodeFactory","isArray","Panel","NodePanelBody","props","x6NodeFactory","dndOptions","state","prefixClz","defaultActiveKey","showOfficial","registerNode","graphProvider","modelService","commandService","dnd","setDnd","useState","graph","setGraph","useEffect","getGraphInstance","then","x6Graph","graphConfig","undefined","getGraphOptions","x6GraphConfig","onNodeDrop","node","__awaiter","ports","nodeConfig","Object","assign","id","zIndex","items","_a","map","item","args","executeCommand","ADD_NODE","onAddNode","dndInstance","Dnd","scaled","animation","target","validateNode","droppingNode","getData","getPosition","onMouseDown","e","renderKey","nodeTypeParser","width","height","reactComponent","nodeRender","get","wrappedComponent","nodeData","data","view","graphId","component","x6Node","start","nativeEvent","renderTree","list","popoverContent","createElement","key","officialNode","nodeList","filter","isCustom","searchOfficialNode","searchList","customNode","parentKey","searchCustomNode","Fragment","className","style","border","header","keyword","length","hidden","nodes","title","marginTop"],"sources":["../../src/flowchart-node-panel/panel-body.tsx"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}