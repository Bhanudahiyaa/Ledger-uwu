{"ast":null,"code":"import { __rest } from \"tslib\";\nimport { isEqual, isUndefined, pick } from '@antv/util';\nimport { Source } from '@antv/l7';\nimport EventEmitter from '@antv/event-emitter';\nimport { LayerType } from '../../types/layer';\nimport { MappingSource } from '../../adaptor/source';\nimport { LayerEventList } from '../map/constants';\nimport { deepAssign } from '../../utils';\nconst LayerConfigkeys = ['name', 'zIndex', 'visible', 'minZoom', 'maxZoom', 'pickingBuffer', 'autoFit', 'blend'];\nexport class PlotLayer extends EventEmitter {\n  constructor(options) {\n    super();\n    this.options = deepAssign({}, this.getDefaultOptions(), options);\n    this.lastOptions = this.options;\n  }\n  /**\n   * 获取默认配置\n   */\n  getDefaultOptions() {\n    return {};\n  }\n  pickLayerConfig(params) {\n    const config = pick(params, LayerConfigkeys);\n    return config;\n  }\n  addTo(scene) {\n    scene.addLayer(this.layer);\n  }\n  remove(scene) {\n    scene.removeLayer(this.layer);\n  }\n  /**\n   * 更新\n   */\n  update(options) {\n    this.updateOption(options);\n    this.updateConfig(options);\n  }\n  /**\n   * 更新: 更新配置\n   */\n  updateOption(options) {\n    this.lastOptions = this.options;\n    this.options = deepAssign({}, this.options, options);\n  }\n  // 更新: 更新图层属性配置\n  updateConfig(options) {\n    if (!isUndefined(options.zIndex) && !isEqual(this.lastOptions.zIndex, this.options.zIndex)) {\n      this.setIndex(options.zIndex);\n    }\n    if (!isUndefined(options.blend) && !isEqual(this.lastOptions.blend, this.options.blend)) {\n      this.setBlend(options.blend);\n    }\n    if (!isUndefined(options.minZoom) && !isEqual(this.lastOptions.minZoom, this.options.minZoom)) {\n      this.setMinZoom(options.minZoom);\n    }\n    if (!isUndefined(options.maxZoom) && !isEqual(this.lastOptions.maxZoom, this.options.maxZoom)) {\n      this.setMinZoom(options.maxZoom);\n    }\n    if (!isUndefined(options.visible) && !isEqual(this.lastOptions.visible, this.options.visible)) {\n      options.visible ? this.show() : this.hide();\n    }\n  }\n  render() {\n    this.layer.renderLayers();\n  }\n  setSource(source) {\n    if (source instanceof Source) {\n      this.layer.setSource(source);\n    } else {\n      const {\n          data,\n          aggregation\n        } = source,\n        option = __rest(source, [\"data\", \"aggregation\"]);\n      aggregation && MappingSource.aggregation(option, aggregation);\n      const layerSource = this.layer.getSource();\n      if (layerSource) {\n        this.layer.setData(data, option);\n      } else {\n        this.layer.source(data, option);\n      }\n    }\n  }\n  changeData(source) {\n    this.setSource(source);\n  }\n  setIndex(zIndex) {\n    this.layer.setIndex(zIndex);\n  }\n  setBlend(blend) {\n    this.layer.setBlend(blend);\n  }\n  setMinZoom(minZoom) {\n    this.layer.setMinZoom(minZoom);\n  }\n  setMaxZoom(maxZoom) {\n    this.layer.setMaxZoom(maxZoom);\n  }\n  show() {\n    this.layer.inited && this.layer.show();\n  }\n  hide() {\n    this.layer.inited && this.layer.hide();\n  }\n  toggleVisible() {\n    this.isVisible() ? this.hide() : this.show();\n  }\n  isVisible() {\n    return this.layer.inited ? this.layer.isVisible() : this.options.visible;\n  }\n  fitBounds(fitBoundsOptions) {\n    this.layer.fitBounds(fitBoundsOptions);\n  }\n  /**\n   * 事件代理: 绑定事件\n   */\n  on(name, callback) {\n    if (LayerEventList.indexOf(name) !== -1) {\n      this.layer.on(name, callback);\n    } else {\n      super.on(name, callback);\n    }\n    return this;\n  }\n  /**\n   * 事件代理: 绑定一次事件\n   */\n  once(name, callback) {\n    if (LayerEventList.indexOf(name) !== -1) {\n      this.layer.once(name, callback);\n    } else {\n      super.once(name, callback);\n    }\n    return this;\n  }\n  /**\n   * 事件代理: 解绑事件\n   */\n  off(name, callback) {\n    if (LayerEventList.indexOf(name) !== -1) {\n      this.layer.off(name, callback);\n    } else {\n      super.off(name, callback);\n    }\n    return this;\n  }\n}\n/**\n * 地图图表类型\n */\nPlotLayer.LayerType = LayerType;\n/**\n * 图层属性配置项 Keys\n */\nPlotLayer.LayerConfigkeys = LayerConfigkeys;","map":{"version":3,"names":["isEqual","isUndefined","pick","Source","EventEmitter","LayerType","MappingSource","LayerEventList","deepAssign","LayerConfigkeys","PlotLayer","constructor","options","getDefaultOptions","lastOptions","pickLayerConfig","params","config","addTo","scene","addLayer","layer","remove","removeLayer","update","updateOption","updateConfig","zIndex","setIndex","blend","setBlend","minZoom","setMinZoom","maxZoom","visible","show","hide","render","renderLayers","setSource","source","data","aggregation","option","__rest","layerSource","getSource","setData","changeData","setMaxZoom","inited","toggleVisible","isVisible","fitBounds","fitBoundsOptions","on","name","callback","indexOf","once","off"],"sources":["../../../../src/core/layer/plot-layer.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}