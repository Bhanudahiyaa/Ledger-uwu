{"ast":null,"code":"import { __awaiter } from \"tslib\";\nimport React from 'react';\nimport { createModule } from '../module';\nimport { insertCss } from '@antv/xflow-core';\nimport { XFlowAppExtensionModule, usePositionStyle } from '@antv/xflow-core';\nimport { SimpleNodeView } from '../x6-node-view';\n/** 配置类型 */\nexport const CONFIG_TYPE = 'CanvasMiniMap';\n/** 获取默认配置 */\nexport const getDefaultMinimapOptions = () => {\n  return {\n    grid: false,\n    enabled: true,\n    width: 200,\n    height: 120,\n    padding: 8,\n    graphOptions: {\n      async: true,\n      getCellView(cell) {\n        if (cell.isNode()) {\n          return SimpleNodeView;\n        }\n      },\n      createCellView(cell) {\n        if (cell.isEdge()) {\n          return null;\n        }\n      }\n    }\n  };\n};\nexport const CanvasMiniMap = props => {\n  const {\n    nodeFillColor,\n    borderColor = '#ced4de',\n    handlerColor = 'rgba(0,0,0,.3)',\n    miniMapClz = '',\n    position = {\n      bottom: 12,\n      right: 12\n    },\n    minimapOptions = {}\n  } = props;\n  /** x6画布的dom节点 */\n  const minimapRef = React.useRef(null);\n  const minimapConfigRef = React.useRef(props.minimapOptions);\n  const classNameSet = React.useMemo(() => {\n    return new Set([miniMapClz, 'xflow-minimap', 'minimap-instacne-' + Date.now().toString()]);\n  }, [miniMapClz]);\n  const getConfig = React.useMemo(() => () => __awaiter(void 0, void 0, void 0, function* () {\n    return Object.assign(Object.assign(Object.assign({}, getDefaultMinimapOptions()), minimapConfigRef.current), {\n      container: minimapRef.current\n    });\n  }), [minimapRef]);\n  const style = usePositionStyle(position);\n  React.useEffect(() => {\n    /** 设置minimap容器 */\n    minimapConfigRef.current = minimapOptions;\n  }, [minimapConfigRef, minimapOptions]);\n  React.useEffect(() => {\n    /** 设置Node样式 */\n    if (nodeFillColor) {\n      SimpleNodeView.setNodeFillColor(nodeFillColor);\n    }\n  }, [nodeFillColor]);\n  React.useEffect(() => {\n    const containerSelector = Array.from(classNameSet).reduce((acc, clz) => clz ? `${acc}.${clz}` : acc, '');\n    const cssString = `\n      ${containerSelector} .x6-widget-minimap-viewport {\n        border: 1px solid ${borderColor};\n        margin: 0;\n      }\n      ${containerSelector} .x6-widget-minimap-viewport-zoom {\n        border: 1px solid ${handlerColor};\n      }\n    `;\n    const $style = insertCss(cssString);\n    return () => {\n      document.head.removeChild($style);\n    };\n  }, [borderColor, classNameSet, handlerColor]);\n  const clzName = Array.from(classNameSet).join(' ');\n  return React.createElement(XFlowAppExtensionModule, {\n    config: {\n      getConfig,\n      CONFIG_TYPE\n    },\n    createModule: createModule\n  }, React.createElement(\"div\", {\n    ref: minimapRef,\n    className: clzName,\n    style: style\n  }));\n};","map":{"version":3,"names":["React","createModule","insertCss","XFlowAppExtensionModule","usePositionStyle","SimpleNodeView","CONFIG_TYPE","getDefaultMinimapOptions","grid","enabled","width","height","padding","graphOptions","async","getCellView","cell","isNode","createCellView","isEdge","CanvasMiniMap","props","nodeFillColor","borderColor","handlerColor","miniMapClz","position","bottom","right","minimapOptions","minimapRef","useRef","minimapConfigRef","classNameSet","useMemo","Set","Date","now","toString","getConfig","__awaiter","Object","assign","current","container","style","useEffect","setNodeFillColor","containerSelector","Array","from","reduce","acc","clz","cssString","$style","document","head","removeChild","clzName","join","createElement","config","ref","className"],"sources":["../../../src/canvas-mini-map/components/index.tsx"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}