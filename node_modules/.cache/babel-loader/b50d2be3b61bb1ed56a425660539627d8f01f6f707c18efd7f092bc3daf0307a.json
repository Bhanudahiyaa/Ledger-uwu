{"ast":null,"code":"/* eslint-disable jsx-a11y/click-events-have-key-events  */\n/* eslint-disable jsx-a11y/no-static-element-interactions */\nimport React from 'react';\nimport classnames from 'classnames';\nimport addEventListener from 'rc-util/lib/Dom/addEventListener';\nimport { MenubarContext } from './context';\nconst cacheDeactiveMap = new WeakMap();\nclass MenubarItemInner extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onDocumentClick = () => {\n      this.deactive();\n    };\n    this.onClick = e => {\n      this.props.context.activeMenubar();\n      this.removeDeactive(e.currentTarget.parentElement);\n      this.active();\n    };\n    this.onMouseEnter = e => {\n      if (this.props.context.menubarActived && !this.state.active && !this.isPrevMenuHiddening(e)) {\n        const currentTarget = e.currentTarget;\n        const childNodes = currentTarget.parentElement.childNodes;\n        childNodes.forEach(child => {\n          if (child === currentTarget) {\n            this.removeDeactive(child);\n          } else {\n            this.callDeactive(child);\n          }\n        });\n        this.active();\n      }\n    };\n    this.onMouseLeave = e => {\n      const relatedTarget = e.relatedTarget;\n      const currentTarget = e.currentTarget;\n      if (this.props.context.menubarActived && this.state.active) {\n        const childNodes = currentTarget.parentElement.childNodes;\n        let shoudDeactive = false;\n        if (relatedTarget !== window) {\n          for (let i = 0, l = childNodes.length; i < l; i += 1) {\n            const child = childNodes[i];\n            if (child === relatedTarget || child.contains(relatedTarget)) {\n              shoudDeactive = true;\n              break;\n            }\n          }\n        }\n        if (shoudDeactive) {\n          this.deactive();\n        } else {\n          // 缓存一下，当再次 hover 到其他菜单时被调用\n          this.cacheDeactive(currentTarget);\n        }\n      }\n    };\n    this.active = () => {\n      this.setState({\n        active: true\n      });\n      if (!this.removeDocClickEvent) {\n        this.removeDocClickEvent = addEventListener(document.documentElement, 'click', this.onDocumentClick).remove;\n      }\n    };\n    this.deactive = () => {\n      this.setState({\n        active: false\n      });\n      if (this.removeDocClickEvent) {\n        this.removeDocClickEvent();\n        this.removeDocClickEvent = null;\n      }\n    };\n    this.popupClassName = `${props.context.prefixCls}-item-dropdown`;\n    this.state = {\n      active: false\n    };\n  }\n  isPrevMenuHiddening(e) {\n    const toElement = e.nativeEvent.toElement;\n    if (toElement && toElement.className === this.popupClassName) {\n      return true;\n    }\n    const currentTarget = e.currentTarget;\n    const childNodes = currentTarget.parentElement.childNodes;\n    for (let i = 0, l = childNodes.length; i < l; i += 1) {\n      const child = childNodes[i];\n      const popupElem = child.querySelector(`.${this.popupClassName}`);\n      if (popupElem.contains(toElement)) {\n        return true;\n      }\n    }\n    return false;\n  }\n  cacheDeactive(elem) {\n    cacheDeactiveMap.set(elem, this.deactive);\n  }\n  callDeactive(elem) {\n    if (cacheDeactiveMap.has(elem)) {\n      cacheDeactiveMap.get(elem)();\n      cacheDeactiveMap.delete(elem);\n    }\n  }\n  removeDeactive(elem) {\n    cacheDeactiveMap.delete(elem);\n  }\n  render() {\n    const {\n      text,\n      children,\n      hidden\n    } = this.props;\n    const {\n      prefixCls,\n      menubarActived\n    } = this.props.context;\n    const currentMenuActived = menubarActived && this.state.active;\n    const baseCls = `${prefixCls}-item`;\n    return React.createElement(\"div\", {\n      className: classnames(baseCls, {\n        [`${baseCls}-hidden`]: hidden,\n        [`${baseCls}-hover`]: menubarActived,\n        [`${baseCls}-active`]: currentMenuActived\n      }),\n      onMouseEnter: this.onMouseEnter,\n      onMouseLeave: this.onMouseLeave\n    }, React.createElement(\"div\", {\n      className: classnames(`${baseCls}-text`, {\n        [`${baseCls}-text-active`]: currentMenuActived\n      }),\n      onClick: this.onClick\n    }, text), React.createElement(\"div\", {\n      className: this.popupClassName\n    }, children));\n  }\n}\nexport const MenubarItem = props => React.createElement(MenubarContext.Consumer, null, context => React.createElement(MenubarItemInner, Object.assign({\n  context: context\n}, props)));","map":{"version":3,"names":["React","classnames","addEventListener","MenubarContext","cacheDeactiveMap","WeakMap","MenubarItemInner","PureComponent","constructor","props","onDocumentClick","deactive","onClick","e","context","activeMenubar","removeDeactive","currentTarget","parentElement","active","onMouseEnter","menubarActived","state","isPrevMenuHiddening","childNodes","forEach","child","callDeactive","onMouseLeave","relatedTarget","shoudDeactive","window","i","l","length","contains","cacheDeactive","setState","removeDocClickEvent","document","documentElement","remove","popupClassName","prefixCls","toElement","nativeEvent","className","popupElem","querySelector","elem","set","has","get","delete","render","text","children","hidden","currentMenuActived","baseCls","createElement","MenubarItem","Consumer","Object","assign"],"sources":["../../src/menubar/item.tsx"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}