{"ast":null,"code":"import util from '../util';\nconst sort = (entries, biasRight, usePrev) => {\n  const parts = util.partition(entries, entry => {\n    // NOTE: 有fixorder的也可以排\n    return entry.hasOwnProperty(\"fixorder\") && !isNaN(entry.fixorder) || entry.hasOwnProperty(\"barycenter\");\n  });\n  const sortable = parts.lhs;\n  const unsortable = parts.rhs.sort((a, b) => -a.i - -b.i);\n  const vs = [];\n  let sum = 0;\n  let weight = 0;\n  let vsIndex = 0;\n  sortable === null || sortable === void 0 ? void 0 : sortable.sort(compareWithBias(!!biasRight, !!usePrev));\n  vsIndex = consumeUnsortable(vs, unsortable, vsIndex);\n  sortable === null || sortable === void 0 ? void 0 : sortable.forEach(entry => {\n    var _a;\n    vsIndex += (_a = entry.vs) === null || _a === void 0 ? void 0 : _a.length;\n    vs.push(entry.vs);\n    sum += entry.barycenter * entry.weight;\n    weight += entry.weight;\n    vsIndex = consumeUnsortable(vs, unsortable, vsIndex);\n  });\n  const result = {\n    vs: vs.flat()\n  };\n  if (weight) {\n    result.barycenter = sum / weight;\n    result.weight = weight;\n  }\n  return result;\n};\nconst consumeUnsortable = (vs, unsortable, index) => {\n  let iindex = index;\n  let last;\n  while (unsortable.length && (last = unsortable[unsortable.length - 1]).i <= iindex) {\n    unsortable.pop();\n    vs === null || vs === void 0 ? void 0 : vs.push(last.vs);\n    iindex++;\n  }\n  return iindex;\n};\n/**\n * 配置是否考虑使用之前的布局结果\n */\nconst compareWithBias = (bias, usePrev) => {\n  return (entryV, entryW) => {\n    // 排序的时候先判断fixorder，不行再判断重心\n    if (entryV.fixorder !== undefined && entryW.fixorder !== undefined) {\n      return entryV.fixorder - entryW.fixorder;\n    }\n    if (entryV.barycenter < entryW.barycenter) {\n      return -1;\n    }\n    if (entryV.barycenter > entryW.barycenter) {\n      return 1;\n    }\n    // 重心相同，考虑之前排好的顺序\n    if (usePrev && entryV.order !== undefined && entryW.order !== undefined) {\n      if (entryV.order < entryW.order) {\n        return -1;\n      }\n      if (entryV.order > entryW.order) {\n        return 1;\n      }\n    }\n    return !bias ? entryV.i - entryW.i : entryW.i - entryV.i;\n  };\n};\nexport default sort;","map":{"version":3,"names":["util","sort","entries","biasRight","usePrev","parts","partition","entry","hasOwnProperty","isNaN","fixorder","sortable","lhs","unsortable","rhs","a","b","i","vs","sum","weight","vsIndex","compareWithBias","consumeUnsortable","forEach","_a","length","push","barycenter","result","flat","index","iindex","last","pop","bias","entryV","entryW","undefined","order"],"sources":["../../../../../src/layout/dagre/src/order/sort.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}