{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { AttributeType, BlendType, MaskOperation, StencilType, gl } from '@antv/l7-core';\nimport { fp64LowPart, rgb2arr } from '@antv/l7-utils';\nimport { BlendTypes } from \"../utils/blend\";\nimport { getStencil, getStencilMask } from \"../utils/stencil\";\nimport { COMMON_ATTRIBUTE_LOCATION, getCommonStyleAttributeOptions } from \"./CommonStyleAttribute\";\nimport { DefaultUniformStyleType, DefaultUniformStyleValue } from \"./constant\";\nimport { MultipleOfFourNumber } from \"./utils\";\n// 属性索引宏定义前缀，使用命名空间避免 define 名称重复情况\nconst DEFINE_ATTRIBUTE_LOCATION_PREFIX = 'ATTRIBUTE_LOCATION_';\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nexport default class BaseModel {\n  /**\n   * Attribute Layout Location in Shader\n   */\n  get attributeLocation() {\n    return _objectSpread({}, COMMON_ATTRIBUTE_LOCATION);\n  }\n\n  // style texture data mapping\n\n  // 不支持数据映射的buffer\n\n  // style texture data mapping\n\n  constructor(layer) {\n    _defineProperty(this, \"triangulation\", void 0);\n    _defineProperty(this, \"uniformBuffers\", []);\n    _defineProperty(this, \"textures\", []);\n    _defineProperty(this, \"createTexture2D\", void 0);\n    _defineProperty(this, \"preStyleAttribute\", {});\n    _defineProperty(this, \"encodeStyleAttribute\", {});\n    _defineProperty(this, \"layer\", void 0);\n    _defineProperty(this, \"dataTexture\", void 0);\n    // 用于数据传递的数据纹理\n    _defineProperty(this, \"DATA_TEXTURE_WIDTH\", void 0);\n    // 默认有多少列（宽度）\n    _defineProperty(this, \"dataTextureTest\", void 0);\n    _defineProperty(this, \"configService\", void 0);\n    _defineProperty(this, \"shaderModuleService\", void 0);\n    _defineProperty(this, \"rendererService\", void 0);\n    _defineProperty(this, \"iconService\", void 0);\n    _defineProperty(this, \"fontService\", void 0);\n    _defineProperty(this, \"styleAttributeService\", void 0);\n    _defineProperty(this, \"mapService\", void 0);\n    _defineProperty(this, \"cameraService\", void 0);\n    _defineProperty(this, \"layerService\", void 0);\n    _defineProperty(this, \"pickingService\", void 0);\n    _defineProperty(this, \"attributeUnifoms\", void 0);\n    // 支持数据映射的buffer\n    _defineProperty(this, \"commonUnifoms\", void 0);\n    this.layer = layer;\n    this.configService = layer.getContainer().globalConfigService;\n    this.rendererService = layer.getContainer().rendererService;\n    this.pickingService = layer.getContainer().pickingService;\n    this.shaderModuleService = layer.getContainer().shaderModuleService;\n    this.styleAttributeService = layer.getContainer().styleAttributeService;\n    this.mapService = layer.getContainer().mapService;\n    this.iconService = layer.getContainer().iconService;\n    this.fontService = layer.getContainer().fontService;\n    this.cameraService = layer.getContainer().cameraService;\n    this.layerService = layer.getContainer().layerService;\n    // 初始化支持数据映射的 Style 属性\n\n    this.registerStyleAttribute();\n    // 注册 Attribute\n    this.registerBuiltinAttributes();\n    // 开启动画\n    this.startModelAnimate();\n    const {\n      createTexture2D\n    } = this.rendererService;\n    this.createTexture2D = createTexture2D;\n  }\n\n  // style datatexture mapping\n\n  getBlend() {\n    const {\n      blend = 'normal'\n    } = this.layer.getLayerConfig();\n    return BlendTypes[BlendType[blend]];\n  }\n  getStencil(option) {\n    const {\n      mask = false,\n      maskInside = true,\n      enableMask,\n      maskOperation = MaskOperation.AND\n    } = this.layer.getLayerConfig();\n    // TODO 临时处理，后期移除MaskLayer\n    if (this.layer.type === 'MaskLayer') {\n      return getStencilMask({\n        isStencil: true,\n        stencilType: StencilType.SINGLE\n      }); // 用于遮罩的stencil 参数\n    }\n    if (option.isStencil) {\n      return getStencilMask(_objectSpread(_objectSpread({}, option), {}, {\n        maskOperation\n      })); // 用于遮罩的stencil 参数\n    }\n    const maskflag = mask ||\n    //  mask 兼容历史写法\n    enableMask && this.layer.masks.length !== 0 ||\n    // 外部图层的mask\n    this.layer.tileMask !== undefined; // 瓦片图层\n    // !!(mask || enableMask || this.layer.tileMask);\n    return getStencil(maskflag, maskInside);\n  }\n  getDefaultStyle() {\n    return {};\n  }\n  // public getUninforms(): IModelUniform {\n  //   throw new Error('Method not implemented.');\n  // }\n  getUninforms() {\n    const commoninfo = this.getCommonUniformsInfo();\n    const attributeInfo = this.getUniformsBufferInfo(this.getStyleAttribute());\n    this.updateStyleUnifoms();\n    const result = _objectSpread(_objectSpread({}, attributeInfo.uniformsOption), commoninfo.uniformsOption);\n    // 兼容 Regl Boolean 类型\n    Object.keys(result).forEach(key => {\n      if (typeof result[key] === 'boolean') {\n        result[key] = result[key] ? 1 : 0;\n      }\n    });\n    //如果是regl渲染 需要在uniform中带上u_texture 暂时用this.rendererService.device判断\n    if (!this.rendererService.hasOwnProperty('device') && this.textures && this.textures.length === 1) {\n      result['u_texture'] = this.textures[0];\n    }\n    return result;\n  }\n  getAnimateUniforms() {\n    return {};\n  }\n  needUpdate() {\n    return _asyncToGenerator(function* () {\n      return false;\n    })();\n  }\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  buildModels() {\n    return _asyncToGenerator(function* () {\n      throw new Error('Method not implemented.');\n    })();\n  }\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  initModels() {\n    return _asyncToGenerator(function* () {\n      throw new Error('Method not implemented.');\n    })();\n  }\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  clearModels(refresh = true) {\n    return;\n  }\n  getAttribute() {\n    throw new Error('Method not implemented.');\n  }\n  prerender() {}\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  render(renderOptions) {\n    throw new Error('Method not implemented.');\n  }\n  registerBuiltinAttributes() {\n    throw new Error('Method not implemented.');\n  }\n  animateOption2Array(option) {\n    return [option.enable ? 0 : 1.0, option.duration || 4.0, option.interval || 0.2, option.trailLength || 0.1];\n  }\n  startModelAnimate() {\n    const {\n      animateOption\n    } = this.layer.getLayerConfig();\n    if (animateOption.enable) {\n      this.layer.setAnimateStartTime();\n    }\n  }\n  getInject() {\n    const shaderInject = getDynamicStyleInject(this.layer.enableShaderEncodeStyles, this.layer.encodeStyleAttribute);\n    return shaderInject;\n  }\n  getDefines() {\n    // define atribute Layout Location\n    const atributeLocationDefines = Object.keys(this.attributeLocation).reduce((result, key) => {\n      const normalizedKey = DEFINE_ATTRIBUTE_LOCATION_PREFIX + key;\n      result[normalizedKey] = this.attributeLocation[key];\n      return result;\n    }, {});\n    return _objectSpread({}, atributeLocationDefines);\n  }\n\n  // 获取数据映射样式\n  getStyleAttribute() {\n    const options = {};\n    // TODO: 优化\n    this.layer.enableShaderEncodeStyles.forEach(key => {\n      if (!this.layer.encodeStyleAttribute[key]) {\n        // 没有设置样式映射\n        // @ts-ignore\n        const keyValue = this.layer.getLayerConfig()[key];\n        let value = typeof keyValue === 'undefined' ? DefaultUniformStyleValue[key] : keyValue;\n        if (key === 'stroke') {\n          value = rgb2arr(value);\n        }\n        options['u_' + key] = value;\n      }\n    });\n    return options;\n  }\n\n  // 注册数据映射样式\n  registerStyleAttribute() {\n    Object.keys(this.layer.encodeStyleAttribute).forEach(key => {\n      const options = getCommonStyleAttributeOptions(key);\n      if (options) {\n        this.styleAttributeService.registerStyleAttribute(options);\n      }\n    });\n  }\n\n  /**\n   * 注册 Position 属性 64 位地位部分，当经纬度数据开启双精度浮点数使用，\n   * 避免大于 20层级以上出现数据偏移\n   */\n  registerPosition64LowAttribute(enable64bitPosition = true) {\n    // save low part for enabled double precision POSITION attribute\n    this.styleAttributeService.registerStyleAttribute({\n      name: 'position64Low',\n      type: AttributeType.Attribute,\n      descriptor: {\n        name: 'a_Position64Low',\n        shaderLocation: this.attributeLocation.POSITION_64LOW,\n        buffer: {\n          data: [],\n          type: gl.FLOAT\n        },\n        size: 2,\n        update: (feature, featureIdx, vertex) => {\n          return enable64bitPosition ? [fp64LowPart(vertex[0]), fp64LowPart(vertex[1])] : [0, 0];\n        }\n      }\n    });\n  }\n  updateEncodeAttribute(type, flag) {\n    this.encodeStyleAttribute[type] = flag;\n  }\n  initUniformsBuffer() {\n    const attrUniforms = this.getUniformsBufferInfo(this.getStyleAttribute());\n    const commonUniforms = this.getCommonUniformsInfo();\n    if (attrUniforms.uniformsLength !== 0) {\n      this.attributeUnifoms = this.rendererService.createBuffer({\n        data: new Float32Array(MultipleOfFourNumber(attrUniforms.uniformsLength)).fill(0),\n        // 长度需要大于等于 4\n        isUBO: true,\n        label: 'layerModelAttributeUnifoms'\n      });\n      this.uniformBuffers.push(this.attributeUnifoms);\n    }\n    if (commonUniforms.uniformsLength !== 0) {\n      this.commonUnifoms = this.rendererService.createBuffer({\n        data: new Float32Array(MultipleOfFourNumber(commonUniforms.uniformsLength)).fill(0),\n        isUBO: true,\n        label: 'layerModelCommonUnifoms'\n      });\n      this.uniformBuffers.push(this.commonUnifoms);\n    }\n  }\n  // 获取数据映射 uniform 信息\n  getUniformsBufferInfo(uniformsOption) {\n    let uniformsLength = 0;\n    const uniformsArray = [];\n    Object.values(uniformsOption).forEach(value => {\n      if (Array.isArray(value)) {\n        uniformsArray.push(...value);\n        uniformsLength += value.length;\n      } else if (typeof value === 'number') {\n        // 排除纹理\n        uniformsArray.push(value);\n        uniformsLength += 1;\n      } else if (typeof value === 'boolean') {\n        uniformsArray.push(Number(value));\n        uniformsLength += 1;\n      }\n    });\n    return {\n      uniformsOption,\n      uniformsLength,\n      uniformsArray\n    };\n  }\n  getCommonUniformsInfo() {\n    return {\n      uniformsLength: 0,\n      uniformsArray: [],\n      uniformsOption: {}\n    };\n  }\n\n  // 更新支持数据映射的uniform\n  updateStyleUnifoms() {\n    var _this$attributeUnifom, _this$commonUnifoms;\n    const {\n      uniformsArray\n    } = this.getUniformsBufferInfo(this.getStyleAttribute());\n    const {\n      uniformsArray: commonUniformsArray\n    } = this.getCommonUniformsInfo();\n    (_this$attributeUnifom = this.attributeUnifoms) === null || _this$attributeUnifom === void 0 || _this$attributeUnifom.subData({\n      offset: 0,\n      data: new Uint8Array(new Float32Array(uniformsArray).buffer)\n    });\n    (_this$commonUnifoms = this.commonUnifoms) === null || _this$commonUnifoms === void 0 || _this$commonUnifoms.subData({\n      offset: 0,\n      data: new Uint8Array(new Float32Array(commonUniformsArray).buffer)\n    });\n  }\n}\n\n/**\n * 获取动态注入参与数据映射 uniform/attribute\n */\nfunction getDynamicStyleInject(shaderEncodeStyles, styleAttribute) {\n  const uniforms = [];\n  let vsDeclInjection = '';\n\n  // 支持数据映射的类型\n  shaderEncodeStyles.forEach(key => {\n    const upperCaseKey = key.replace(/([a-z])([A-Z])/g, '$1_$2').toUpperCase();\n    const shaderDefineName = DEFINE_ATTRIBUTE_LOCATION_PREFIX + upperCaseKey;\n    if (styleAttribute[key]) {\n      // 配置了数据映射的类型\n      vsDeclInjection += `#define USE_ATTRIBUTE_${upperCaseKey} 0.0 \\n`;\n    } else {\n      uniforms.push(`  ${DefaultUniformStyleType[key]} u_${key};`);\n    }\n    vsDeclInjection += `\n#ifdef USE_ATTRIBUTE_${upperCaseKey}\nlayout(location = ${shaderDefineName}) in ${DefaultUniformStyleType[key]} a_${key.charAt(0).toUpperCase() + key.slice(1)};\n#endif \\n`;\n  });\n  const fsDeclInjection = uniforms.length ? `\nlayout(std140) uniform AttributeUniforms {\n  ${uniforms.join('\\n')}\n};\\n` : '';\n  vsDeclInjection += fsDeclInjection;\n  let vsMainInjection = '';\n  shaderEncodeStyles.forEach(key => {\n    const upperCaseKey = key.replace(/([a-z])([A-Z])/g, '$1_$2').toUpperCase();\n    vsMainInjection += `\n  #ifdef USE_ATTRIBUTE_${upperCaseKey}\n    ${DefaultUniformStyleType[key]} ${key} = a_${key.charAt(0).toUpperCase() + key.slice(1)};\n  #else\n    ${DefaultUniformStyleType[key]} ${key} = u_${key};\n  #endif\n  `;\n  });\n  return {\n    'vs:#decl': vsDeclInjection,\n    'fs:#decl': fsDeclInjection,\n    'vs:#main-start': vsMainInjection\n  };\n}","map":{"version":3,"names":["_asyncToGenerator","_objectSpread","_defineProperty","AttributeType","BlendType","MaskOperation","StencilType","gl","fp64LowPart","rgb2arr","BlendTypes","getStencil","getStencilMask","COMMON_ATTRIBUTE_LOCATION","getCommonStyleAttributeOptions","DefaultUniformStyleType","DefaultUniformStyleValue","MultipleOfFourNumber","DEFINE_ATTRIBUTE_LOCATION_PREFIX","BaseModel","attributeLocation","constructor","layer","configService","getContainer","globalConfigService","rendererService","pickingService","shaderModuleService","styleAttributeService","mapService","iconService","fontService","cameraService","layerService","registerStyleAttribute","registerBuiltinAttributes","startModelAnimate","createTexture2D","getBlend","blend","getLayerConfig","option","mask","maskInside","enableMask","maskOperation","AND","type","isStencil","stencilType","SINGLE","maskflag","masks","length","tileMask","undefined","getDefaultStyle","getUninforms","commoninfo","getCommonUniformsInfo","attributeInfo","getUniformsBufferInfo","getStyleAttribute","updateStyleUnifoms","result","uniformsOption","Object","keys","forEach","key","hasOwnProperty","textures","getAnimateUniforms","needUpdate","buildModels","Error","initModels","clearModels","refresh","getAttribute","prerender","render","renderOptions","animateOption2Array","enable","duration","interval","trailLength","animateOption","setAnimateStartTime","getInject","shaderInject","getDynamicStyleInject","enableShaderEncodeStyles","encodeStyleAttribute","getDefines","atributeLocationDefines","reduce","normalizedKey","options","keyValue","value","registerPosition64LowAttribute","enable64bitPosition","name","Attribute","descriptor","shaderLocation","POSITION_64LOW","buffer","data","FLOAT","size","update","feature","featureIdx","vertex","updateEncodeAttribute","flag","initUniformsBuffer","attrUniforms","commonUniforms","uniformsLength","attributeUnifoms","createBuffer","Float32Array","fill","isUBO","label","uniformBuffers","push","commonUnifoms","uniformsArray","values","Array","isArray","Number","_this$attributeUnifom","_this$commonUnifoms","commonUniformsArray","subData","offset","Uint8Array","shaderEncodeStyles","styleAttribute","uniforms","vsDeclInjection","upperCaseKey","replace","toUpperCase","shaderDefineName","charAt","slice","fsDeclInjection","join","vsMainInjection"],"sources":["/Users/bhanudahiya/Desktop/ledger-IQ/node_modules/@antv/l7-layers/es/core/BaseModel.js"],"sourcesContent":["import _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { AttributeType, BlendType, MaskOperation, StencilType, gl } from '@antv/l7-core';\nimport { fp64LowPart, rgb2arr } from '@antv/l7-utils';\nimport { BlendTypes } from \"../utils/blend\";\nimport { getStencil, getStencilMask } from \"../utils/stencil\";\nimport { COMMON_ATTRIBUTE_LOCATION, getCommonStyleAttributeOptions } from \"./CommonStyleAttribute\";\nimport { DefaultUniformStyleType, DefaultUniformStyleValue } from \"./constant\";\nimport { MultipleOfFourNumber } from \"./utils\";\n// 属性索引宏定义前缀，使用命名空间避免 define 名称重复情况\nconst DEFINE_ATTRIBUTE_LOCATION_PREFIX = 'ATTRIBUTE_LOCATION_';\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nexport default class BaseModel {\n  /**\n   * Attribute Layout Location in Shader\n   */\n  get attributeLocation() {\n    return _objectSpread({}, COMMON_ATTRIBUTE_LOCATION);\n  }\n\n  // style texture data mapping\n\n  // 不支持数据映射的buffer\n\n  // style texture data mapping\n\n  constructor(layer) {\n    _defineProperty(this, \"triangulation\", void 0);\n    _defineProperty(this, \"uniformBuffers\", []);\n    _defineProperty(this, \"textures\", []);\n    _defineProperty(this, \"createTexture2D\", void 0);\n    _defineProperty(this, \"preStyleAttribute\", {});\n    _defineProperty(this, \"encodeStyleAttribute\", {});\n    _defineProperty(this, \"layer\", void 0);\n    _defineProperty(this, \"dataTexture\", void 0);\n    // 用于数据传递的数据纹理\n    _defineProperty(this, \"DATA_TEXTURE_WIDTH\", void 0);\n    // 默认有多少列（宽度）\n    _defineProperty(this, \"dataTextureTest\", void 0);\n    _defineProperty(this, \"configService\", void 0);\n    _defineProperty(this, \"shaderModuleService\", void 0);\n    _defineProperty(this, \"rendererService\", void 0);\n    _defineProperty(this, \"iconService\", void 0);\n    _defineProperty(this, \"fontService\", void 0);\n    _defineProperty(this, \"styleAttributeService\", void 0);\n    _defineProperty(this, \"mapService\", void 0);\n    _defineProperty(this, \"cameraService\", void 0);\n    _defineProperty(this, \"layerService\", void 0);\n    _defineProperty(this, \"pickingService\", void 0);\n    _defineProperty(this, \"attributeUnifoms\", void 0);\n    // 支持数据映射的buffer\n    _defineProperty(this, \"commonUnifoms\", void 0);\n    this.layer = layer;\n    this.configService = layer.getContainer().globalConfigService;\n    this.rendererService = layer.getContainer().rendererService;\n    this.pickingService = layer.getContainer().pickingService;\n    this.shaderModuleService = layer.getContainer().shaderModuleService;\n    this.styleAttributeService = layer.getContainer().styleAttributeService;\n    this.mapService = layer.getContainer().mapService;\n    this.iconService = layer.getContainer().iconService;\n    this.fontService = layer.getContainer().fontService;\n    this.cameraService = layer.getContainer().cameraService;\n    this.layerService = layer.getContainer().layerService;\n    // 初始化支持数据映射的 Style 属性\n\n    this.registerStyleAttribute();\n    // 注册 Attribute\n    this.registerBuiltinAttributes();\n    // 开启动画\n    this.startModelAnimate();\n    const {\n      createTexture2D\n    } = this.rendererService;\n    this.createTexture2D = createTexture2D;\n  }\n\n  // style datatexture mapping\n\n  getBlend() {\n    const {\n      blend = 'normal'\n    } = this.layer.getLayerConfig();\n    return BlendTypes[BlendType[blend]];\n  }\n  getStencil(option) {\n    const {\n      mask = false,\n      maskInside = true,\n      enableMask,\n      maskOperation = MaskOperation.AND\n    } = this.layer.getLayerConfig();\n    // TODO 临时处理，后期移除MaskLayer\n    if (this.layer.type === 'MaskLayer') {\n      return getStencilMask({\n        isStencil: true,\n        stencilType: StencilType.SINGLE\n      }); // 用于遮罩的stencil 参数\n    }\n    if (option.isStencil) {\n      return getStencilMask(_objectSpread(_objectSpread({}, option), {}, {\n        maskOperation\n      })); // 用于遮罩的stencil 参数\n    }\n    const maskflag = mask ||\n    //  mask 兼容历史写法\n    enableMask && this.layer.masks.length !== 0 ||\n    // 外部图层的mask\n    this.layer.tileMask !== undefined; // 瓦片图层\n    // !!(mask || enableMask || this.layer.tileMask);\n    return getStencil(maskflag, maskInside);\n  }\n  getDefaultStyle() {\n    return {};\n  }\n  // public getUninforms(): IModelUniform {\n  //   throw new Error('Method not implemented.');\n  // }\n  getUninforms() {\n    const commoninfo = this.getCommonUniformsInfo();\n    const attributeInfo = this.getUniformsBufferInfo(this.getStyleAttribute());\n    this.updateStyleUnifoms();\n    const result = _objectSpread(_objectSpread({}, attributeInfo.uniformsOption), commoninfo.uniformsOption);\n    // 兼容 Regl Boolean 类型\n    Object.keys(result).forEach(key => {\n      if (typeof result[key] === 'boolean') {\n        result[key] = result[key] ? 1 : 0;\n      }\n    });\n    //如果是regl渲染 需要在uniform中带上u_texture 暂时用this.rendererService.device判断\n    if (!this.rendererService.hasOwnProperty('device') && this.textures && this.textures.length === 1) {\n      result['u_texture'] = this.textures[0];\n    }\n    return result;\n  }\n  getAnimateUniforms() {\n    return {};\n  }\n  needUpdate() {\n    return _asyncToGenerator(function* () {\n      return false;\n    })();\n  }\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  buildModels() {\n    return _asyncToGenerator(function* () {\n      throw new Error('Method not implemented.');\n    })();\n  }\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  initModels() {\n    return _asyncToGenerator(function* () {\n      throw new Error('Method not implemented.');\n    })();\n  }\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  clearModels(refresh = true) {\n    return;\n  }\n  getAttribute() {\n    throw new Error('Method not implemented.');\n  }\n  prerender() {}\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  render(renderOptions) {\n    throw new Error('Method not implemented.');\n  }\n  registerBuiltinAttributes() {\n    throw new Error('Method not implemented.');\n  }\n  animateOption2Array(option) {\n    return [option.enable ? 0 : 1.0, option.duration || 4.0, option.interval || 0.2, option.trailLength || 0.1];\n  }\n  startModelAnimate() {\n    const {\n      animateOption\n    } = this.layer.getLayerConfig();\n    if (animateOption.enable) {\n      this.layer.setAnimateStartTime();\n    }\n  }\n  getInject() {\n    const shaderInject = getDynamicStyleInject(this.layer.enableShaderEncodeStyles, this.layer.encodeStyleAttribute);\n    return shaderInject;\n  }\n  getDefines() {\n    // define atribute Layout Location\n    const atributeLocationDefines = Object.keys(this.attributeLocation).reduce((result, key) => {\n      const normalizedKey = DEFINE_ATTRIBUTE_LOCATION_PREFIX + key;\n      result[normalizedKey] = this.attributeLocation[key];\n      return result;\n    }, {});\n    return _objectSpread({}, atributeLocationDefines);\n  }\n\n  // 获取数据映射样式\n  getStyleAttribute() {\n    const options = {};\n    // TODO: 优化\n    this.layer.enableShaderEncodeStyles.forEach(key => {\n      if (!this.layer.encodeStyleAttribute[key]) {\n        // 没有设置样式映射\n        // @ts-ignore\n        const keyValue = this.layer.getLayerConfig()[key];\n        let value = typeof keyValue === 'undefined' ? DefaultUniformStyleValue[key] : keyValue;\n        if (key === 'stroke') {\n          value = rgb2arr(value);\n        }\n        options['u_' + key] = value;\n      }\n    });\n    return options;\n  }\n\n  // 注册数据映射样式\n  registerStyleAttribute() {\n    Object.keys(this.layer.encodeStyleAttribute).forEach(key => {\n      const options = getCommonStyleAttributeOptions(key);\n      if (options) {\n        this.styleAttributeService.registerStyleAttribute(options);\n      }\n    });\n  }\n\n  /**\n   * 注册 Position 属性 64 位地位部分，当经纬度数据开启双精度浮点数使用，\n   * 避免大于 20层级以上出现数据偏移\n   */\n  registerPosition64LowAttribute(enable64bitPosition = true) {\n    // save low part for enabled double precision POSITION attribute\n    this.styleAttributeService.registerStyleAttribute({\n      name: 'position64Low',\n      type: AttributeType.Attribute,\n      descriptor: {\n        name: 'a_Position64Low',\n        shaderLocation: this.attributeLocation.POSITION_64LOW,\n        buffer: {\n          data: [],\n          type: gl.FLOAT\n        },\n        size: 2,\n        update: (feature, featureIdx, vertex) => {\n          return enable64bitPosition ? [fp64LowPart(vertex[0]), fp64LowPart(vertex[1])] : [0, 0];\n        }\n      }\n    });\n  }\n  updateEncodeAttribute(type, flag) {\n    this.encodeStyleAttribute[type] = flag;\n  }\n  initUniformsBuffer() {\n    const attrUniforms = this.getUniformsBufferInfo(this.getStyleAttribute());\n    const commonUniforms = this.getCommonUniformsInfo();\n    if (attrUniforms.uniformsLength !== 0) {\n      this.attributeUnifoms = this.rendererService.createBuffer({\n        data: new Float32Array(MultipleOfFourNumber(attrUniforms.uniformsLength)).fill(0),\n        // 长度需要大于等于 4\n        isUBO: true,\n        label: 'layerModelAttributeUnifoms'\n      });\n      this.uniformBuffers.push(this.attributeUnifoms);\n    }\n    if (commonUniforms.uniformsLength !== 0) {\n      this.commonUnifoms = this.rendererService.createBuffer({\n        data: new Float32Array(MultipleOfFourNumber(commonUniforms.uniformsLength)).fill(0),\n        isUBO: true,\n        label: 'layerModelCommonUnifoms'\n      });\n      this.uniformBuffers.push(this.commonUnifoms);\n    }\n  }\n  // 获取数据映射 uniform 信息\n  getUniformsBufferInfo(uniformsOption) {\n    let uniformsLength = 0;\n    const uniformsArray = [];\n    Object.values(uniformsOption).forEach(value => {\n      if (Array.isArray(value)) {\n        uniformsArray.push(...value);\n        uniformsLength += value.length;\n      } else if (typeof value === 'number') {\n        // 排除纹理\n        uniformsArray.push(value);\n        uniformsLength += 1;\n      } else if (typeof value === 'boolean') {\n        uniformsArray.push(Number(value));\n        uniformsLength += 1;\n      }\n    });\n    return {\n      uniformsOption,\n      uniformsLength,\n      uniformsArray\n    };\n  }\n  getCommonUniformsInfo() {\n    return {\n      uniformsLength: 0,\n      uniformsArray: [],\n      uniformsOption: {}\n    };\n  }\n\n  // 更新支持数据映射的uniform\n  updateStyleUnifoms() {\n    var _this$attributeUnifom, _this$commonUnifoms;\n    const {\n      uniformsArray\n    } = this.getUniformsBufferInfo(this.getStyleAttribute());\n    const {\n      uniformsArray: commonUniformsArray\n    } = this.getCommonUniformsInfo();\n    (_this$attributeUnifom = this.attributeUnifoms) === null || _this$attributeUnifom === void 0 || _this$attributeUnifom.subData({\n      offset: 0,\n      data: new Uint8Array(new Float32Array(uniformsArray).buffer)\n    });\n    (_this$commonUnifoms = this.commonUnifoms) === null || _this$commonUnifoms === void 0 || _this$commonUnifoms.subData({\n      offset: 0,\n      data: new Uint8Array(new Float32Array(commonUniformsArray).buffer)\n    });\n  }\n}\n\n/**\n * 获取动态注入参与数据映射 uniform/attribute\n */\nfunction getDynamicStyleInject(shaderEncodeStyles, styleAttribute) {\n  const uniforms = [];\n  let vsDeclInjection = '';\n\n  // 支持数据映射的类型\n  shaderEncodeStyles.forEach(key => {\n    const upperCaseKey = key.replace(/([a-z])([A-Z])/g, '$1_$2').toUpperCase();\n    const shaderDefineName = DEFINE_ATTRIBUTE_LOCATION_PREFIX + upperCaseKey;\n    if (styleAttribute[key]) {\n      // 配置了数据映射的类型\n      vsDeclInjection += `#define USE_ATTRIBUTE_${upperCaseKey} 0.0 \\n`;\n    } else {\n      uniforms.push(`  ${DefaultUniformStyleType[key]} u_${key};`);\n    }\n    vsDeclInjection += `\n#ifdef USE_ATTRIBUTE_${upperCaseKey}\nlayout(location = ${shaderDefineName}) in ${DefaultUniformStyleType[key]} a_${key.charAt(0).toUpperCase() + key.slice(1)};\n#endif \\n`;\n  });\n  const fsDeclInjection = uniforms.length ? `\nlayout(std140) uniform AttributeUniforms {\n  ${uniforms.join('\\n')}\n};\\n` : '';\n  vsDeclInjection += fsDeclInjection;\n  let vsMainInjection = '';\n  shaderEncodeStyles.forEach(key => {\n    const upperCaseKey = key.replace(/([a-z])([A-Z])/g, '$1_$2').toUpperCase();\n    vsMainInjection += `\n  #ifdef USE_ATTRIBUTE_${upperCaseKey}\n    ${DefaultUniformStyleType[key]} ${key} = a_${key.charAt(0).toUpperCase() + key.slice(1)};\n  #else\n    ${DefaultUniformStyleType[key]} ${key} = u_${key};\n  #endif\n  `;\n  });\n  return {\n    'vs:#decl': vsDeclInjection,\n    'fs:#decl': fsDeclInjection,\n    'vs:#main-start': vsMainInjection\n  };\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}