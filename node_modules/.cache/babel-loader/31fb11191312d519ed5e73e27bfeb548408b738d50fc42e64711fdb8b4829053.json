{"ast":null,"code":"import { __awaiter, __decorate, __metadata } from \"tslib\";\nimport { inject, injectable } from 'mana-syringe';\nimport { ICommandHandler, ICommandContextProvider } from '../../command/interface';\nimport { XFlowGraphCommands } from '../constant';\nimport { Disposable } from '../../common/disposable';\nexport var NsGraphAddTool;\n(function (NsGraphAddTool) {\n  /** Command: 用于注册named factory */\n  NsGraphAddTool.command = XFlowGraphCommands.GRAPH_ADD_TOOL;\n  /** hookName */\n  NsGraphAddTool.hookKey = 'addTool';\n})(NsGraphAddTool || (NsGraphAddTool = {}));\nlet GraphAddToolCommand = class GraphAddToolCommand {\n  constructor() {\n    /** 执行Cmd */\n    this.execute = () => __awaiter(this, void 0, void 0, function* () {\n      const ctx = this.contextProvider();\n      const {\n        args,\n        hooks: runtimeHook\n      } = ctx.getArgs();\n      const hooks = ctx.getHooks();\n      const result = yield hooks.addTool.call(args, handlerArgs => __awaiter(this, void 0, void 0, function* () {\n        const {\n          cellId,\n          toolConfig,\n          commandService\n        } = handlerArgs;\n        const graph = yield ctx.getX6Graph();\n        const cell = graph.getCellById(cellId);\n        if (cell) {\n          cell.addTools(toolConfig.items, toolConfig.options);\n          ctx.addUndo(Disposable.create(() => __awaiter(this, void 0, void 0, function* () {\n            if (Array.isArray(toolConfig.items)) {\n              toolConfig.items.forEach(item => {\n                commandService.executeCommand(XFlowGraphCommands.GRAPH_DEL_TOOL.id, {\n                  cellId,\n                  toolname: item\n                });\n              });\n            }\n          })));\n        }\n        return {\n          err: null\n        };\n      }), runtimeHook);\n      ctx.setResult(result);\n      return this;\n    });\n    /** undo cmd */\n    this.undo = () => __awaiter(this, void 0, void 0, function* () {\n      const ctx = this.contextProvider();\n      if (this.isUndoable()) {\n        ctx.undo();\n      }\n      return this;\n    });\n    /** redo cmd */\n    this.redo = () => __awaiter(this, void 0, void 0, function* () {\n      if (!this.isUndoable()) {\n        yield this.execute();\n      }\n      return this;\n    });\n  }\n  isUndoable() {\n    const ctx = this.contextProvider();\n    return ctx.isUndoable();\n  }\n};\n__decorate([inject(ICommandContextProvider), __metadata(\"design:type\", Object)], GraphAddToolCommand.prototype, \"contextProvider\", void 0);\nGraphAddToolCommand = __decorate([injectable({\n  token: {\n    token: ICommandHandler,\n    named: NsGraphAddTool.command.id\n  }\n})\n/** 创建节点命令 */], GraphAddToolCommand);\nexport { GraphAddToolCommand };","map":{"version":3,"names":["inject","injectable","ICommandHandler","ICommandContextProvider","XFlowGraphCommands","Disposable","NsGraphAddTool","command","GRAPH_ADD_TOOL","hookKey","GraphAddToolCommand","constructor","execute","__awaiter","ctx","contextProvider","args","hooks","runtimeHook","getArgs","getHooks","result","addTool","call","handlerArgs","cellId","toolConfig","commandService","graph","getX6Graph","cell","getCellById","addTools","items","options","addUndo","create","Array","isArray","forEach","item","executeCommand","GRAPH_DEL_TOOL","id","toolname","err","setResult","undo","isUndoable","redo","__decorate","token","named"],"sources":["../../../src/command-contributions/graph/graph-add-tool.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}