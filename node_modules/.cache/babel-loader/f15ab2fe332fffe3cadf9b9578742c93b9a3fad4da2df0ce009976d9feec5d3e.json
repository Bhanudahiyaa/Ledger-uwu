{"ast":null,"code":"import { __decorate, __metadata } from \"tslib\";\nimport { singleton, contrib, Contribution } from 'mana-syringe';\nimport { DisposableCollection, Disposable } from '../common/disposable';\nimport { IFrontendApplicationContribution } from '../xflow-main/interface';\nimport { IMenuService, IMenuContribution } from './interface';\nlet MenuRegistry = class MenuRegistry {\n  constructor() {\n    /** disposables */\n    this.toDispose = new DisposableCollection();\n    /** menuMap */\n    this.menuMap = new Map();\n    /**\n     * 获取 menu\n     * @param menuId menuId\n     */\n    this.getMenu = menuId => {\n      return this.menuMap.get(menuId);\n    };\n    /**\n     * 注册一批可单独dispose的扩展项目\n     * @param externalRegisterFn IRegisterMenuFunction\n     */\n    this.registerDisposableMenu = externalRegisterFn => {\n      const toDispose = new DisposableCollection();\n      const disposableRegistry = {\n        registerMenu: config => {\n          const disposable = this.registerMenu(config);\n          toDispose.push(disposable);\n          return disposable;\n        }\n      };\n      externalRegisterFn(disposableRegistry);\n      this.toDispose.push(toDispose);\n      return toDispose;\n    };\n  }\n  /** app启动时，收集menu扩展点的注册项 */\n  onStart() {\n    const contributions = this.contributionProvider.getContributions();\n    for (const contribution of contributions) {\n      contribution.registerMenu(this);\n    }\n  }\n  /** app的停止逻辑 */\n  onStop() {\n    this.toDispose.dispose();\n  }\n  /**\n   * 注册 menu 类型\n   * @param config IMenu\n   */\n  registerMenu(config) {\n    this.menuMap.set(config.id, config);\n    return Disposable.create(() => this.menuMap.delete(config.id));\n  }\n};\n__decorate([contrib(IMenuContribution), __metadata(\"design:type\", Object)], MenuRegistry.prototype, \"contributionProvider\", void 0);\nMenuRegistry = __decorate([singleton({\n  contrib: [IFrontendApplicationContribution, IMenuService]\n})], MenuRegistry);\nexport { MenuRegistry };","map":{"version":3,"names":["singleton","contrib","Contribution","DisposableCollection","Disposable","IFrontendApplicationContribution","IMenuService","IMenuContribution","MenuRegistry","constructor","toDispose","menuMap","Map","getMenu","menuId","get","registerDisposableMenu","externalRegisterFn","disposableRegistry","registerMenu","config","disposable","push","onStart","contributions","contributionProvider","getContributions","contribution","onStop","dispose","set","id","create","delete","__decorate"],"sources":["../../src/menu/menu-registry.ts"],"sourcesContent":[null],"mappings":";AAAA,SAASA,SAAS,EAAEC,OAAO,EAAEC,YAAY,QAAQ,cAAc;AAC/D,SAASC,oBAAoB,EAAEC,UAAU,QAAQ,sBAAsB;AACvE,SAASC,gCAAgC,QAAQ,yBAAyB;AAG1E,SAASC,YAAY,EAAEC,iBAAiB,QAAQ,aAAa;AAGtD,IAAMC,YAAY,GAAlB,MAAMA,YAAY;EAAlBC,YAAA;IACL;IACQ,KAAAC,SAAS,GAAG,IAAIP,oBAAoB,EAAE;IAC9C;IACQ,KAAAQ,OAAO,GAAG,IAAIC,GAAG,EAAyB;IAuBlD;;;;IAIA,KAAAC,OAAO,GAAIC,MAAe,IAAI;MAC5B,OAAO,IAAI,CAACH,OAAO,CAACI,GAAG,CAACD,MAAM,CAAC;IACjC,CAAC;IACD;;;;IAIA,KAAAE,sBAAsB,GAAIC,kBAAyC,IAAI;MACrE,MAAMP,SAAS,GAAG,IAAIP,oBAAoB,EAAE;MAC5C,MAAMe,kBAAkB,GAAG;QACzBC,YAAY,EAAGC,MAAoB,IAAI;UACrC,MAAMC,UAAU,GAAG,IAAI,CAACF,YAAY,CAACC,MAAM,CAAC;UAC5CV,SAAS,CAACY,IAAI,CAACD,UAAU,CAAC;UAC1B,OAAOA,UAAU;QACnB;OACD;MACDJ,kBAAkB,CAACC,kBAAkB,CAAC;MACtC,IAAI,CAACR,SAAS,CAACY,IAAI,CAACZ,SAAS,CAAC;MAC9B,OAAOA,SAAS;IAClB,CAAC;EACH;EA3CE;EACAa,OAAOA,CAAA;IACL,MAAMC,aAAa,GAAG,IAAI,CAACC,oBAAoB,CAACC,gBAAgB,EAAE;IAClE,KAAK,MAAMC,YAAY,IAAIH,aAAa,EAAE;MACxCG,YAAY,CAACR,YAAY,CAAC,IAAI,CAAC;;EAEnC;EACA;EACAS,MAAMA,CAAA;IACJ,IAAI,CAAClB,SAAS,CAACmB,OAAO,EAAE;EAC1B;EACA;;;;EAIAV,YAAYA,CAACC,MAAoB;IAC/B,IAAI,CAACT,OAAO,CAACmB,GAAG,CAACV,MAAM,CAACW,EAAE,EAAEX,MAAM,CAAC;IACnC,OAAOhB,UAAU,CAAC4B,MAAM,CAAC,MAAM,IAAI,CAACrB,OAAO,CAACsB,MAAM,CAACb,MAAM,CAACW,EAAE,CAAC,CAAC;EAChE;CAyBD;AA7CCG,UAAA,EAACjC,OAAO,CAACM,iBAAiB,CAAC,E,2FACsD;AAPtEC,YAAY,GAAA0B,UAAA,EADxBlC,SAAS,CAAC;EAAEC,OAAO,EAAE,CAACI,gCAAgC,EAAEC,YAAY;AAAC,CAAE,CAAC,C,EAC5DE,YAAY,CAmDxB;SAnDYA,YAAY","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}