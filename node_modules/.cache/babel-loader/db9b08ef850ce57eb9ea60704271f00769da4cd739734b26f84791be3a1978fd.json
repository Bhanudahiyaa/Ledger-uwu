{"ast":null,"code":"import { __awaiter, __decorate, __metadata } from \"tslib\";\nimport { inject, injectable, postConstruct } from 'mana-syringe';\nimport * as AntvLayout from '@antv/layout';\nimport { ICommandHandler, ICommandContextProvider } from '../../command/interface';\nimport { XFlowGraphCommands } from '../constant';\n/** 画布图数据执行布局算法命令 */\nexport var NsGraphLayout;\n(function (NsGraphLayout) {\n  /** Command: 用于注册named factory */\n  NsGraphLayout.command = XFlowGraphCommands.GRAPH_LAYOUT;\n  /** hookName */\n  NsGraphLayout.hookKey = 'graphLayout';\n})(NsGraphLayout || (NsGraphLayout = {}));\nlet GraphLayoutCommand = class GraphLayoutCommand {\n  constructor() {\n    /** 执行cmd */\n    this.execute = () => __awaiter(this, void 0, void 0, function* () {\n      const {\n        args,\n        hooks: runtimeHook\n      } = this.ctx.getArgs();\n      const hooks = this.ctx.getHooks();\n      const result = yield hooks.graphLayout.call(args, handlerArgs => __awaiter(this, void 0, void 0, function* () {\n        const {\n          layoutType,\n          layoutOptions,\n          customLayout\n        } = handlerArgs;\n        /** XFlow内置AntV通用布局 */\n        const innerLayout = graphData => {\n          const clz = AntvLayout.Layouts[layoutType];\n          const antVLayout = new clz(Object.assign({}, layoutOptions));\n          return antVLayout.layout(graphData);\n        };\n        const layoutFunc = customLayout || innerLayout;\n        yield layoutFunc(handlerArgs.graphData);\n        return {\n          graphData: handlerArgs.graphData\n        };\n      }), runtimeHook);\n      /** 设置结果 */\n      this.ctx.setResult(result);\n      return this;\n    });\n    this.undo = () => __awaiter(this, void 0, void 0, function* () {\n      this.ctx.undo();\n      return this;\n    });\n    this.redo = () => __awaiter(this, void 0, void 0, function* () {\n      if (!this.ctx.isUndoable) {\n        yield this.execute();\n      }\n      return this;\n    });\n  }\n  init() {\n    this.ctx = this.contextProvider();\n  }\n  isUndoable() {\n    return this.ctx.isUndoable();\n  }\n};\n__decorate([inject(ICommandContextProvider), __metadata(\"design:type\", Object)], GraphLayoutCommand.prototype, \"contextProvider\", void 0);\n__decorate([postConstruct(), __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", []), __metadata(\"design:returntype\", void 0)], GraphLayoutCommand.prototype, \"init\", null);\nGraphLayoutCommand = __decorate([injectable({\n  token: {\n    token: ICommandHandler,\n    named: NsGraphLayout.command.id\n  }\n})\n/** 画布布局命令 */], GraphLayoutCommand);\nexport { GraphLayoutCommand };","map":{"version":3,"names":["inject","injectable","postConstruct","AntvLayout","ICommandHandler","ICommandContextProvider","XFlowGraphCommands","NsGraphLayout","command","GRAPH_LAYOUT","hookKey","GraphLayoutCommand","constructor","execute","__awaiter","args","hooks","runtimeHook","ctx","getArgs","getHooks","result","graphLayout","call","handlerArgs","layoutType","layoutOptions","customLayout","innerLayout","graphData","clz","Layouts","antVLayout","Object","assign","layout","layoutFunc","setResult","undo","redo","isUndoable","init","contextProvider","__decorate","token","named","id"],"sources":["../../../src/command-contributions/graph/graph-layout.ts"],"sourcesContent":[null],"mappings":";AAAA,SAASA,MAAM,EAAEC,UAAU,EAAEC,aAAa,QAAQ,cAAc;AAMhE,OAAO,KAAKC,UAAU,MAAM,cAAc;AAC1C,SAASC,eAAe,EAAEC,uBAAuB,QAAQ,yBAAyB;AAClF,SAASC,kBAAkB,QAAQ,aAAa;AAIhD;AACA,OAAM,IAAWC,aAAa;AAA9B,WAAiBA,aAAa;EAC5B;EACaA,aAAA,CAAAC,OAAO,GAAGF,kBAAkB,CAACG,YAAY;EACtD;EACaF,aAAA,CAAAG,OAAO,GAAG,aAAa;AAsBtC,CAAC,EA1BgBH,aAAa,KAAbA,aAAa;AAgCvB,IAAMI,kBAAkB,GAAxB,MAAMA,kBAAkB;EAAxBC,YAAA;IAUL;IACA,KAAAC,OAAO,GAAG,MAAWC,SAAA;MACnB,MAAM;QAAEC,IAAI;QAAEC,KAAK,EAAEC;MAAW,CAAE,GAAG,IAAI,CAACC,GAAG,CAACC,OAAO,EAAE;MACvD,MAAMH,KAAK,GAAG,IAAI,CAACE,GAAG,CAACE,QAAQ,EAAE;MAEjC,MAAMC,MAAM,GAAG,MAAML,KAAK,CAACM,WAAW,CAACC,IAAI,CACzCR,IAAI,EACES,WAAW,IAAGV,SAAA;QAClB,MAAM;UAAEW,UAAU;UAAEC,aAAa;UAAEC;QAAY,CAAE,GAAGH,WAAW;QAC/D;QACA,MAAMI,WAAW,GAAIC,SAA6B,IAAI;UACpD,MAAMC,GAAG,GAAG3B,UAAU,CAAC4B,OAAO,CAACN,UAAU,CAAC;UAC1C,MAAMO,UAAU,GAAG,IAAIF,GAAG,CAAAG,MAAA,CAAAC,MAAA,KACrBR,aAAa,EAChB;UACF,OAAOM,UAAU,CAACG,MAAM,CAACN,SAAS,CAAC;QACrC,CAAC;QACD,MAAMO,UAAU,GAAGT,YAAY,IAAIC,WAAW;QAC9C,MAAMQ,UAAU,CAACZ,WAAW,CAACK,SAAS,CAAC;QAEvC,OAAO;UAAEA,SAAS,EAAEL,WAAW,CAACK;QAAS,CAAE;MAC7C,CAAC,GACDZ,WAAW,CACZ;MAED;MACA,IAAI,CAACC,GAAG,CAACmB,SAAS,CAAChB,MAAM,CAAC;MAE1B,OAAO,IAAI;IACb,CAAC;IAED,KAAAiB,IAAI,GAAG,MAAWxB,SAAA;MAChB,IAAI,CAACI,GAAG,CAACoB,IAAI,EAAE;MACf,OAAO,IAAI;IACb,CAAC;IAED,KAAAC,IAAI,GAAG,MAAWzB,SAAA;MAChB,IAAI,CAAC,IAAI,CAACI,GAAG,CAACsB,UAAU,EAAE;QACxB,MAAM,IAAI,CAAC3B,OAAO,EAAE;;MAEtB,OAAO,IAAI;IACb,CAAC;EAKH;EAlDE4B,IAAIA,CAAA;IACF,IAAI,CAACvB,GAAG,GAAG,IAAI,CAACwB,eAAe,EAAE;EACnC;EA6CAF,UAAUA,CAAA;IACR,OAAO,IAAI,CAACtB,GAAG,CAACsB,UAAU,EAAE;EAC9B;CACD;AAvDCG,UAAA,EAAC3C,MAAM,CAACK,uBAAuB,CAAC,E,4FAA6C;AAI7EsC,UAAA,EAACzC,aAAa,EAAE,E,+JAGf;AARUS,kBAAkB,GAAAgC,UAAA,EAJ9B1C,UAAU,CAAC;EACV2C,KAAK,EAAE;IAAEA,KAAK,EAAExC,eAAe;IAAEyC,KAAK,EAAEtC,aAAa,CAACC,OAAO,CAACsC;EAAE;CACjE;AACD,c,EACanC,kBAAkB,CAwD9B;SAxDYA,kBAAkB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}