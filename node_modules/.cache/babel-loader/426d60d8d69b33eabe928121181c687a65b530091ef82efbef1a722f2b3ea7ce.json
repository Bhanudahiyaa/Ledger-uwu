{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { AttributeType, gl } from '@antv/l7-core';\nimport { lodashUtil } from '@antv/l7-utils';\nimport BaseModel from \"../../core/BaseModel\";\nimport { earthTriangulation } from \"../../core/triangulation\";\n/* babel-plugin-inline-import '../shaders/atmosphere/atmosphere_frag.glsl' */\nconst atmoSphereFrag = \"\\nlayout(std140) uniform commonUniforms {\\n float u_opacity;\\n};\\nin vec3 vVertexNormal;\\nin float v_offset;\\nin vec4 v_Color;\\n\\n#pragma include \\\"scene_uniforms\\\"\\nout vec4 outputColor;\\nvoid main() {\\n    \\n    \\n    // float intensity = pow(0.5 + dot(normalize(vVertexNormal), normalize(u_CameraPosition)), 3.0);\\n    float intensity = pow(v_offset + dot(normalize(vVertexNormal), normalize(u_CameraPosition)), 3.0);\\n    // \\u53BB\\u9664\\u80CC\\u9762\\n    if(intensity > 1.0) intensity = 0.0;\\n\\n    outputColor = vec4(v_Color.rgb, v_Color.a * intensity * u_opacity);\\n}\\n\";\n/* babel-plugin-inline-import '../shaders/atmosphere/atmosphere_vert.glsl' */\nconst atmoSphereVert = \"layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\\nlayout(location = ATTRIBUTE_LOCATION_COLOR) vec4 a_Color;\\nlayout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;\\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;\\n\\nlayout(std140) uniform commonUniforms {\\n float u_opacity;\\n};\\n\\n#pragma include \\\"scene_uniforms\\\"\\nout vec3 vVertexNormal;\\nout vec4 v_Color;\\nout float v_offset;\\n\\nvoid main() {\\n    float EARTH_RADIUS = 100.0;\\n\\n    v_Color = a_Color;\\n\\n    v_offset = min(((length(u_CameraPosition) - EARTH_RADIUS)/600.0) * 0.5 + 0.4, 1.0);\\n    vVertexNormal = a_Normal;\\n\\n    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\\n}\\n\";\nconst {\n  isNumber\n} = lodashUtil;\nexport default class EarthAtomSphereModel extends BaseModel {\n  get attributeLocation() {\n    return Object.assign(super.attributeLocation, {\n      MAX: super.attributeLocation.MAX,\n      NORMAL: 9,\n      UV: 10\n    });\n  }\n  getCommonUniformsInfo() {\n    const {\n      opacity = 1\n    } = this.layer.getLayerConfig();\n    const commonOptions = {\n      u_opacity: isNumber(opacity) ? opacity : 1.0\n    };\n    const commonBufferInfo = this.getUniformsBufferInfo(commonOptions);\n    return commonBufferInfo;\n  }\n  initModels() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      _this.initUniformsBuffer();\n      return _this.buildModels();\n    })();\n  }\n  clearModels() {\n    return '';\n  }\n  buildModels() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      // TODO: 调整图层的绘制顺序 地球大气层\n      _this2.layer.zIndex = -997;\n      const model = yield _this2.layer.buildLayerModel({\n        moduleName: 'earthAtmoSphere',\n        vertexShader: atmoSphereVert,\n        fragmentShader: atmoSphereFrag,\n        defines: _this2.getDefines(),\n        triangulation: earthTriangulation,\n        depth: {\n          enable: false\n        },\n        blend: _this2.getBlend()\n      });\n      return [model];\n    })();\n  }\n  registerBuiltinAttributes() {\n    // point layer size;\n    // this.styleAttributeService.registerStyleAttribute({\n    //   name: 'size',\n    //   type: AttributeType.Attribute,\n    //   descriptor: {\n    //     name: 'a_Size',\n    //     shaderLocation: this.attributeLocation.SIZE,\n    //     buffer: {\n    //       usage: gl.DYNAMIC_DRAW,\n    //       data: [],\n    //       type: gl.FLOAT,\n    //     },\n    //     size: 1,\n    //     update: (feature: IEncodeFeature) => {\n    //       const { size = 1 } = feature;\n    //       return Array.isArray(size) ? [size[0]] : [size as number];\n    //     },\n    //   },\n    // });\n\n    this.styleAttributeService.registerStyleAttribute({\n      name: 'normal',\n      type: AttributeType.Attribute,\n      descriptor: {\n        name: 'a_Normal',\n        shaderLocation: this.attributeLocation.NORMAL,\n        buffer: {\n          usage: gl.STATIC_DRAW,\n          data: [],\n          type: gl.FLOAT\n        },\n        size: 3,\n        update: (feature, featureIdx, vertex, attributeIdx, normal) => {\n          return normal;\n        }\n      }\n    });\n    this.styleAttributeService.registerStyleAttribute({\n      name: 'uv',\n      type: AttributeType.Attribute,\n      descriptor: {\n        name: 'a_Uv',\n        shaderLocation: this.attributeLocation.UV,\n        buffer: {\n          usage: gl.DYNAMIC_DRAW,\n          data: [],\n          type: gl.FLOAT\n        },\n        size: 2,\n        update: (feature, featureIdx, vertex) => {\n          return [vertex[3], vertex[4]];\n        }\n      }\n    });\n  }\n}","map":{"version":3,"names":["_asyncToGenerator","AttributeType","gl","lodashUtil","BaseModel","earthTriangulation","atmoSphereFrag","atmoSphereVert","isNumber","EarthAtomSphereModel","attributeLocation","Object","assign","MAX","NORMAL","UV","getCommonUniformsInfo","opacity","layer","getLayerConfig","commonOptions","u_opacity","commonBufferInfo","getUniformsBufferInfo","initModels","_this","initUniformsBuffer","buildModels","clearModels","_this2","zIndex","model","buildLayerModel","moduleName","vertexShader","fragmentShader","defines","getDefines","triangulation","depth","enable","blend","getBlend","registerBuiltinAttributes","styleAttributeService","registerStyleAttribute","name","type","Attribute","descriptor","shaderLocation","buffer","usage","STATIC_DRAW","data","FLOAT","size","update","feature","featureIdx","vertex","attributeIdx","normal","DYNAMIC_DRAW"],"sources":["/Users/bhanudahiya/Desktop/ledger-IQ/node_modules/@antv/l7-layers/es/earth/models/atmosphere.js"],"sourcesContent":["import _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { AttributeType, gl } from '@antv/l7-core';\nimport { lodashUtil } from '@antv/l7-utils';\nimport BaseModel from \"../../core/BaseModel\";\nimport { earthTriangulation } from \"../../core/triangulation\";\n/* babel-plugin-inline-import '../shaders/atmosphere/atmosphere_frag.glsl' */\nconst atmoSphereFrag = \"\\nlayout(std140) uniform commonUniforms {\\n float u_opacity;\\n};\\nin vec3 vVertexNormal;\\nin float v_offset;\\nin vec4 v_Color;\\n\\n#pragma include \\\"scene_uniforms\\\"\\nout vec4 outputColor;\\nvoid main() {\\n    \\n    \\n    // float intensity = pow(0.5 + dot(normalize(vVertexNormal), normalize(u_CameraPosition)), 3.0);\\n    float intensity = pow(v_offset + dot(normalize(vVertexNormal), normalize(u_CameraPosition)), 3.0);\\n    // \\u53BB\\u9664\\u80CC\\u9762\\n    if(intensity > 1.0) intensity = 0.0;\\n\\n    outputColor = vec4(v_Color.rgb, v_Color.a * intensity * u_opacity);\\n}\\n\";\n/* babel-plugin-inline-import '../shaders/atmosphere/atmosphere_vert.glsl' */\nconst atmoSphereVert = \"layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\\nlayout(location = ATTRIBUTE_LOCATION_COLOR) vec4 a_Color;\\nlayout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;\\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;\\n\\nlayout(std140) uniform commonUniforms {\\n float u_opacity;\\n};\\n\\n#pragma include \\\"scene_uniforms\\\"\\nout vec3 vVertexNormal;\\nout vec4 v_Color;\\nout float v_offset;\\n\\nvoid main() {\\n    float EARTH_RADIUS = 100.0;\\n\\n    v_Color = a_Color;\\n\\n    v_offset = min(((length(u_CameraPosition) - EARTH_RADIUS)/600.0) * 0.5 + 0.4, 1.0);\\n    vVertexNormal = a_Normal;\\n\\n    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\\n}\\n\";\nconst {\n  isNumber\n} = lodashUtil;\nexport default class EarthAtomSphereModel extends BaseModel {\n  get attributeLocation() {\n    return Object.assign(super.attributeLocation, {\n      MAX: super.attributeLocation.MAX,\n      NORMAL: 9,\n      UV: 10\n    });\n  }\n  getCommonUniformsInfo() {\n    const {\n      opacity = 1\n    } = this.layer.getLayerConfig();\n    const commonOptions = {\n      u_opacity: isNumber(opacity) ? opacity : 1.0\n    };\n    const commonBufferInfo = this.getUniformsBufferInfo(commonOptions);\n    return commonBufferInfo;\n  }\n  initModels() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      _this.initUniformsBuffer();\n      return _this.buildModels();\n    })();\n  }\n  clearModels() {\n    return '';\n  }\n  buildModels() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      // TODO: 调整图层的绘制顺序 地球大气层\n      _this2.layer.zIndex = -997;\n      const model = yield _this2.layer.buildLayerModel({\n        moduleName: 'earthAtmoSphere',\n        vertexShader: atmoSphereVert,\n        fragmentShader: atmoSphereFrag,\n        defines: _this2.getDefines(),\n        triangulation: earthTriangulation,\n        depth: {\n          enable: false\n        },\n        blend: _this2.getBlend()\n      });\n      return [model];\n    })();\n  }\n  registerBuiltinAttributes() {\n    // point layer size;\n    // this.styleAttributeService.registerStyleAttribute({\n    //   name: 'size',\n    //   type: AttributeType.Attribute,\n    //   descriptor: {\n    //     name: 'a_Size',\n    //     shaderLocation: this.attributeLocation.SIZE,\n    //     buffer: {\n    //       usage: gl.DYNAMIC_DRAW,\n    //       data: [],\n    //       type: gl.FLOAT,\n    //     },\n    //     size: 1,\n    //     update: (feature: IEncodeFeature) => {\n    //       const { size = 1 } = feature;\n    //       return Array.isArray(size) ? [size[0]] : [size as number];\n    //     },\n    //   },\n    // });\n\n    this.styleAttributeService.registerStyleAttribute({\n      name: 'normal',\n      type: AttributeType.Attribute,\n      descriptor: {\n        name: 'a_Normal',\n        shaderLocation: this.attributeLocation.NORMAL,\n        buffer: {\n          usage: gl.STATIC_DRAW,\n          data: [],\n          type: gl.FLOAT\n        },\n        size: 3,\n        update: (feature, featureIdx, vertex, attributeIdx, normal) => {\n          return normal;\n        }\n      }\n    });\n    this.styleAttributeService.registerStyleAttribute({\n      name: 'uv',\n      type: AttributeType.Attribute,\n      descriptor: {\n        name: 'a_Uv',\n        shaderLocation: this.attributeLocation.UV,\n        buffer: {\n          usage: gl.DYNAMIC_DRAW,\n          data: [],\n          type: gl.FLOAT\n        },\n        size: 2,\n        update: (feature, featureIdx, vertex) => {\n          return [vertex[3], vertex[4]];\n        }\n      }\n    });\n  }\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}