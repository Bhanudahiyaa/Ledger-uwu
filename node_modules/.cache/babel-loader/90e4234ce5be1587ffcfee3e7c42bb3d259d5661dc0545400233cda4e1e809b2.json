{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nexport class TileLayerService {\n  constructor({\n    rendererService,\n    layerService,\n    parent\n  }) {\n    /**\n     * tileResource 用于存储瓦片的全局资源\n     */\n    _defineProperty(this, \"tileResource\", new Map());\n    _defineProperty(this, \"rendererService\", void 0);\n    _defineProperty(this, \"layerService\", void 0);\n    _defineProperty(this, \"parent\", void 0);\n    _defineProperty(this, \"layerTiles\", []);\n    this.rendererService = rendererService;\n    this.layerService = layerService;\n    this.parent = parent;\n  }\n  get tiles() {\n    return this.layerTiles;\n  }\n  hasTile(tileKey) {\n    return this.layerTiles.some(tile => tile.key === tileKey);\n  }\n  addTile(tile) {\n    this.layerTiles.push(tile);\n  }\n  getTile(tileKey) {\n    return this.layerTiles.find(tile => tile.key === tileKey);\n  }\n  getVisibleTileBylngLat(lngLat) {\n    // 加载完成 & 可见 & 鼠标选中\n    return this.layerTiles.find(tile => tile.isLoaded && tile.visible && tile.lnglatInBounds(lngLat));\n  }\n  removeTile(tileKey) {\n    const index = this.layerTiles.findIndex(t => t.key === tileKey);\n    const tile = this.layerTiles.splice(index, 1);\n    if (tile[0]) {\n      tile[0].destroy();\n    }\n  }\n  updateTileVisible(sourceTile) {\n    const tile = this.getTile(sourceTile.key);\n    if (sourceTile.isVisible) {\n      // 不可见 => 可见 兄弟节点加载完成\n      if (sourceTile.parent) {\n        const flag = this.isChildrenLoaded(sourceTile.parent);\n        tile === null || tile === void 0 || tile.updateVisible(flag);\n      } else {\n        tile === null || tile === void 0 || tile.updateVisible(true);\n      }\n    } else {\n      // 可见 => 不可见 兄弟节点加载完成\n      if (sourceTile.parent) {\n        const flag = this.isChildrenLoaded(sourceTile.parent);\n        tile === null || tile === void 0 || tile.updateVisible(!flag);\n      } else {\n        tile === null || tile === void 0 || tile.updateVisible(false);\n      }\n    }\n  }\n  isParentLoaded(sourceTile) {\n    const parentTile = sourceTile.parent;\n    if (!parentTile) {\n      return true;\n    }\n    const tile = this.getTile(parentTile === null || parentTile === void 0 ? void 0 : parentTile.key);\n    if (tile !== null && tile !== void 0 && tile.isLoaded) {\n      // 递归父级\n      return true;\n    }\n    return false;\n  }\n  isChildrenLoaded(sourceTile) {\n    const childrenTile = sourceTile === null || sourceTile === void 0 ? void 0 : sourceTile.children;\n    if (childrenTile.length === 0) {\n      return true;\n    }\n    return childrenTile.every(tile => {\n      const tileLayer = this.getTile(tile === null || tile === void 0 ? void 0 : tile.key);\n      if (!tileLayer) {\n        return true;\n      }\n      return (tileLayer === null || tileLayer === void 0 ? void 0 : tileLayer.isLoaded) === true;\n    });\n  }\n  render() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      const layers = _this.getRenderLayers();\n      const renders = layers.map(/*#__PURE__*/function () {\n        var _ref = _asyncToGenerator(function* (layer) {\n          yield _this.layerService.renderTileLayer(layer);\n        });\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }());\n      yield Promise.all(renders);\n    })();\n  }\n  getRenderLayers() {\n    const tileList = this.layerTiles.filter(t => t.visible && t.isLoaded);\n    const layers = [];\n    tileList.map(tile => layers.push(...tile.getLayers()));\n    return layers;\n  }\n  getLayers() {\n    const tileList = this.layerTiles.filter(t => t.isLoaded);\n    const layers = [];\n    tileList.map(tile => layers.push(...tile.getLayers()));\n    return layers;\n  }\n  getTiles() {\n    return this.layerTiles;\n  }\n  destroy() {\n    this.layerTiles.forEach(t => t.destroy());\n    this.tileResource.clear();\n  }\n}","map":{"version":3,"names":["_asyncToGenerator","_defineProperty","TileLayerService","constructor","rendererService","layerService","parent","Map","tiles","layerTiles","hasTile","tileKey","some","tile","key","addTile","push","getTile","find","getVisibleTileBylngLat","lngLat","isLoaded","visible","lnglatInBounds","removeTile","index","findIndex","t","splice","destroy","updateTileVisible","sourceTile","isVisible","flag","isChildrenLoaded","updateVisible","isParentLoaded","parentTile","childrenTile","children","length","every","tileLayer","render","_this","layers","getRenderLayers","renders","map","_ref","layer","renderTileLayer","_x","apply","arguments","Promise","all","tileList","filter","getLayers","getTiles","forEach","tileResource","clear"],"sources":["/Users/bhanudahiya/Desktop/ledger-IQ/node_modules/@antv/l7-layers/es/tile/service/TileLayerService.js"],"sourcesContent":["import _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nexport class TileLayerService {\n  constructor({\n    rendererService,\n    layerService,\n    parent\n  }) {\n    /**\n     * tileResource 用于存储瓦片的全局资源\n     */\n    _defineProperty(this, \"tileResource\", new Map());\n    _defineProperty(this, \"rendererService\", void 0);\n    _defineProperty(this, \"layerService\", void 0);\n    _defineProperty(this, \"parent\", void 0);\n    _defineProperty(this, \"layerTiles\", []);\n    this.rendererService = rendererService;\n    this.layerService = layerService;\n    this.parent = parent;\n  }\n  get tiles() {\n    return this.layerTiles;\n  }\n  hasTile(tileKey) {\n    return this.layerTiles.some(tile => tile.key === tileKey);\n  }\n  addTile(tile) {\n    this.layerTiles.push(tile);\n  }\n  getTile(tileKey) {\n    return this.layerTiles.find(tile => tile.key === tileKey);\n  }\n  getVisibleTileBylngLat(lngLat) {\n    // 加载完成 & 可见 & 鼠标选中\n    return this.layerTiles.find(tile => tile.isLoaded && tile.visible && tile.lnglatInBounds(lngLat));\n  }\n  removeTile(tileKey) {\n    const index = this.layerTiles.findIndex(t => t.key === tileKey);\n    const tile = this.layerTiles.splice(index, 1);\n    if (tile[0]) {\n      tile[0].destroy();\n    }\n  }\n  updateTileVisible(sourceTile) {\n    const tile = this.getTile(sourceTile.key);\n    if (sourceTile.isVisible) {\n      // 不可见 => 可见 兄弟节点加载完成\n      if (sourceTile.parent) {\n        const flag = this.isChildrenLoaded(sourceTile.parent);\n        tile === null || tile === void 0 || tile.updateVisible(flag);\n      } else {\n        tile === null || tile === void 0 || tile.updateVisible(true);\n      }\n    } else {\n      // 可见 => 不可见 兄弟节点加载完成\n      if (sourceTile.parent) {\n        const flag = this.isChildrenLoaded(sourceTile.parent);\n        tile === null || tile === void 0 || tile.updateVisible(!flag);\n      } else {\n        tile === null || tile === void 0 || tile.updateVisible(false);\n      }\n    }\n  }\n  isParentLoaded(sourceTile) {\n    const parentTile = sourceTile.parent;\n    if (!parentTile) {\n      return true;\n    }\n    const tile = this.getTile(parentTile === null || parentTile === void 0 ? void 0 : parentTile.key);\n    if (tile !== null && tile !== void 0 && tile.isLoaded) {\n      // 递归父级\n      return true;\n    }\n    return false;\n  }\n  isChildrenLoaded(sourceTile) {\n    const childrenTile = sourceTile === null || sourceTile === void 0 ? void 0 : sourceTile.children;\n    if (childrenTile.length === 0) {\n      return true;\n    }\n    return childrenTile.every(tile => {\n      const tileLayer = this.getTile(tile === null || tile === void 0 ? void 0 : tile.key);\n      if (!tileLayer) {\n        return true;\n      }\n      return (tileLayer === null || tileLayer === void 0 ? void 0 : tileLayer.isLoaded) === true;\n    });\n  }\n  render() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      const layers = _this.getRenderLayers();\n      const renders = layers.map( /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator(function* (layer) {\n          yield _this.layerService.renderTileLayer(layer);\n        });\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }());\n      yield Promise.all(renders);\n    })();\n  }\n  getRenderLayers() {\n    const tileList = this.layerTiles.filter(t => t.visible && t.isLoaded);\n    const layers = [];\n    tileList.map(tile => layers.push(...tile.getLayers()));\n    return layers;\n  }\n  getLayers() {\n    const tileList = this.layerTiles.filter(t => t.isLoaded);\n    const layers = [];\n    tileList.map(tile => layers.push(...tile.getLayers()));\n    return layers;\n  }\n  getTiles() {\n    return this.layerTiles;\n  }\n  destroy() {\n    this.layerTiles.forEach(t => t.destroy());\n    this.tileResource.clear();\n  }\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}