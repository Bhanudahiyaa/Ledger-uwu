{"ast":null,"code":"import { __awaiter, __decorate, __metadata } from \"tslib\";\nimport classnames from 'classnames';\nimport { IHookContribution, ManaSyringe } from '@antv/xflow-core';\nimport { IGraphProvider } from '@antv/xflow-core';\nimport { ACTIVE_NODE_PORT, NsPortEvent } from '../interface';\nimport { DisposableCollection, IModelContribution, Disposable } from '@antv/xflow-core';\n/**\n * 内置的hook contribution\n * 处理 config上的runtime的注册项\n */\nlet NodePortTooltipContribution = class NodePortTooltipContribution {\n  constructor() {\n    this.toDispose = new DisposableCollection();\n    /** 获取画布实例 */\n    this.getGraphInstance = () => __awaiter(this, void 0, void 0, function* () {\n      const graphInstance = yield this.graphProvider.getGraphInstance();\n      const graphConfig = yield this.graphProvider.getGraphOptions();\n      return {\n        graph: graphInstance,\n        config: graphConfig\n      };\n    });\n    /** 获取GraphOptions */\n    this.getPortRenderConfig = () => {\n      const dagOptions = {\n        onPortRendered(portRenderedArgs) {\n          /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n          const graph = this;\n          const {\n            port,\n            node\n          } = portRenderedArgs;\n          const {\n            contentSelectors\n          } = portRenderedArgs;\n          const portContainer = contentSelectors && contentSelectors['xflow-port-group'];\n          if (portContainer instanceof Element) {\n            portContainer.setAttribute('class', classnames('xflow-port-group', {\n              connected: port.connected && port.group !== 'out',\n              groupPort: (node === null || node === void 0 ? void 0 : node.isGroup) && (node === null || node === void 0 ? void 0 : node.isGroup())\n            }));\n            portContainer.addEventListener('mouseenter', e => {\n              const eventArgs = {\n                e: e,\n                portId: port.id,\n                nodeId: node.id,\n                portData: port,\n                nodeData: node.getData(),\n                tooltip: port.tooltip,\n                placement: port.group\n              };\n              graph.trigger(NsPortEvent.MOUSE_ENTER, eventArgs);\n            });\n            portContainer.addEventListener('mouseleave', e => {\n              const eventArgs = {\n                e: e,\n                portId: port.id,\n                nodeId: node.id,\n                portData: port,\n                nodeData: node.getData(),\n                tooltip: port.tooltip,\n                placement: port.group\n              };\n              graph.trigger(NsPortEvent.MOUSE_LEAVE, eventArgs);\n            });\n          }\n        }\n      };\n      return dagOptions;\n    };\n    this.registerHookHub = () => __awaiter(this, void 0, void 0, function* () {\n      return Disposable.create(() => {});\n    });\n    this.registerHook = hooks => __awaiter(this, void 0, void 0, function* () {\n      const toDispose = new DisposableCollection();\n      const disposables = [hooks.graphOptions.registerHook({\n        name: 'add onPortRendered options ',\n        handler: args => __awaiter(this, void 0, void 0, function* () {\n          Object.assign(args, this.getPortRenderConfig());\n        })\n      })];\n      toDispose.pushAll(disposables);\n      return Disposable.create(() => {});\n    });\n  }\n  registerModel(registry) {\n    registry.registerModel({\n      id: ACTIVE_NODE_PORT.id,\n      watchChange: self => __awaiter(this, void 0, void 0, function* () {\n        const {\n          graph,\n          config\n        } = yield this.getGraphInstance();\n        const calcPosition = e => {\n          const {\n            x,\n            y,\n            width,\n            height\n          } = e.target.getBoundingClientRect();\n          const clientRect = config.rootContainer.getBoundingClientRect();\n          const position = {\n            x: x - ((clientRect === null || clientRect === void 0 ? void 0 : clientRect.x) || 0) + width / 2,\n            y: y - ((clientRect === null || clientRect === void 0 ? void 0 : clientRect.y) || 0) + height / 2\n          };\n          return position;\n        };\n        const onMouseEnter = args => {\n          self.setValue(Object.assign(Object.assign({}, args), {\n            position: calcPosition(args.e)\n          }));\n        };\n        const onMouseLeave = () => {\n          self.setValue(null);\n        };\n        /** 绑定事件 */\n        graph.on(NsPortEvent.MOUSE_ENTER, onMouseEnter);\n        graph.on(NsPortEvent.MOUSE_LEAVE, onMouseLeave);\n        graph.on('cell:mouseleave', onMouseLeave);\n        return Disposable.create(() => {\n          /** 解除绑定 */\n          graph.off(NsPortEvent.MOUSE_ENTER, onMouseEnter);\n          graph.off(NsPortEvent.MOUSE_LEAVE, onMouseLeave);\n        });\n      })\n    });\n  }\n};\n__decorate([ManaSyringe.inject(IGraphProvider), __metadata(\"design:type\", Object)], NodePortTooltipContribution.prototype, \"graphProvider\", void 0);\nNodePortTooltipContribution = __decorate([ManaSyringe.singleton({\n  contrib: [IHookContribution, IModelContribution]\n})], NodePortTooltipContribution);\nexport { NodePortTooltipContribution };","map":{"version":3,"names":["classnames","IHookContribution","ManaSyringe","IGraphProvider","ACTIVE_NODE_PORT","NsPortEvent","DisposableCollection","IModelContribution","Disposable","NodePortTooltipContribution","constructor","toDispose","getGraphInstance","__awaiter","graphInstance","graphProvider","graphConfig","getGraphOptions","graph","config","getPortRenderConfig","dagOptions","onPortRendered","portRenderedArgs","port","node","contentSelectors","portContainer","Element","setAttribute","connected","group","groupPort","isGroup","addEventListener","e","eventArgs","portId","id","nodeId","portData","nodeData","getData","tooltip","placement","trigger","MOUSE_ENTER","MOUSE_LEAVE","registerHookHub","create","registerHook","hooks","disposables","graphOptions","name","handler","args","Object","assign","pushAll","registerModel","registry","watchChange","self","calcPosition","x","y","width","height","target","getBoundingClientRect","clientRect","rootContainer","position","onMouseEnter","setValue","onMouseLeave","on","off","__decorate","inject","singleton","contrib"],"sources":["../../../src/canvas-node-port-tooltip/contributions/node-port.tsx"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}